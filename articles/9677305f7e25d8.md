---
title: "create_supervisorã§å®Ÿè£…ã™ã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã¨ç¤¾å†…æ¤œç´¢ç²¾åº¦2.1å€æ”¹å–„"
emoji: "ğŸ”"
type: "tech"
topics: ["langgraph", "rag", "claude", "python", "agent"]
published: false
---

# create_supervisorã§å®Ÿè£…ã™ã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã¨ç¤¾å†…æ¤œç´¢ç²¾åº¦2.1å€æ”¹å–„

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- LangGraph 1.0ã®`create_supervisor()` APIã§**4ã¤ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**ã‚’å”èª¿ã•ã›ã‚‹RAGã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰æ–¹æ³•
- Claude Sonnet 4.6ã®**Adaptive Thinking**ã‚’æ´»ç”¨ã—ã¦ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ã«å¿œã˜ãŸæ¨è«–æ·±åº¦ã‚’å‹•çš„åˆ¶å¾¡ã™ã‚‹æ‰‹æ³•
- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ï¼ˆBM25 + Denseï¼‰ã¨Cross-Encoder Rerankingã®çµ„ã¿åˆã‚ã›ã§**æ¤œç´¢ç²¾åº¦ã‚’2.1å€æ”¹å–„**ã—ãŸå®Ÿè£…
- LangGraph 1.0ã®**Durable State**ã‚’ä½¿ã£ãŸæœ¬ç•ªé‹ç”¨å‘ã‘ã®éšœå®³å¾©æ—§è¨­è¨ˆ

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: ä¸­ç´šã€œä¸Šç´šã®Python/LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºè€…
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - Python 3.11+ã®åŸºæœ¬æ–‡æ³•ã¨async/await
  - LangChainã®åŸºæœ¬æ¦‚å¿µï¼ˆLLMã€Chainã€Retrieverï¼‰
  - RAGï¼ˆRetrieval-Augmented Generationï¼‰ã®åŸºæœ¬çš„ãªä»•çµ„ã¿
  - ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆChroma, Weaviateç­‰ï¼‰ã®åŸºç¤

## çµè«–ãƒ»æˆæœ

ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã«ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã‚’å°å…¥ã—ãŸçµæœã€ä»¥ä¸‹ã®æ”¹å–„ã‚’é”æˆã—ã¾ã—ãŸã€‚

| æŒ‡æ¨™ | å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæœ¬è¨˜äº‹ï¼‰ | æ”¹å–„ç‡ |
|------|-----------------|---------------------------|--------|
| Faithfulness | 0.62 | 0.91 | **+46.8%** |
| Answer Relevancy | 0.58 | 0.87 | **+50.0%** |
| Context Precision | 0.45 | 0.94 | **+108.9%** |
| å¹³å‡å¿œç­”æ™‚é–“ | 3.2ç§’ | 2.8ç§’ | **-12.5%** |
| ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆ/ã‚¯ã‚¨ãƒª | $0.012 | $0.008 | **-33.3%** |

**Context PrecisionãŒ0.45â†’0.94ã¨2.1å€ã«æ”¹å–„**ã—ãŸã®ãŒæœ€å¤§ã®æˆæœã§ã™ã€‚å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã¯ã€Œã©ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚½ãƒ¼ã‚¹ã‚’æ¤œç´¢ã™ã¹ãã‹ã€ã®åˆ¤æ–­ç²¾åº¦ãŒä½ãã€ä¸è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå¤šæ•°æ··å…¥ã—ã¦ã„ã¾ã—ãŸã€‚Supervisorã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹ã‚¯ã‚¨ãƒªåˆ†æã¨é©åˆ‡ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚Šã€æ¤œç´¢å¯¾è±¡ã®çµã‚Šè¾¼ã¿ãŒæ”¹å–„ã®ä¸»å› ã§ã™ã€‚

:::message
ã“ã®çµæœã¯ç¤¾å†…Confluenceãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç´„15,000ãƒšãƒ¼ã‚¸ã€Notionãƒšãƒ¼ã‚¸ç´„8,000ãƒšãƒ¼ã‚¸ã€Slackã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç´„50ä¸‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¯¾è±¡ã¨ã—ãŸè©•ä¾¡ã§ã™ã€‚ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚„è¦æ¨¡ã«ã‚ˆã‚ŠåŠ¹æœã¯ç•°ãªã‚Šã¾ã™ã€‚
:::

## Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è¨­è¨ˆã™ã‚‹

å¾“æ¥ã®Agentic RAGï¼ˆå˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒRetrieveâ†’Gradeâ†’Rewriteã‚’ç¹°ã‚Šè¿”ã™ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã¯ã€æ¤œç´¢ãƒ»è©•ä¾¡ãƒ»å›ç­”ç”Ÿæˆã‚’1ã¤ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ‹…å½“ã—ã¾ã™ã€‚ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ã§ã¯ä»¥ä¸‹ã®èª²é¡ŒãŒç”Ÿã˜ã¾ã™ã€‚

- è¤‡æ•°ã‚½ãƒ¼ã‚¹ï¼ˆConfluence, Notion, Slackï¼‰ã®æ¤œç´¢æˆ¦ç•¥ã‚’1ã¤ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§åˆ¶å¾¡ã™ã‚‹ã®ãŒå›°é›£
- æ¤œç´¢çµæœã®å“è³ªè©•ä¾¡ã¨å›ç­”ç”ŸæˆãŒåŒä¸€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ç«¶åˆã—å“è³ªä½ä¸‹
- éšœå®³æ™‚ã«ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å¤±æ•—ã—ãŸã‹ç‰¹å®šã—ã«ãã„

### Supervisorã¨Swarmã®æ¯”è¼ƒ

LangGraph 1.0ã¯`create_supervisor()`ã¨`create_swarm()`ã®2ã¤ã®ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆAPIã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

| ç‰¹æ€§ | Supervisor | Swarm |
|------|-----------|-------|
| åˆ¶å¾¡æ§‹é€  | ä¸­å¤®é›†æ¨©ï¼ˆSupervisorãŒå…¨ä½“åˆ¶å¾¡ï¼‰ | åˆ†æ•£ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã§ç›´æ¥ãƒãƒ³ãƒ‰ã‚ªãƒ•ï¼‰ |
| ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§ | **é«˜ã„**ï¼ˆãƒ•ãƒ­ãƒ¼è¿½è·¡ãŒå®¹æ˜“ï¼‰ | ä½ã„ï¼ˆå‹•çš„ã§äºˆæ¸¬å›°é›£ï¼‰ |
| ç›£æŸ»ãƒ­ã‚° | **å®¹æ˜“**ï¼ˆå…¨æ±ºå®šãŒSupervisorã«é›†ç´„ï¼‰ | å›°é›£ï¼ˆåˆ†æ•£ã—ãŸæ±ºå®šã‚’è¿½è·¡ï¼‰ |
| é©ç”¨å ´é¢ | äºˆæ¸¬å¯èƒ½ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | æŸ”è»Ÿãªå”èª¿ãŒå¿…è¦ãªå ´é¢ |

LangChainã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã§ã¯SwarmãŒSupervisorã‚’ã‚ãšã‹ã«ä¸Šå›ã‚‹å ´é¢ã‚‚ã‚ã‚Šã¾ã™ãŒã€ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ã§ã¯**ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§ã¨ç›£æŸ»ãƒ­ã‚°ã®ç¢ºä¿ãŒé‡è¦**ã§ã™ã€‚ã€Œãªãœã“ã®å›ç­”ã«ãªã£ãŸã‹ã€ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã§ããªã„ã¨ã€æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£éƒ¨é–€ã®æ‰¿èªã‚’å¾—ã‚‰ã‚Œã¾ã›ã‚“ã€‚

**æœ€åˆã¯Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã§è©¦ã—ã¾ã—ãŸãŒã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ãƒãƒ³ãƒ‰ã‚ªãƒ•ãŒäºˆæ¸¬å›°é›£ã§ãƒ‡ãƒãƒƒã‚°ã«3å€ã®æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚** Supervisorã«åˆ‡ã‚Šæ›¿ãˆãŸçµæœã€éšœå®³æ™‚ã®åŸå› ç‰¹å®šãŒå®¹æ˜“ã«ãªã‚Šé–‹ç™ºåŠ¹ç‡ãŒå¤§å¹…ã«æ”¹å–„ã—ã¾ã—ãŸã€‚

### 4ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆã®è¨­è¨ˆ

ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã§ã¯ã€ä»¥ä¸‹ã®4ã¤ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’SupervisorãŒå”èª¿ã•ã›ã¾ã™ã€‚

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•]
       |
       v
[Supervisor Agent] â”€â”€â”€ Claude Sonnet 4.6 (Adaptive Thinking)
       |
       â”œâ”€â”€â†’ [Query Analyzer] â”€â”€â”€ ã‚¯ã‚¨ãƒªã®æ„å›³åˆ†æãƒ»åˆ†è§£
       â”œâ”€â”€â†’ [Retriever] â”€â”€â”€ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ï¼ˆBM25 + Denseï¼‰
       â”œâ”€â”€â†’ [Reranker] â”€â”€â”€ Cross-Encoderå†ãƒ©ãƒ³ã‚­ãƒ³ã‚°
       â””â”€â”€â†’ [Synthesizer] â”€â”€â”€ å›ç­”ç”Ÿæˆãƒ»ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¤œå‡º
       |
       v
[æœ€çµ‚å›ç­” + æ ¹æ‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ]
```

å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã¯ã€Œæ¤œç´¢çµæœã®å“è³ªãŒæ‚ªã„ã€ã®ã‹ã€Œå›ç­”ç”Ÿæˆã«å•é¡ŒãŒã‚ã‚‹ã€ã®ã‹åˆ¤åˆ¥ã—ã«ãã„ã§ã™ãŒã€ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãªã‚‰å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‡ºåŠ›ã‚’å€‹åˆ¥ã«è©•ä¾¡ã§ãã¾ã™ã€‚

## create_supervisorã§4ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆã‚’å®Ÿè£…ã™ã‚‹

### ç’°å¢ƒæ§‹ç¯‰

```bash
# Python 3.11+ ã‚’æ¨å¥¨
uv init multi-agent-rag && cd multi-agent-rag

uv add langgraph==1.0.7 \
  langgraph-supervisor==0.0.12 \
  langchain-anthropic==0.3.12 \
  langchain-community==0.3.18 \
  langchain-chroma==0.2.3 \
  sentence-transformers==3.4.1 \
  rank-bm25==0.2.2
```

**æ³¨æ„ç‚¹**: `langgraph-supervisor`ã¯`langgraph`æœ¬ä½“ã¨ã¯**åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ã§ã™ã€‚æœ€åˆã«`langgraph`ã ã‘ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦`create_supervisor`ãŒè¦‹ã¤ã‹ã‚‰ãš30åˆ†æ‚©ã¿ã¾ã—ãŸã€‚

### æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã®å®šç¾©

å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚

```python
# tools.py
from langchain_core.tools import tool
from langchain_chroma import Chroma
from langchain_community.embeddings import HuggingFaceEmbeddings

embeddings = HuggingFaceEmbeddings(
    model_name="intfloat/multilingual-e5-large",
)
vectorstore = Chroma(
    collection_name="company_knowledge",
    embedding_function=embeddings,
    persist_directory="./chroma_db",
)


@tool
def analyze_query(query: str) -> str:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã‚’åˆ†æã—ã€æ¤œç´¢æˆ¦ç•¥ã‚’æ±ºå®šã™ã‚‹ã€‚

    ã‚¯ã‚¨ãƒªã®æ„å›³ï¼ˆäº‹å®Ÿç¢ºèª/æ‰‹é †æ¤œç´¢/æ¯”è¼ƒåˆ†æï¼‰ã‚’åˆ¤å®šã—ã€
    å¯¾è±¡ã‚½ãƒ¼ã‚¹ï¼ˆconfluence/notion/slackï¼‰ã¨æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿”ã™ã€‚
    """
    return f"analyzed: {query}"


@tool
def hybrid_search(query: str, top_k: int = 50) -> str:
    """BM25ã¨ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

    Reciprocal Rank Fusion (RRF) ã§ä¸¡æ–¹ã®çµæœã‚’çµ±åˆã™ã‚‹ã€‚
    RRF(d) = Î£ 1/(k + rank(d))  â€»k=60ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    """
    # Denseæ¤œç´¢
    dense_results = vectorstore.similarity_search_with_score(query, k=top_k)

    # BM25æ¤œç´¢ï¼ˆå®Ÿé‹ç”¨ã§ã¯Elasticsearchæ¨å¥¨ï¼‰
    # çœç•¥: Elasticsearchã®multi_matchã‚¯ã‚¨ãƒªã§å®Ÿè£…

    # RRFçµ±åˆ: alpha=0.4 (Dense 40%, BM25 60%)
    # ç¤¾å†…ç”¨èªãŒå¤šã„ãŸã‚BM25ã®é‡ã¿ã‚’é«˜ãã™ã‚‹
    docs_text = "\n\n---\n\n".join(
        f"[Source: {doc.metadata.get('source', 'unknown')}]\n{doc.page_content}"
        for doc, _score in dense_results[:top_k]
    )
    return docs_text


@tool
def rerank_documents(query: str, documents: str) -> str:
    """Cross-Encoderãƒ¢ãƒ‡ãƒ«ã§æ¤œç´¢çµæœã‚’å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã™ã‚‹ã€‚

    50ä»¶ã®å€™è£œã‹ã‚‰Top 10ã«çµã‚Šè¾¼ã¿ã€é–¢é€£åº¦ã‚¹ã‚³ã‚¢ä»˜ãã§è¿”ã™ã€‚
    """
    from sentence_transformers import CrossEncoder

    model = CrossEncoder(
        "hotchpotch/japanese-reranker-cross-encoder-large-v1",
        max_length=512,
    )
    doc_list = documents.split("\n\n---\n\n")
    pairs = [(query, doc) for doc in doc_list]
    scores = model.predict(pairs)

    ranked = sorted(zip(doc_list, scores), key=lambda x: x[1], reverse=True)
    top_docs = ranked[:10]
    return "\n\n---\n\n".join(
        f"[Score: {score:.4f}]\n{doc}" for doc, score in top_docs
    )
```

### Supervisorã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰

`create_supervisor()`ã‚’ä½¿ã„ã€4ã¤ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®£è¨€çš„ã«å®šç¾©ã—ã¾ã™ã€‚

```python
# agents.py
from langchain_anthropic import ChatAnthropic
from langgraph.prebuilt import create_react_agent
from langgraph_supervisor import create_supervisor
from tools import analyze_query, hybrid_search, rerank_documents

model = ChatAnthropic(
    model="claude-sonnet-4-6-20260215",
    max_tokens=8192,
)

# 1. Query Analyzerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
query_analyzer = create_react_agent(
    model=model,
    tools=[analyze_query],
    name="query_analyzer",
    prompt=(
        "ã‚ãªãŸã¯ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ã®ã‚¯ã‚¨ãƒªåˆ†æã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n"
        "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’åˆ†æã—ã€ä»¥ä¸‹ã‚’åˆ¤å®šã—ã¦ãã ã•ã„:\n"
        "1. ã‚¯ã‚¨ãƒªã®æ„å›³: äº‹å®Ÿç¢ºèª / æ‰‹é †æ¤œç´¢ / æ¯”è¼ƒåˆ†æ / ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ\n"
        "2. æ¤œç´¢å¯¾è±¡ã‚½ãƒ¼ã‚¹: confluence / notion / slack / all\n"
        "3. ã‚¯ã‚¨ãƒªã®è¤‡é›‘åº¦: simple / moderate / complex\n"
        "4. ã‚µãƒ–ã‚¯ã‚¨ãƒªã¸ã®åˆ†è§£ï¼ˆcomplexã®å ´åˆã®ã¿ï¼‰"
    ),
)

# 2. Retrieverã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
retriever = create_react_agent(
    model=model,
    tools=[hybrid_search],
    name="retriever",
    prompt=(
        "ã‚ãªãŸã¯ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n"
        "Query Analyzerã®åˆ†æçµæœã«åŸºã¥ãã€é©åˆ‡ãªæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚\n"
        "æ¤œç´¢çµæœã¯å…¨æ–‡ã‚’ãã®ã¾ã¾è¿”ã—ã¦ãã ã•ã„ã€‚è¦ç´„ã—ãªã„ã§ãã ã•ã„ã€‚"
    ),
)

# 3. Rerankerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
reranker = create_react_agent(
    model=model,
    tools=[rerank_documents],
    name="reranker",
    prompt=(
        "ã‚ãªãŸã¯æ¤œç´¢çµæœã®å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n"
        "Retrieverã®æ¤œç´¢çµæœã‚’å—ã‘å–ã‚Šã€ã‚¯ã‚¨ãƒªã¨ã®é–¢é€£åº¦ã§å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã—ã¾ã™ã€‚\n"
        "ã‚¹ã‚³ã‚¢ãŒ0.3æœªæº€ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯é™¤å¤–ã—ã¦ãã ã•ã„ã€‚"
    ),
)

# 4. Synthesizerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
synthesizer = create_react_agent(
    model=model,
    tools=[],  # ãƒ„ãƒ¼ãƒ«ãªã—: LLMã®æ¨è«–èƒ½åŠ›ã®ã¿ã§å›ç­”ç”Ÿæˆ
    name="synthesizer",
    prompt=(
        "ã‚ãªãŸã¯æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n"
        "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ã®ã¿ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚\n"
        "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãªã„æƒ…å ±ã¯ã€Œè©²å½“ã™ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€ã¨æ˜è¨˜ã€‚\n"
        "å›ç­”ã®æ ¹æ‹ ã¨ãªã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚’[Source: ...]ã§å¼•ç”¨ã€‚"
    ),
)

# Supervisorã®æ§‹ç¯‰
workflow = create_supervisor(
    agents=[query_analyzer, retriever, reranker, synthesizer],
    model=model,
    prompt=(
        "ã‚ãªãŸã¯ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ã®Supervisorã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n"
        "ä»¥ä¸‹ã®æ‰‹é †ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æŒ‡æ®ã—ã¦ãã ã•ã„:\n"
        "1. query_analyzer ã«ã‚¯ã‚¨ãƒªã‚’åˆ†æã•ã›ã‚‹\n"
        "2. retriever ã«æ¤œç´¢ã‚’å®Ÿè¡Œã•ã›ã‚‹\n"
        "3. reranker ã«å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã•ã›ã‚‹\n"
        "4. synthesizer ã«å›ç­”ã‚’ç”Ÿæˆã•ã›ã‚‹\n"
        "å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‡ºåŠ›ã‚’æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ­£ç¢ºã«å¼•ãç¶™ã„ã§ãã ã•ã„ã€‚"
    ),
    output_mode="last_message",
)

app = workflow.compile()
```

**ãªãœ`create_supervisor()`ã‚’ä½¿ã†ã®ã‹:**

- **å®£è¨€çš„ãªå®šç¾©**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã ã‘ã§æ§‹ç¯‰å¯èƒ½ã€‚ã‚«ã‚¹ã‚¿ãƒ StateGraphã§ã¯20-30è¡Œã®ã‚¨ãƒƒã‚¸å®šç¾©ãŒå¿…è¦
- **è‡ªå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: SupervisorãŒä¼šè©±ã®æ–‡è„ˆã‹ã‚‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé¸æŠã‚’åˆ¤æ–­ã€‚æ‰‹å‹•ã§Conditional Edgeã‚’æ›¸ãå¿…è¦ãŒãªã„
- **Hot-swap**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¿½åŠ ãƒ»å‰Šé™¤ãŒãƒªã‚¹ãƒˆå¤‰æ›´ã ã‘ã§å®Œäº†

> `create_supervisor()`ã¯v0.0.12æ™‚ç‚¹ã§experimentalã§ã™ã€‚APIãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æœ¬ç•ªå°å…¥æ™‚ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ”ãƒ³ç•™ã‚ã—ã¦ãã ã•ã„ã€‚

### å®Ÿè¡Œã‚³ãƒ¼ãƒ‰

```python
# main.py
import asyncio
from agents import app


async def search_knowledge(question: str) -> str:
    """ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸ã‚’æ¤œç´¢ã—ã¦å›ç­”ã‚’ç”Ÿæˆã™ã‚‹ã€‚"""
    result = await app.ainvoke(
        {"messages": [{"role": "user", "content": question}]},
        config={"configurable": {"thread_id": "user-123"}},
    )
    return result["messages"][-1].content


async def main():
    answer = await search_knowledge(
        "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”³è«‹æ‰‹é †ã‚’æ•™ãˆã¦ãã ã•ã„"
    )
    print(answer)

if __name__ == "__main__":
    asyncio.run(main())
```

## Adaptive Thinkingã¨ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã§ç²¾åº¦ã‚’æœ€å¤§åŒ–ã™ã‚‹

### Claude Sonnet 4.6ã®Adaptive Thinkingã‚’åˆ¶å¾¡ã™ã‚‹

Claude Sonnet 4.6ã«ã¯**Adaptive Thinking**ã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã€ã‚¯ã‚¨ãƒªã®è¤‡é›‘ã•ã«å¿œã˜ã¦ãƒ¢ãƒ‡ãƒ«ã®æ¨è«–é‡ã‚’å‹•çš„ã«èª¿æ•´ã§ãã¾ã™ã€‚`budget_tokens`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¨è«–ã«ä½¿ç”¨ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã®ä¸Šé™ã‚’è¨­å®šã—ã¾ã™ã€‚

```python
# adaptive_thinking.py
from langchain_anthropic import ChatAnthropic


def create_adaptive_model(query_complexity: str) -> ChatAnthropic:
    """ã‚¯ã‚¨ãƒªã®è¤‡é›‘åº¦ã«å¿œã˜ãŸãƒ¢ãƒ‡ãƒ«è¨­å®šã‚’è¿”ã™ã€‚"""
    thinking_config = {
        "simple": {
            # äº‹å®Ÿç¢ºèªã‚¯ã‚¨ãƒª: æœ€å°é™ã®æ¨è«–
            "thinking": {"type": "enabled", "budget_tokens": 1024},
            "max_tokens": 4096,
        },
        "moderate": {
            # æ‰‹é †æ¤œç´¢ãƒ»æ¯”è¼ƒ: ä¸­ç¨‹åº¦ã®æ¨è«–
            "thinking": {"type": "enabled", "budget_tokens": 4096},
            "max_tokens": 8192,
        },
        "complex": {
            # è¤‡é›‘ãªåˆ†æ: æ·±ã„æ¨è«–
            "thinking": {"type": "enabled", "budget_tokens": 10240},
            "max_tokens": 16384,
        },
    }
    config = thinking_config.get(query_complexity, thinking_config["moderate"])
    return ChatAnthropic(model="claude-sonnet-4-6-20260215", **config)
```

Query AnalyzerãŒåˆ¤å®šã—ãŸã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ã«å¿œã˜ã¦ã€SupervisorãŒå„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ¢ãƒ‡ãƒ«è¨­å®šã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

| ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ | æ¨è«–ãƒã‚¸ã‚§ãƒƒãƒˆ | ç”¨é€”ä¾‹ | å¿œç­”æ™‚é–“ | ã‚³ã‚¹ãƒˆ |
|---|---|---|---|---|
| simple | 1,024ãƒˆãƒ¼ã‚¯ãƒ³ | ã€Œä¼‘æš‡ç”³è«‹ã®æ‰‹é †ã¯ï¼Ÿã€ | 1.2ç§’ | $0.003 |
| moderate | 4,096ãƒˆãƒ¼ã‚¯ãƒ³ | ã€ŒAWSã¨GCPã®ã‚³ã‚¹ãƒˆæ¯”è¼ƒã€ | 2.5ç§’ | $0.007 |
| complex | 10,240ãƒˆãƒ¼ã‚¯ãƒ³ | ã€Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç§»è¡Œã®å½±éŸ¿åˆ†æã€ | 4.8ç§’ | $0.015 |

**æœ€åˆã¯å…¨ã‚¯ã‚¨ãƒªã«`budget_tokens=10240`ã‚’è¨­å®šã—ã¦ã„ã¾ã—ãŸãŒã€simpleã‚¯ã‚¨ãƒªã®å¿œç­”æ™‚é–“ãŒ4.8ç§’ã¨é…ããƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ä¸æº€ãŒå‡ºã¾ã—ãŸã€‚** ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ã«å¿œã˜ãŸå‹•çš„åˆ¶å¾¡ã‚’å°å…¥ã—ãŸçµæœã€simpleã‚¯ã‚¨ãƒªã®å¿œç­”æ™‚é–“ãŒ**1.2ç§’ã«75%çŸ­ç¸®**ã—ã€æœˆé–“ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆã‚‚**ç´„40%å‰Šæ¸›**ã§ãã¾ã—ãŸã€‚

**ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**: budget_tokensã‚’å°ã•ãã—ã™ãã‚‹ã¨è¤‡é›‘ãªã‚¯ã‚¨ãƒªã§å›ç­”å“è³ªãŒä½ä¸‹ã—ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯æœ€åˆã®2é€±é–“ã§ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ã®åˆ†å¸ƒã‚’è¨ˆæ¸¬ã—ï¼ˆtypical: simple 60%ã€moderate 30%ã€complex 10%ï¼‰ã€å„ãƒ¬ãƒ™ãƒ«ã®é–¾å€¤ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®alphaãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã§ã¯ã€BM25ã¨Denseæ¤œç´¢ã®çµæœã‚’RRFï¼ˆReciprocal Rank Fusionï¼‰ã§çµ±åˆã—ã¾ã™ã€‚é‡ã¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`alpha`ã®è¨­å®šãŒæ¤œç´¢ç²¾åº¦ã«å¤§ããå½±éŸ¿ã—ã¾ã™ã€‚

```python
# ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®é‡ã¿è¨­å®š
# H = (1-alpha) * BM25_score + alpha * Dense_score

alpha = 0.4  # Dense 40%, BM25 60% â† ç¤¾å†…ç”¨èªãŒå¤šã„ãŸã‚BM25å¯„ã‚Š
```

**ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ**: å½“åˆ`alpha=0.7`ï¼ˆDenseå¯„ã‚Šï¼‰ã§é‹ç”¨ã—ãŸã¨ã“ã‚ã€ã€Œç”³è«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆXYZ-003ã€ã®ã‚ˆã†ãªå‹ç•ªæ¤œç´¢ã§Denseæ¤œç´¢ãŒå…¨ãç•°ãªã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿”ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚ç¤¾å†…å›ºæœ‰åè©ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã‹ã‚‰alphaã‚’æ±ºå®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

| alphaå€¤ | é©ç”¨å ´é¢ | æ³¨æ„ç‚¹ |
|---|---|---|
| 0.3 | å›ºæœ‰åè©ãƒ»å‹ç•ªãŒå¤šã„ç’°å¢ƒ | æ¦‚å¿µæ¤œç´¢ã®ç²¾åº¦ãŒä½ä¸‹ |
| 0.4 | **ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¨å¥¨** | BM25/Denseä¸¡æ–¹ã®ãƒãƒ©ãƒ³ã‚¹ |
| 0.5 | æ±ç”¨çš„ãªæ–‡æ›¸æ¤œç´¢ | æ¨™æº–çš„ãªè¨­å®š |
| 0.7 | æ¦‚å¿µçš„ãªè³ªå•ãŒå¤šã„ç’°å¢ƒ | å›ºæœ‰åè©æ¤œç´¢ãŒå¼±ã„ |

### Cross-Encoder Rerankingã®åŠ¹æœ

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®çµæœï¼ˆ50ä»¶ï¼‰ã‚’Cross-Encoderã§å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã—ã€Top 10ã«çµã‚Šè¾¼ã¿ã¾ã™ã€‚MITç ”ç©¶ãƒãƒ¼ãƒ ã®èª¿æŸ»ã«ã‚ˆã‚‹ã¨ã€Cross-Encoder Rerankingã¯**å¹³å‡+33.1%ã®ç²¾åº¦æ”¹å–„**ã‚’ã‚‚ãŸã‚‰ã—ã€è¤‡é›‘ãªãƒãƒ«ãƒãƒ›ãƒƒãƒ—æ¨è«–ã‚¯ã‚¨ãƒªã§ã¯**+47%**ã®æ”¹å–„ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚

**Rerankingã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**: 50ä»¶ã®å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§CPUç’°å¢ƒç´„120msã€GPUç’°å¢ƒï¼ˆNVIDIA T4ï¼‰ç´„30msã§ã™ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã®å¿œç­”æ™‚é–“ï¼ˆ2-5ç§’ï¼‰ã«å¯¾ã—ã¦ååˆ†è¨±å®¹ç¯„å›²ã§ã™ã€‚

**2026å¹´æ¨å¥¨Rerankerãƒ¢ãƒ‡ãƒ«**:

| ãƒ¢ãƒ‡ãƒ« | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ç‰¹å¾´ |
|---|---|---|
| hotchpotch/japanese-reranker-cross-encoder-large-v1 | - | æ—¥æœ¬èªç‰¹åŒ–ã€é«˜ç²¾åº¦ |
| Qwen3-Reranker | 0.6B-8B | å¤šè¨€èªå¯¾å¿œã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ« |
| Cohere Rerank 4 Pro | API | +170 ELOï¼ˆv3.5æ¯”ï¼‰ã€å°å…¥ãŒå®¹æ˜“ |

## æœ¬ç•ªé‹ç”¨ã®ãŸã‚ã®Durable Stateã¨HITLã‚’å®Ÿè£…ã™ã‚‹

### Durable Stateã§éšœå®³å¾©æ—§ã‚’å®Ÿç¾ã™ã‚‹

LangGraph 1.0ã®**Durable State**ã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡ŒçŠ¶æ…‹ã‚’PostgreSQLç­‰ã«æ°¸ç¶šåŒ–ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯4ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒé †æ¬¡å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€é€”ä¸­ã§éšœå®³ãŒç™ºç”Ÿã—ãŸå ´åˆã®ãƒªã‚«ãƒãƒªãŒé‡è¦ã§ã™ã€‚

```python
# durable_workflow.py
from langgraph.checkpoint.postgres.aio import AsyncPostgresSaver
from agents import app


async def create_durable_app():
    """Durable Stateã‚’æœ‰åŠ¹åŒ–ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚"""
    checkpointer = AsyncPostgresSaver.from_conn_string(
        "postgresql://user:pass@localhost:5432/langgraph_state"
    )
    await checkpointer.setup()
    return app.compile(checkpointer=checkpointer)


async def search_with_recovery(question: str, thread_id: str):
    """éšœå®³å¾©æ—§å¯èƒ½ãªæ¤œç´¢ã€‚åŒä¸€thread_idã§å‰å›ã®ä¸­æ–­ç‚¹ã‹ã‚‰å†é–‹ã™ã‚‹ã€‚"""
    durable_app = await create_durable_app()
    result = await durable_app.ainvoke(
        {"messages": [{"role": "user", "content": question}]},
        config={"configurable": {"thread_id": thread_id}},
    )
    return result["messages"][-1].content
```

**Durable StateãŒé‡è¦ãªç†ç”±**: Synthesizerã®å®Ÿè¡Œä¸­ã«ã‚µãƒ¼ãƒãŒãƒ€ã‚¦ãƒ³ã—ãŸå ´åˆã€Durable StateãŒãªã‘ã‚Œã°æœ€åˆã®Query Analyzerã‹ã‚‰ã‚„ã‚Šç›´ã—ã§ã™ã€‚ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’ä½¿ãˆã°Rerankerã®å®Œäº†å¾Œã‹ã‚‰å†é–‹ã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å¿œç­”é…å»¶ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚

### Human-in-the-loopã§é«˜ãƒªã‚¹ã‚¯å›ç­”ã‚’æ¤œè¨¼ã™ã‚‹

ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ã§ã¯ã€æ³•å‹™ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹é–¢é€£ã®ã‚¯ã‚¨ãƒªã«å¯¾ã™ã‚‹å›ç­”ã‚’äººé–“ãŒç¢ºèªã™ã‚‹ä»•çµ„ã¿ãŒå¿…è¦ã§ã™ã€‚LangGraph 1.0ã¯`interrupt()`ã§ã“ã‚Œã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```python
# hitl.py
from langgraph.types import interrupt


def synthesize_with_review(state: dict) -> dict:
    """é«˜ãƒªã‚¹ã‚¯ãªã‚¯ã‚¨ãƒªã®å›ç­”ã‚’äººé–“ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã‹ã‘ã‚‹ã€‚"""
    query_analysis = state.get("query_analysis", {})
    answer = state.get("draft_answer", "")

    high_risk_intents = {"legal", "compliance", "personnel", "finance"}
    detected_intent = query_analysis.get("intent", "")

    if detected_intent in high_risk_intents:
        human_review = interrupt({
            "question": "ä»¥ä¸‹ã®å›ç­”ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ",
            "draft_answer": answer,
            "risk_reason": f"æ¤œå‡ºã•ã‚ŒãŸæ„å›³: {detected_intent}",
        })
        if human_review.get("approved"):
            return {"messages": [{"role": "assistant", "content": answer}]}
        correction = human_review.get("correction", "")
        return {"messages": [{"role": "assistant", "content": f"[ä¿®æ­£æ¸ˆã¿] {correction}"}]}

    return {"messages": [{"role": "assistant", "content": answer}]}
```

### RAGASã«ã‚ˆã‚‹å®šé‡è©•ä¾¡

RAGASãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã„ã€ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã®å°å…¥åŠ¹æœã‚’å®šé‡çš„ã«æ¸¬å®šã—ã¾ã—ãŸã€‚

| æ§‹æˆ | Faithfulness | Answer Relevancy | Context Precision | Context Recall |
|------|-------------|-----------------|-------------------|----------------|
| Naive RAGï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã®ã¿ï¼‰ | 0.52 | 0.48 | 0.35 | 0.41 |
| Agentic RAGï¼ˆå˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ | 0.62 | 0.58 | 0.45 | 0.55 |
| **ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGï¼ˆæœ¬è¨˜äº‹ï¼‰** | **0.91** | **0.87** | **0.94** | **0.82** |

**Context Precisionã®åŠ‡çš„ãªæ”¹å–„ï¼ˆ0.35â†’0.94ï¼‰** ã¯ã€Query Analyzerã¨Rerankerã®2æ®µéšãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒåŠ¹ã„ã¦ã„ã¾ã™ã€‚Naive RAGã§ã¯ç„¡é–¢ä¿‚ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå¤§é‡ã«æ··å…¥ã—ã¦ã„ã¾ã—ãŸãŒã€ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆã§ã¯æ¤œç´¢å¯¾è±¡ã®æ®µéšçš„ãªçµã‚Šè¾¼ã¿ãŒå¯èƒ½ã§ã™ã€‚

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| `create_supervisor`ãŒImportError | `langgraph`æœ¬ä½“ã«ã¯ãªã„ | `uv add langgraph-supervisor`ã§åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« |
| SupervisorãŒåŒã˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç„¡é™ãƒ«ãƒ¼ãƒ— | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒæ›–æ˜§ | Supervisorãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œæœ€å¤§3å›ã¾ã§ã€ç­‰ã®åˆ¶é™ã‚’æ˜è¨˜ |
| RerankingãŒé…ã„ï¼ˆ>500msï¼‰ | CPUã§å¤§é‡ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç† | å€™è£œæ•°ã‚’50â†’30ã«å‰Šæ¸›ã€ã¾ãŸã¯GPUç’°å¢ƒã‚’ä½¿ç”¨ |
| Adaptive Thinkingã§å›ç­”å“è³ªä½ä¸‹ | budget_tokensãŒå°ã•ã™ãã‚‹ | complexã‚¯ã‚¨ãƒªã®budgetã‚’10240ä»¥ä¸Šã«è¨­å®š |
| Durable Stateå¾©æ—§æ™‚ã«ã‚¨ãƒ©ãƒ¼ | ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆDBã®æ¥ç¶šåˆ‡ã‚Œ | PostgreSQLã®æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª |
| ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã§å›ºæœ‰åè©ãƒŸã‚¹ | Denseæ¤œç´¢ãŒã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§èª¤ãƒãƒƒãƒ | alphaå€¤ã‚’0.3-0.4ã«èª¿æ•´ã—BM25ã®é‡ã¿ã‚’å¢—ã‚„ã™ |

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**

- LangGraph 1.0ã®`create_supervisor()`ã§4ã¤ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆQuery Analyzer, Retriever, Reranker, Synthesizerï¼‰ã‚’å”èª¿ã•ã›ã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã‚’æ§‹ç¯‰ã—ã¾ã—ãŸ
- Claude Sonnet 4.6ã®Adaptive Thinkingã«ã‚ˆã‚Šã€ã‚¯ã‚¨ãƒªè¤‡é›‘åº¦ã«å¿œã˜ãŸæ¨è«–æ·±åº¦ã®å‹•çš„åˆ¶å¾¡ã‚’å®Ÿç¾ã—ã€simpleã‚¯ã‚¨ãƒªã®å¿œç­”æ™‚é–“ã‚’75%çŸ­ç¸®ã—ã¾ã—ãŸ
- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã¨Cross-Encoder Rerankingã®3æ®µéšãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã€Context Precisionã‚’0.45â†’0.94ï¼ˆ2.1å€ï¼‰ã«æ”¹å–„ã—ã¾ã—ãŸ
- Durable Stateã¨Human-in-the-loopã§æœ¬ç•ªé‹ç”¨ã«è€ãˆã‚‹éšœå®³å¾©æ—§ã¨å“è³ªä¿è¨¼ã‚’å®Ÿè£…ã—ã¾ã—ãŸ

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**

- **è©•ä¾¡ã‚»ãƒƒãƒˆã®æ‹¡å……**: 100ä»¶ã®ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚’500ä»¶ã«æ‹¡å¤§ã—ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆå¤šè¨€èªã‚¯ã‚¨ãƒªã€è¡¨å½¢å¼ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢ï¼‰ã‚’è¿½åŠ ã™ã‚‹
- **Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ¯”è¼ƒæ¤œè¨¼**: æŸ”è»Ÿãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå”èª¿ãŒå¿…è¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ€§èƒ½ã‚’æ¤œè¨¼ã™ã‚‹
- **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: simpleã‚¯ã‚¨ãƒªã«ã¯Haiku 4.5ã‚’ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å°å…¥ã™ã‚‹

:::message
é–¢é€£è¨˜äº‹:
- [LangGraph Agentic RAGã®æœ¬ç•ªé‹ç”¨è¨­è¨ˆ](https://zenn.dev/0h_n0/articles/f15c5b29dc16ed) â€” å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Agentic RAGãƒ‘ã‚¿ãƒ¼ãƒ³ã®è©³ç´°
- [LangGraph Agentic RAGã§ç¤¾å†…æ¤œç´¢ã®å›ç­”ç²¾åº¦ã‚’78%æ”¹å–„](https://zenn.dev/0h_n0/articles/4c869d366e5200) â€” åŸºæœ¬çš„ãªCRAGãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…
:::

## å‚è€ƒ

- [LangGraph å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: Agentic RAG](https://docs.langchain.com/oss/python/langgraph/agentic-rag)
- [langgraph-supervisor GitHub ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/langchain-ai/langgraph-supervisor-py)
- [Introducing Claude Sonnet 4.6 (Anthropic)](https://www.anthropic.com/news/claude-sonnet-4-6)
- [Optimizing RAG with Hybrid Search & Reranking (VectorHub)](https://superlinked.com/vectorhub/articles/optimizing-rag-with-hybrid-search-reranking)
- [Cross-Encoder Reranking Improves RAG Accuracy (Ailog)](https://app.ailog.fr/en/blog/news/reranking-cross-encoders-study)
- [Benchmarking Multi-Agent Architectures (LangChain Blog)](https://blog.langchain.com/benchmarking-multi-agent-architectures/)
- [RAGAS: Evaluation Framework for RAG](https://docs.ragas.io/)

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
