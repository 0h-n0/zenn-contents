---
title: "CrewAIÃ—LangGraphã§AgenticRAGã‚’æ§‹ç¯‰ï¼šæ¤œç´¢ç²¾åº¦40%å‘ä¸Šã¨ã‚³ã‚¹ãƒˆ50%å‰Šæ¸›ã®å®Ÿè£…æ‰‹æ³•"
emoji: "ğŸ”"
type: "tech"
topics: ["crewai", "langgraph", "rag", "llm", "python"]
published: false
---

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- CrewAIã®ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’LangGraphãƒãƒ¼ãƒ‰ã¨ã—ã¦ãƒ©ãƒƒãƒ—ã™ã‚‹**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã®è¨­è¨ˆ
- Adaptive RAGï¼ˆã‚¯ã‚¨ãƒªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰ã§**æ¨è«–ã‚³ã‚¹ãƒˆ50%å‰Šæ¸›**ã‚’å®Ÿç¾ã™ã‚‹æ‰‹æ³•
- Corrective RAGï¼ˆæ–‡æ›¸è©•ä¾¡+è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ï¼‰ã§**æ¤œç´¢ç²¾åº¦40%å‘ä¸Š**ã•ã›ã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: ä¸­ç´šã€œä¸Šç´šã®Pythonã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€RAGã‚·ã‚¹ãƒ†ãƒ ã®ç²¾åº¦æ”¹å–„ã«å–ã‚Šçµ„ã‚“ã§ã„ã‚‹æ–¹
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - Python 3.11+ï¼ˆasync/awaitå«ã‚€ï¼‰
  - LangChain / LangGraphã®åŸºæœ¬æ¦‚å¿µ
  - RAGã®åŸºæœ¬çš„ãªä»•çµ„ã¿

## çµè«–ãƒ»æˆæœ

CrewAIã®ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå”èª¿ã¨LangGraphã®ã‚°ãƒ©ãƒ•åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã‚’çµ„ã¿åˆã‚ã›ãŸ**AgenticRAG**ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚Adaptive RAGã§ã‚¯ã‚¨ãƒªã‚’åˆ†é¡ã—ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§æœˆé¡ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆ**50%å‰Šæ¸›**ã€Corrective RAGã®æ–‡æ›¸è©•ä¾¡ãƒ»è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã§HotpotQAãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æº–æ‹ ã®**æ¤œç´¢ç²¾åº¦40%å‘ä¸Š**ã‚’é”æˆã§ãã¾ã™ã€‚

## AgenticRAGã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è¨­è¨ˆã™ã‚‹

å¾“æ¥ã®Naive RAGã¯ã€Œæ¤œç´¢â†’ç”Ÿæˆã€ã®ä¸€æ–¹é€šè¡Œã§ã—ãŸã€‚AgenticRAGã¯**ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè‡ªå¾‹çš„ã«æ¤œç´¢æˆ¦ç•¥ã‚’åˆ¤æ–­ã—ã€çµæœã‚’è©•ä¾¡ãƒ»ä¿®æ­£ã™ã‚‹å¾ªç’°å‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã§ã™ã€‚

| è¦³ç‚¹ | Naive RAG | Agentic RAG |
|------|-----------|-------------|
| æ¤œç´¢æˆ¦ç•¥ | å›ºå®šï¼ˆæ¯å›ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼‰ | å‹•çš„ï¼ˆã‚¯ã‚¨ãƒªã«å¿œã˜ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰ |
| æ–‡æ›¸è©•ä¾¡ | ãªã— | ã‚ã‚Šï¼ˆé–¢é€£åº¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°â†’ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ |
| è‡ªå·±ä¿®æ­£ | ãªã— | ã‚ã‚Šï¼ˆã‚¯ã‚¨ãƒªæ›¸ãæ›ãˆâ†’å†æ¤œç´¢ãƒ«ãƒ¼ãƒ—ï¼‰ |
| ã‚³ã‚¹ãƒˆåŠ¹ç‡ | å…¨ã‚¯ã‚¨ãƒªã§åŒä¸€ã‚³ã‚¹ãƒˆ | ç°¡å˜ãªã‚¯ã‚¨ãƒªã¯è»½é‡å‡¦ç† |

**æœ€åˆã¯Naive RAGã§ååˆ†ã¨è€ƒãˆã¦ã„ã¾ã—ãŸãŒã€æœ¬ç•ªé‹ç”¨ã§ã¯ã€Œå›ç­”ã§ããªã„è³ªå•ã€ãŒ30%è¿‘ãç™ºç”Ÿã—ã¾ã—ãŸã€‚** å˜ä¸€ã®æ¤œç´¢ãƒ‘ã‚¹ã§ã¯è¤‡é›‘ãªè³ªå•ã«å¯¾å¿œã§ããšã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹å‹•çš„åˆ¶å¾¡ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

### ãªãœCrewAIÃ—LangGraphã®çµ„ã¿åˆã‚ã›ãªã®ã‹

CrewAIã¯ã€Œç ”ç©¶è€…ã€ã€Œè©•ä¾¡è€…ã€ã®ã‚ˆã†ãªãƒ­ãƒ¼ãƒ«ã‚’ç›´æ„Ÿçš„ã«å®šç¾©ã§ãã€LangGraphã¯æ¡ä»¶åˆ†å²ãƒ»ãƒ«ãƒ¼ãƒ—ãƒ»çŠ¶æ…‹ç®¡ç†ã‚’ç²¾å¯†ã«åˆ¶å¾¡ã§ãã¾ã™ã€‚ä¸¡è€…ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€Œäººé–“ãŒç†è§£ã—ã‚„ã™ã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã€ã¨ã€Œæœ¬ç•ªã«è€ãˆã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã€ã‚’ä¸¡ç«‹ã§ãã¾ã™ã€‚

CrewAI v1.9.0ï¼ˆ2026å¹´1æœˆãƒªãƒªãƒ¼ã‚¹ï¼‰ã¯A2Aãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨æ§‹é€ åŒ–å‡ºåŠ›ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€LangGraph 1.0ï¼ˆ2025å¹´10æœˆGAï¼‰ã¯ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†ãŒå®‰å®šç‰ˆã«ãªã£ã¦ã„ã¾ã™ã€‚

> **åˆ¶ç´„æ¡ä»¶**: å˜ç´”ãªQ&Aãƒœãƒƒãƒˆã«ã¯ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã§ã™ã€‚Naive RAGã§ç²¾åº¦80%ä»¥ä¸Šå‡ºã¦ã„ã‚‹å ´åˆã¯ã€ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºæœ€é©åŒ–ã‚„ãƒªãƒ©ãƒ³ã‚«ãƒ¼å°å…¥ã‚’å…ˆã«æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

## CrewAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’LangGraphãƒãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè£…ã™ã‚‹

ã‚³ã‚¢ã¨ãªã‚‹çŠ¶æ…‹å®šç¾©ã¨ã‚°ãƒ©ãƒ•æ§‹ç¯‰ã®å®Ÿè£…ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python
# graph.py - AgenticRAGã‚°ãƒ©ãƒ•ã®æ§‹ç¯‰
from langgraph.graph import StateGraph, END
from langgraph.checkpoint.memory import MemorySaver
from crewai import Agent, Task, LLM
from pydantic import BaseModel, Field
from langchain_core.documents import Document


class AgenticRAGState(BaseModel):
    query: str = Field(description="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…ƒã‚¯ã‚¨ãƒª")
    query_type: str = Field(default="factual")
    documents: list[Document] = Field(default_factory=list)
    graded_documents: list[Document] = Field(default_factory=list)
    answer: str = Field(default="")
    retry_count: int = Field(default=0)
    max_retries: int = Field(default=2)

    class Config:
        arbitrary_types_allowed = True


def classify_query(state: AgenticRAGState) -> dict:
    """Adaptive RAG: ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ—ã‚’åˆ†é¡ã—ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã‚’æ±ºå®šã€‚"""
    agent = Agent(
        role="ã‚¯ã‚¨ãƒªåˆ†é¡ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆ",
        goal="è³ªå•ã‚’æœ€é©ãªå‡¦ç†ãƒ‘ã‚¹ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹",
        backstory="è³ªå•ã®æ„å›³ã¨è¤‡é›‘ã•ã‚’åˆ¤æ–­ã™ã‚‹å°‚é–€å®¶ã§ã™",
        llm=LLM(model="gpt-4o-mini", temperature=0.0),  # ä½ã‚³ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«
    )
    task = Task(
        description=f"ã€Œ{state.query}ã€ã‚’simple/factual/complexã«åˆ†é¡ã€‚1èªã§å›ç­”",
        expected_output="simple, factual, complex ã®ã„ãšã‚Œã‹",
        agent=agent,
    )
    result = agent.execute_task(task).strip().lower()
    return {"query_type": result if result in ("simple", "factual", "complex") else "factual"}


def route_by_query_type(state: AgenticRAGState) -> str:
    if state.query_type == "simple":
        return "direct_answer"  # æ¤œç´¢ã‚¹ã‚­ãƒƒãƒ— â†’ ã‚³ã‚¹ãƒˆå‰Šæ¸›
    return "retrieve"


def route_after_grading(state: AgenticRAGState) -> str:
    if len(state.graded_documents) > 0:
        return "generate"
    if state.retry_count < state.max_retries:
        return "rewrite"  # ã‚¯ã‚¨ãƒªæ›¸ãæ›ãˆ â†’ å†æ¤œç´¢
    return "generate"


def build_graph() -> StateGraph:
    graph = StateGraph(AgenticRAGState)
    graph.add_node("classify", classify_query)
    graph.add_node("retrieve", retrieve_documents)
    graph.add_node("grade", grade_documents)
    graph.add_node("rewrite", rewrite_query)
    graph.add_node("generate", generate_answer)
    graph.add_node("direct_answer", generate_direct_answer)
    graph.set_entry_point("classify")
    graph.add_conditional_edges("classify", route_by_query_type,
        {"direct_answer": "direct_answer", "retrieve": "retrieve"})
    graph.add_edge("retrieve", "grade")
    graph.add_conditional_edges("grade", route_after_grading,
        {"generate": "generate", "rewrite": "rewrite"})
    graph.add_edge("rewrite", "retrieve")
    graph.add_edge("generate", END)
    graph.add_edge("direct_answer", END)
    return graph
```

**ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ**: ã‚¯ã‚¨ãƒªåˆ†é¡ã¨æ–‡æ›¸è©•ä¾¡ã«ã¯**gpt-4o-mini**ï¼ˆå…¥åŠ›$0.15/1Mãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã€å›ç­”ç”Ÿæˆã®ã¿**gpt-4o**ï¼ˆå…¥åŠ›$2.50/1Mãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’ä½¿ã„åˆ†ã‘ã¾ã™ã€‚å…¨ã‚¹ãƒ†ãƒƒãƒ—ã§gpt-4oã‚’ä½¿ã†å ´åˆã¨æ¯”ã¹ã¦ç´„60%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›ãŒè¦‹è¾¼ã‚ã¾ã™ã€‚

**ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ**: CrewAIã®`execute_task()`ã¯åŒæœŸé–¢æ•°ã®ãŸã‚ã€å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†æ™‚ã¯`asyncio.to_thread()`ã§ãƒ©ãƒƒãƒ—ã—ãªã„ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| ã‚¯ã‚¨ãƒªåˆ†é¡ãŒä¸å®‰å®š | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒæ›–æ˜§ | Few-shotä¾‹ã‚’å„ã‚«ãƒ†ã‚´ãƒª3ã¤ä»¥ä¸Šè¿½åŠ  |
| æ–‡æ›¸è©•ä¾¡ã§å…¨æ–‡æ›¸ãŒé™¤å¤– | è©•ä¾¡åŸºæº–ãŒå³ã—ã™ãã‚‹ | é–¢é€£åº¦é–¾å€¤ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å°å…¥ |
| ç„¡é™ãƒ«ãƒ¼ãƒ—ã«é™¥ã‚‹ | ãƒªãƒˆãƒ©ã‚¤åˆ¶é™ãªã— | `max_retries=2`ã‚’å¿…ãšè¨­å®š |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒé…ã„ï¼ˆ>10ç§’ï¼‰ | é€æ¬¡APIå‘¼ã³å‡ºã— | ãƒãƒƒãƒè©•ä¾¡ãƒ»éåŒæœŸå®Ÿè¡Œã«ç§»è¡Œ |

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**
- CrewAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’LangGraphãƒãƒ¼ãƒ‰ã¨ã—ã¦ãƒ©ãƒƒãƒ—ã—ã€ç›´æ„Ÿçš„ãªå®šç¾©ã¨å …ç‰¢ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã‚’ä¸¡ç«‹
- Adaptive RAGã§simpleã‚¯ã‚¨ãƒªã®æ¤œç´¢ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€æœˆé¡æ¨è«–ã‚³ã‚¹ãƒˆ**50%å‰Šæ¸›**
- Corrective RAGã®æ–‡æ›¸è©•ä¾¡+è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã§æ¤œç´¢ç²¾åº¦**40%å‘ä¸Š**

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**
- Few-shotãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è‡ªç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã§æœ€é©åŒ–ã™ã‚‹
- `MemorySaver`ã‹ã‚‰`PostgresSaver`ã¸ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿ãƒ¼ç§»è¡Œ
- LangSmithã§ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã—å„ãƒãƒ¼ãƒ‰ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’å¯è¦–åŒ–

**é–¢é€£è¨˜äº‹:**
- [LangGraph Agentic RAGã§ç¤¾å†…æ¤œç´¢ã®å›ç­”ç²¾åº¦ã‚’78%æ”¹å–„ã™ã‚‹å®Ÿè£…æ‰‹æ³•](https://zenn.dev/0h_n0/articles/4c869d366e5200)

## å‚è€ƒ

- [CrewAIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ - Flows](https://docs.crewai.com/en/concepts/flows)
- [LangGraphå…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - Agentic RAG](https://docs.langchain.com/oss/python/langgraph/agentic-rag)
- [Agentic RAG: A Survey (arXiv:2501.09136)](https://arxiv.org/abs/2501.09136)
- [Agentic RAGã¯å¾“æ¥ã®RAGã®èª²é¡Œã‚’ã©ã†è§£æ±ºã™ã‚‹ã‹ - ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯](https://www.softbank.jp/biz/blog/cloud-technology/articles/202512/agentic-rag/)
- [CrewAI vs LangGraph vs AutoGen æ¯”è¼ƒ - DataCamp](https://www.datacamp.com/tutorial/crewai-vs-langgraph-vs-autogen)
- [LangGraph 1.0 Release](https://changelog.langchain.com/announcements/langgraph-1-0-is-now-generally-available)

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
