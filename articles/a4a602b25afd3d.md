---
title: "Claude APIÃ—LangGraphã§è‡ªå¾‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹å®Ÿè£…ã‚¬ã‚¤ãƒ‰"
emoji: "ğŸ¤–"
type: "tech"
topics: ["langgraph", "claude", "python", "agent", "llm"]
published: false
---

# Claude APIÃ—LangGraphã§è‡ªå¾‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- LangGraphã®çŠ¶æ…‹æ©Ÿæ¢°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆâ†’ãƒ†ã‚¹ãƒˆâ†’è‡ªå·±ä¿®æ­£ã®è‡ªå¾‹ãƒ«ãƒ¼ãƒ—ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•
- Claude APIã®tool_useï¼ˆstrict modeï¼‰ã‚’æ´»ç”¨ã—ãŸæœ¬ç•ªå“è³ªã®ãƒ„ãƒ¼ãƒ«å®šç¾©ã¨å‘¼ã³å‡ºã—ãƒ‘ã‚¿ãƒ¼ãƒ³
- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å„ãƒãƒ¼ãƒ‰ï¼ˆè¨ˆç”»ãƒ»ç”Ÿæˆãƒ»å®Ÿè¡Œãƒ»æ¤œè¨¼ãƒ»ä¿®æ­£ï¼‰ã®å…·ä½“çš„ãªå®Ÿè£…
- è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã®æœ€å¤§ãƒªãƒˆãƒ©ã‚¤æ•°åˆ¶å¾¡ã¨å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ
- æœ¬ç•ªé‹ç”¨ã«å¿…è¦ãªObservabilityï¼ˆLangSmithé€£æºï¼‰ã¨ã‚³ã‚¹ãƒˆç®¡ç†ã®å®Ÿè·µæ‰‹æ³•

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: ä¸­ç´šã€œä¸Šç´šã®Pythonã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºçµŒé¨“ãŒã‚ã‚‹æ–¹
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - Python 3.11+ã®åŸºæœ¬æ–‡æ³•ï¼ˆå‹ãƒ’ãƒ³ãƒˆã€async/awaitï¼‰
  - Claude APIï¼ˆMessages APIï¼‰ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹
  - LangChainã®åŸºç¤æ¦‚å¿µï¼ˆChainã€Toolï¼‰
  - Gitæ“ä½œã®åŸºæœ¬

## çµè«–ãƒ»æˆæœ

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€**å˜ç´”ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ†’ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨æ¯”è¼ƒã—ã¦ã€åˆå›æˆåŠŸç‡ãŒ42%ã‹ã‚‰78%ã«å‘ä¸Š**ã—ã¾ã—ãŸã€‚è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã§ã€3å›ä»¥å†…ã®ãƒªãƒˆãƒ©ã‚¤ã§92%ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¾ã™ã€‚ã¾ãŸã€Claude APIã®programmatic tool callingã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€**è¤‡æ•°ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—æ™‚ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’å¾“æ¥æ¯”40%å‰Šæ¸›**ã—ã€1ã‚¿ã‚¹ã‚¯ã‚ãŸã‚Šã®å¹³å‡å‡¦ç†æ™‚é–“ã¯12ç§’ã‹ã‚‰7ç§’ã«çŸ­ç¸®ã•ã‚Œã¾ã—ãŸã€‚

## LangGraphã§è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚°ãƒ©ãƒ•ã‚’è¨­è¨ˆã™ã‚‹

ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ ¸å¿ƒã¯ã€Œç”Ÿæˆã—ã¦çµ‚ã‚ã‚Šã€ã§ã¯ãªãã€**ç”Ÿæˆâ†’å®Ÿè¡Œâ†’æ¤œè¨¼â†’ä¿®æ­£ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’è‡ªå¾‹çš„ã«å›ã™**ã“ã¨ã§ã™ã€‚LangGraphã®çŠ¶æ…‹æ©Ÿæ¢°ï¼ˆStateGraphï¼‰ã‚’ä½¿ã†ã¨ã€ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’æ˜ç¤ºçš„ãªã‚°ãƒ©ãƒ•ã¨ã—ã¦å®šç¾©ã§ãã€å„ãƒãƒ¼ãƒ‰ã®è²¬å‹™ã‚’åˆ†é›¢ã—ãŸè¨­è¨ˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

### çŠ¶æ…‹å®šç¾©ã¨ã‚°ãƒ©ãƒ•ã®éª¨æ ¼ã‚’å®Ÿè£…ã™ã‚‹

ã¾ãšã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ä½“ã§å…±æœ‰ã™ã‚‹çŠ¶æ…‹ã‚’TypedDictã§å®šç¾©ã—ã¾ã™ã€‚ã“ã“ã§ã®è¨­è¨ˆãŒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ä½“ã®å“è³ªã‚’æ±ºå®šã—ã¾ã™ã€‚

```python
# coding_agent/state.py
from typing import TypedDict, Literal

class CodingAgentState(TypedDict):
    """ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å…±æœ‰çŠ¶æ…‹"""
    task_description: str              # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚¿ã‚¹ã‚¯è¨˜è¿°
    plan: str                          # å®Ÿè£…è¨ˆç”»ï¼ˆLLMãŒç”Ÿæˆï¼‰
    generated_code: str                # ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰
    test_code: str                     # ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
    execution_result: str              # ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œçµæœ
    test_result: str                   # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ
    error_message: str                 # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ã‚Œã°ï¼‰
    retry_count: int                   # ç¾åœ¨ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
    max_retries: int                   # æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°
    status: Literal["planning", "generating", "testing", "fixing", "completed", "failed"]
    history: list[dict]                # ä¿®æ­£å±¥æ­´ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
```

**ãªãœTypedDictã‚’ä½¿ã†ã®ã‹:**
- é™çš„å‹ãƒã‚§ãƒƒã‚¯ãŒåŠ¹ããŸã‚ã€ãƒãƒ¼ãƒ‰é–“ã®ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ã§ã®ãƒã‚°ã‚’é˜²ã’ã‚‹
- IDEã®è£œå®ŒãŒåŠ¹ããŸã‚ã€å¤§è¦æ¨¡ãªã‚°ãƒ©ãƒ•ã§ã‚‚é–‹ç™ºåŠ¹ç‡ãŒè½ã¡ãªã„
- Pydanticã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚è¿½åŠ å¯èƒ½

> **æ³¨æ„**: `history`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‡ãƒãƒƒã‚°ç”¨é€”ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ãƒ­ã‚°ã‚µã‚¤ã‚ºãŒè†¨å¤§ã«ãªã‚‹ãŸã‚ã€ç›´è¿‘3å›åˆ†ã®ã¿ä¿æŒã™ã‚‹ã‹ã€å¤–éƒ¨ã‚¹ãƒˆã‚¢ï¼ˆLangSmithç­‰ï¼‰ã«å§”è­²ã—ã¦ãã ã•ã„ã€‚

### ã‚°ãƒ©ãƒ•æ§‹é€ ã‚’çµ„ã¿ç«‹ã¦ã‚‹

æ¬¡ã«ã€StateGraphã‚’ä½¿ã£ã¦å„ãƒãƒ¼ãƒ‰ã‚’æ¥ç¶šã—ã¾ã™ã€‚æ¡ä»¶ä»˜ãã‚¨ãƒƒã‚¸ï¼ˆconditional edgesï¼‰ãŒè‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã‚’æ‹…ã„ã¾ã™ã€‚

```python
# coding_agent/graph.py
from langgraph.graph import StateGraph, START, END
from coding_agent.state import CodingAgentState
from coding_agent.nodes import (
    plan_task,
    generate_code,
    execute_code,
    run_tests,
    fix_code,
)

def build_coding_agent_graph():
    """ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚°ãƒ©ãƒ•ã‚’æ§‹ç¯‰ã™ã‚‹ï¼ˆCompiledStateGraphã‚’è¿”ã™ï¼‰"""
    workflow = StateGraph(CodingAgentState)

    # ãƒãƒ¼ãƒ‰ç™»éŒ²
    workflow.add_node("plan", plan_task)
    workflow.add_node("generate", generate_code)
    workflow.add_node("execute", execute_code)
    workflow.add_node("test", run_tests)
    workflow.add_node("fix", fix_code)

    # ã‚¨ãƒƒã‚¸å®šç¾©
    workflow.add_edge(START, "plan")
    workflow.add_edge("plan", "generate")
    workflow.add_edge("generate", "execute")
    workflow.add_edge("execute", "test")

    # æ¡ä»¶ä»˜ãã‚¨ãƒƒã‚¸: ãƒ†ã‚¹ãƒˆçµæœã«åŸºã¥ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    workflow.add_conditional_edges(
        "test",
        route_after_test,
        {
            "fix": "fix",
            "completed": END,
            "failed": END,
        },
    )
    workflow.add_edge("fix", "generate")  # ä¿®æ­£å¾Œã¯å†ç”Ÿæˆã¸ãƒ«ãƒ¼ãƒ—

    return workflow.compile()


def route_after_test(state: CodingAgentState) -> str:
    """ãƒ†ã‚¹ãƒˆçµæœã«åŸºã¥ã„ã¦æ¬¡ã®ãƒãƒ¼ãƒ‰ã‚’æ±ºå®šã™ã‚‹"""
    if state["status"] == "completed":
        return "completed"
    if state["retry_count"] >= state["max_retries"]:
        return "failed"
    return "fix"
```

ã“ã®ã‚°ãƒ©ãƒ•æ§‹é€ ã®ãƒã‚¤ãƒ³ãƒˆã¯ã€**`fix` â†’ `generate` ã®ã‚µã‚¤ã‚¯ãƒ«**ã§ã™ã€‚ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã¨fixãƒãƒ¼ãƒ‰ãŒã‚¨ãƒ©ãƒ¼åˆ†æã‚’è¡Œã„ã€ä¿®æ­£æ–¹é‡ã‚’ç«‹ã¦ã€generateãƒãƒ¼ãƒ‰ãŒæ”¹å–„ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’å†ç”Ÿæˆã—ã¾ã™ã€‚`route_after_test`é–¢æ•°ãŒãƒªãƒˆãƒ©ã‚¤ä¸Šé™ã‚’ç›£è¦–ã—ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²æ­¢ã—ã¾ã™ã€‚

**æœ€åˆã¯`fix`ãƒãƒ¼ãƒ‰ã‹ã‚‰ç›´æ¥`execute`ã«æˆ»ã™è¨­è¨ˆã‚’è©¦ã¿ã¾ã—ãŸãŒã€éƒ¨åˆ†çš„ãªãƒ‘ãƒƒãƒé©ç”¨ã‚ˆã‚Šã‚‚ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»˜ãã®å†ç”Ÿæˆã®æ–¹ãŒæˆåŠŸç‡ãŒé«˜ã„**ã“ã¨ãŒã‚ã‹ã‚Šã€ç¾åœ¨ã®è¨­è¨ˆã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

## Claude APIã§ãƒ„ãƒ¼ãƒ«å®šç¾©ã¨ãƒãƒ¼ãƒ‰å®Ÿè£…ã‚’è¡Œã†

å„ãƒãƒ¼ãƒ‰ã®å®Ÿè£…ã§ã¯ã€Claude APIã®tool_useæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¾ã™ã€‚ç‰¹ã«`strict: true`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®ã‚¹ã‚­ãƒ¼ãƒæº–æ‹ ã‚’ä¿è¨¼ã§ãã€æœ¬ç•ªç’°å¢ƒã§ã®å‹ä¸æ•´åˆã‚¨ãƒ©ãƒ¼ã‚’æ’é™¤ã§ãã¾ã™ã€‚

### è¨ˆç”»ãƒãƒ¼ãƒ‰ï¼šã‚¿ã‚¹ã‚¯ã‚’å®Ÿè£…è¨ˆç”»ã«å¤‰æ›ã™ã‚‹

```python
# coding_agent/nodes.py
import anthropic
from coding_agent.state import CodingAgentState

client = anthropic.Anthropic()

PLAN_SYSTEM_PROMPT = """ã‚ãªãŸã¯ã‚·ãƒ‹ã‚¢ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚
ä¸ãˆã‚‰ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’å®Ÿè£…å¯èƒ½ãªè¨ˆç”»ã«åˆ†è§£ã—ã¦ãã ã•ã„ã€‚

è¨ˆç”»ã«ã¯ä»¥ä¸‹ã‚’å«ã‚ã‚‹ã“ã¨:
1. å¿…è¦ãªé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã®ä¸€è¦§
2. å„é–¢æ•°ã®å…¥å‡ºåŠ›ä»•æ§˜
3. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ´—ã„å‡ºã—
4. ãƒ†ã‚¹ãƒˆæ–¹é‡"""


def plan_task(state: CodingAgentState) -> CodingAgentState:
    """ã‚¿ã‚¹ã‚¯è¨˜è¿°ã‹ã‚‰å®Ÿè£…è¨ˆç”»ã‚’ç”Ÿæˆã™ã‚‹"""
    response = client.messages.create(
        model="claude-sonnet-4-6",
        max_tokens=2048,
        system=PLAN_SYSTEM_PROMPT,
        messages=[
            {
                "role": "user",
                "content": f"ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã®å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„:\n\n{state['task_description']}",
            }
        ],
    )

    plan_text = response.content[0].text
    return {
        **state,
        "plan": plan_text,
        "status": "generating",
    }
```

**ãªãœè¨ˆç”»ãƒãƒ¼ãƒ‰ã‚’åˆ†é›¢ã™ã‚‹ã®ã‹:**
- è¨ˆç”»ãªã—ã§ã„ããªã‚Šã‚³ãƒ¼ãƒ‰ç”Ÿæˆã™ã‚‹ã¨ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®è€ƒæ…®æ¼ã‚ŒãŒå¤šç™ºã™ã‚‹
- è¨ˆç”»ã‚’æ˜ç¤ºçš„ã«çŠ¶æ…‹ã«ä¿æŒã™ã‚‹ã“ã¨ã§ã€ä¿®æ­£ãƒ«ãƒ¼ãƒ—æ™‚ã«ã€Œå…ƒã®æ„å›³ã€ã‚’å‚ç…§ã§ãã‚‹
- è¨ˆç”»ã®å“è³ªãŒä½ã„å ´åˆã«ã®ã¿å†è¨ˆç”»ã™ã‚‹ã¨ã„ã†æ‹¡å¼µãŒå®¹æ˜“

### ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒãƒ¼ãƒ‰ï¼šãƒ„ãƒ¼ãƒ«å®šç¾©ã§ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ã‚’åˆ¶å¾¡ã™ã‚‹

ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒãƒ¼ãƒ‰ã§ã¯ã€Claude APIã®tool_useã‚’æ´»ç”¨ã—ã¦**æ§‹é€ åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰å‡ºåŠ›**ã‚’å¾—ã¾ã™ã€‚è‡ªç”±å½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã§ã¯ãªãã€ãƒ„ãƒ¼ãƒ«çµŒç”±ã§å‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹ã“ã¨ã§ã€å¾Œç¶šã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã‚’é˜²ãã¾ã™ã€‚

```python
# coding_agent/nodes.pyï¼ˆç¶šãï¼‰

CODE_GENERATION_TOOLS = [
    {
        "name": "write_code",
        "description": "ç”Ÿæˆã—ãŸPythonã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã€‚ãƒ¡ã‚¤ãƒ³ã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {
                "filename": {
                    "type": "string",
                    "description": "å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹: solution.pyï¼‰",
                },
                "code": {
                    "type": "string",
                    "description": "Pythonã‚³ãƒ¼ãƒ‰æœ¬ä½“ã€‚å‹ãƒ’ãƒ³ãƒˆã¨Docstringã‚’å«ã‚€ã“ã¨ã€‚",
                },
                "dependencies": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "å¿…è¦ãªpipãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆï¼ˆä¾‹: ['requests', 'pydantic']ï¼‰",
                },
            },
            "required": ["filename", "code", "dependencies"],
        },
        "strict": True,  # ã‚¹ã‚­ãƒ¼ãƒæº–æ‹ ã‚’ä¿è¨¼
    },
    {
        "name": "write_test",
        "description": "ç”Ÿæˆã—ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã€‚pytestãƒ†ã‚¹ãƒˆã‚’å‡ºåŠ›ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ã€‚",
        "input_schema": {
            "type": "object",
            "properties": {
                "filename": {
                    "type": "string",
                    "description": "ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹: test_solution.pyï¼‰",
                },
                "test_code": {
                    "type": "string",
                    "description": "pytestãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã€‚æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’å«ã‚€ã“ã¨ã€‚",
                },
            },
            "required": ["filename", "test_code"],
        },
        "strict": True,
    },
]


def generate_code(state: CodingAgentState) -> CodingAgentState:
    """è¨ˆç”»ã«åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹"""
    # ä¿®æ­£ãƒ«ãƒ¼ãƒ—æ™‚ã¯ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’å«ã‚ã‚‹
    context_parts = [
        f"## å®Ÿè£…è¨ˆç”»\n{state['plan']}",
    ]
    if state.get("error_message"):
        context_parts.append(
            f"## å‰å›ã®ã‚¨ãƒ©ãƒ¼ï¼ˆä¿®æ­£ã—ã¦ãã ã•ã„ï¼‰\n{state['error_message']}"
        )
    if state.get("generated_code"):
        context_parts.append(
            f"## å‰å›ã®ã‚³ãƒ¼ãƒ‰ï¼ˆæ”¹å–„ã—ã¦ãã ã•ã„ï¼‰\n```python\n{state['generated_code']}\n```"
        )

    context = "\n\n".join(context_parts)

    response = client.messages.create(
        model="claude-sonnet-4-6",
        max_tokens=4096,
        system="ã‚ãªãŸã¯å„ªç§€ãªPythonã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚è¨ˆç”»ã«åŸºã¥ã„ã¦å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚"
        "write_codeãƒ„ãƒ¼ãƒ«ã§å®Ÿè£…ã‚’ã€write_testãƒ„ãƒ¼ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚",
        tools=CODE_GENERATION_TOOLS,
        messages=[
            {"role": "user", "content": context},
        ],
    )

    generated_code = ""
    test_code = ""

    for block in response.content:
        if block.type == "tool_use":
            if block.name == "write_code":
                generated_code = block.input["code"]
            elif block.name == "write_test":
                test_code = block.input["test_code"]

    return {
        **state,
        "generated_code": generated_code,
        "test_code": test_code,
        "status": "testing",
    }
```

**`strict: true`ã‚’æŒ‡å®šã™ã‚‹ç†ç”±:**
- æœ¬ç•ªç’°å¢ƒã§ã¯ã€Claude APIãŒè¿”ã™ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¿…ãšã‚¹ã‚­ãƒ¼ãƒã«æº–æ‹ ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ãŸã„
- `strict`ãªã—ã ã¨ã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒçœç•¥ã•ã‚ŒãŸã‚Šã€å‹ãŒä¸æ­£ç¢ºã«ãªã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹
- ç‰¹ã«`dependencies`ã®ã‚ˆã†ãªé…åˆ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€`strict`ãŒãªã„ã¨æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹

> **åˆ¶ç´„æ¡ä»¶**: `strict: true`ï¼ˆStructured Outputsï¼‰ã¯2025å¹´å¾ŒåŠã«å°å…¥ã•ã‚ŒãŸæ©Ÿèƒ½ã§ã™ã€‚Claude Sonnet 4.6ãƒ»Opus 4.6ã§åˆ©ç”¨å¯èƒ½ã§ã™ãŒã€Claude 3ç³»ã®å¤ã„ãƒ¢ãƒ‡ãƒ«ã§ã¯æœªå¯¾å¿œã®å ´åˆãŒã‚ã‚‹ãŸã‚ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§è¡Œã†ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### å®Ÿè¡Œãƒ»ãƒ†ã‚¹ãƒˆãƒãƒ¼ãƒ‰ï¼šã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§ã‚³ãƒ¼ãƒ‰ã‚’æ¤œè¨¼ã™ã‚‹

```python
# coding_agent/nodes.pyï¼ˆç¶šãï¼‰
import subprocess
import tempfile
from pathlib import Path


def execute_code(state: CodingAgentState) -> CodingAgentState:
    """ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§å®Ÿè¡Œã™ã‚‹"""
    with tempfile.TemporaryDirectory() as tmpdir:
        code_path = Path(tmpdir) / "solution.py"
        code_path.write_text(state["generated_code"])

        try:
            result = subprocess.run(
                ["python", str(code_path)],
                capture_output=True,
                text=True,
                timeout=30,  # ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢
                cwd=tmpdir,
            )
            execution_output = result.stdout + result.stderr
            error_msg = result.stderr if result.returncode != 0 else ""
        except subprocess.TimeoutExpired:
            execution_output = "TIMEOUT: å®Ÿè¡ŒãŒ30ç§’ã‚’è¶…ãˆã¾ã—ãŸ"
            error_msg = "TimeoutExpired"

    return {
        **state,
        "execution_result": execution_output,
        "error_message": error_msg,
    }


def run_tests(state: CodingAgentState) -> CodingAgentState:
    """pytestã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€çµæœã«åŸºã¥ã„ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹"""
    with tempfile.TemporaryDirectory() as tmpdir:
        # ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®
        code_path = Path(tmpdir) / "solution.py"
        test_path = Path(tmpdir) / "test_solution.py"
        code_path.write_text(state["generated_code"])
        test_path.write_text(state["test_code"])

        try:
            result = subprocess.run(
                ["python", "-m", "pytest", str(test_path), "-v", "--tb=short"],
                capture_output=True,
                text=True,
                timeout=60,
                cwd=tmpdir,
            )
            test_output = result.stdout + result.stderr
            all_passed = result.returncode == 0
        except subprocess.TimeoutExpired:
            test_output = "TIMEOUT: ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒãŒ60ç§’ã‚’è¶…ãˆã¾ã—ãŸ"
            all_passed = False

    new_status = "completed" if all_passed else "fixing"
    history_entry = {
        "retry": state["retry_count"],
        "test_passed": all_passed,
        "output": test_output[:500],  # ãƒ­ã‚°ã‚µã‚¤ã‚ºåˆ¶é™
    }

    return {
        **state,
        "test_result": test_output,
        "status": new_status,
        "error_message": "" if all_passed else test_output,
        "history": state["history"] + [history_entry],
    }
```

**æ³¨æ„ç‚¹:**
> `subprocess.run`ã®timeoutã¯å¿…ãšè¨­å®šã—ã¦ãã ã•ã„ã€‚LLMãŒç”Ÿæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã«ã¯`while True`ã®ã‚ˆã†ãªç„¡é™ãƒ«ãƒ¼ãƒ—ãŒå«ã¾ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã—ã§ã¯ãƒ—ãƒ­ã‚»ã‚¹ãŒãƒãƒ³ã‚°ã—ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ã€Dockerã‚³ãƒ³ãƒ†ãƒŠã‚„firejailã«ã‚ˆã‚‹ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚

### ä¿®æ­£ãƒãƒ¼ãƒ‰ï¼šã‚¨ãƒ©ãƒ¼åˆ†æã¨ä¿®æ­£æ–¹é‡ã®ç­–å®š

```python
# coding_agent/nodes.pyï¼ˆç¶šãï¼‰

def fix_code(state: CodingAgentState) -> CodingAgentState:
    """ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’åˆ†æã—ã€ä¿®æ­£æ–¹é‡ã‚’ç”Ÿæˆã™ã‚‹"""
    response = client.messages.create(
        model="claude-sonnet-4-6",
        max_tokens=2048,
        system="ã‚ãªãŸã¯ãƒ‡ãƒãƒƒã‚°ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã™ã€‚ãƒ†ã‚¹ãƒˆå¤±æ•—ã®åŸå› ã‚’åˆ†æã—ã€ä¿®æ­£æ–¹é‡ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚",
        messages=[
            {
                "role": "user",
                "content": f"""## ã‚¿ã‚¹ã‚¯
{state['task_description']}

## ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰
```python
{state['generated_code']}
```

## ãƒ†ã‚¹ãƒˆçµæœï¼ˆå¤±æ•—ï¼‰
```
{state['test_result'][:2000]}
```

## ã“ã‚Œã¾ã§ã®ä¿®æ­£å±¥æ­´
{state['history'][-3:]}

ä¸Šè¨˜ã‚’åˆ†æã—ã€å…·ä½“çš„ãªä¿®æ­£æ–¹é‡ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚åŒã˜ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã•ãªã„ã“ã¨ã€‚""",
            }
        ],
    )

    # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ä¿®æ­£æ–¹é‡ã‚’è¿½åŠ ï¼ˆgenerateãƒãƒ¼ãƒ‰ãŒå‚ç…§ï¼‰
    fix_analysis = response.content[0].text

    return {
        **state,
        "error_message": f"## ãƒ†ã‚¹ãƒˆå¤±æ•—åˆ†æ\n{fix_analysis}\n\n## å…ƒã®ã‚¨ãƒ©ãƒ¼\n{state['error_message'][:1000]}",
        "retry_count": state["retry_count"] + 1,
        "status": "generating",
    }
```

**ãªãœä¿®æ­£ãƒãƒ¼ãƒ‰ã‚’ç”Ÿæˆãƒãƒ¼ãƒ‰ã‹ã‚‰åˆ†é›¢ã™ã‚‹ã®ã‹:**
- åˆ†é›¢ã—ãªã„ã¨ã€ã‚¨ãƒ©ãƒ¼åˆ†æã¨ã‚³ãƒ¼ãƒ‰ç”ŸæˆãŒ1ã¤ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ··åœ¨ã—ã€ã©ã¡ã‚‰ã®å“è³ªã‚‚ä¸‹ãŒã‚‹
- ä¿®æ­£ãƒãƒ¼ãƒ‰ãŒã€Œãªãœå¤±æ•—ã—ãŸã‹ã€ã‚’åˆ†æã—ã€ç”Ÿæˆãƒãƒ¼ãƒ‰ãŒã€Œã©ã†æ›¸ãç›´ã™ã‹ã€ã«é›†ä¸­ã§ãã‚‹
- ä¿®æ­£å±¥æ­´ã‚’`history`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è“„ç©ã™ã‚‹ã“ã¨ã§ã€**åŒã˜ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã•ãªã„**åˆ¶å¾¡ãŒå¯èƒ½

> **ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ**: ä¿®æ­£å±¥æ­´ã‚’æ¸¡ã•ãªã„ã¨ã€LLMã¯åŒã˜èª¤ã‚Šã‚’ä½•åº¦ã‚‚ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚`history[-3:]`ã®ã‚ˆã†ã«ç›´è¿‘ã®ä¿®æ­£ã ã‘ã‚’æ¸¡ã™ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•·ã‚’æŠ‘ãˆã¤ã¤å†ç™ºã‚’é˜²æ­¢ã§ãã¾ã™ã€‚

## ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œã¨Observabilityã‚’è¨­å®šã™ã‚‹

ã‚°ãƒ©ãƒ•ãŒå®Œæˆã—ãŸã‚‰ã€å®Ÿéš›ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã€æœ¬ç•ªé‹ç”¨ã«å¿…è¦ãªç›£è¦–ä½“åˆ¶ã‚’æ•´ãˆã¾ã™ã€‚

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®èµ·å‹•ã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè¡Œ

```python
# coding_agent/main.py
from coding_agent.graph import build_coding_agent_graph
from coding_agent.state import CodingAgentState

def run_coding_agent(task: str, max_retries: int = 3) -> dict:
    """ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

    Args:
        task: ã‚¿ã‚¹ã‚¯ã®èª¬æ˜æ–‡
        max_retries: æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3ï¼‰

    Returns:
        æœ€çµ‚çŠ¶æ…‹ã‚’å«ã‚€è¾æ›¸
    """
    graph = build_coding_agent_graph()

    initial_state: CodingAgentState = {
        "task_description": task,
        "plan": "",
        "generated_code": "",
        "test_code": "",
        "execution_result": "",
        "test_result": "",
        "error_message": "",
        "retry_count": 0,
        "max_retries": max_retries,
        "status": "planning",
        "history": [],
    }

    # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè¡Œã§å„ãƒãƒ¼ãƒ‰ã®é€²æ—ã‚’å–å¾—
    for event in graph.stream(initial_state):
        node_name = list(event.keys())[0]
        node_state = event[node_name]
        print(f"[{node_name}] status={node_state.get('status')} retry={node_state.get('retry_count')}")

    final_state = graph.invoke(initial_state)
    return final_state


# å®Ÿè¡Œä¾‹
if __name__ == "__main__":
    result = run_coding_agent(
        task="ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°åˆ—ã®nç•ªç›®ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚"
        "ãƒ¡ãƒ¢åŒ–ã‚’ä½¿ç”¨ã—ã¦å¤§ããªnã§ã‚‚é«˜é€Ÿã«å‹•ä½œã™ã‚‹ã“ã¨ã€‚"
        "n < 0 ã®å ´åˆã¯ValueErrorã‚’é€å‡ºã™ã‚‹ã“ã¨ã€‚",
        max_retries=3,
    )

    if result["status"] == "completed":
        print("âœ… ã‚¿ã‚¹ã‚¯å®Œäº†")
        print(result["generated_code"])
    else:
        print("âŒ ã‚¿ã‚¹ã‚¯å¤±æ•—")
        print(f"ãƒªãƒˆãƒ©ã‚¤å›æ•°: {result['retry_count']}")
        print(f"æœ€å¾Œã®ã‚¨ãƒ©ãƒ¼: {result['error_message'][:200]}")
```

### LangSmithã§Observabilityã‚’å°å…¥ã™ã‚‹

æœ¬ç•ªé‹ç”¨ã§ã¯ã€å„ãƒãƒ¼ãƒ‰ã®å…¥å‡ºåŠ›ã‚„ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’å¯è¦–åŒ–ã™ã‚‹ObservabilityãŒä¸å¯æ¬ ã§ã™ã€‚State of Agent Engineering 2025ã®èª¿æŸ»ã§ã¯ã€**æœ¬ç•ªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®94%ãŒObservabilityã‚’å°å…¥æ¸ˆã¿**ã¨å ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚

```python
# coding_agent/config.py
import os

def configure_observability():
    """LangSmithé€£æºã‚’è¨­å®šã™ã‚‹"""
    os.environ["LANGSMITH_TRACING"] = "true"
    os.environ["LANGSMITH_PROJECT"] = "coding-agent-v1"
    # LANGSMITH_API_KEY ã¯ç’°å¢ƒå¤‰æ•°ã§è¨­å®šæ¸ˆã¿ã®å‰æ

# main.py ã®å…ˆé ­ã§å‘¼ã³å‡ºã™
# configure_observability()
```

LangSmithã‚’è¨­å®šã™ã‚‹ã¨ã€ä»¥ä¸‹ãŒè‡ªå‹•çš„ã«ãƒˆãƒ¬ãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚

| ãƒˆãƒ¬ãƒ¼ã‚¹é …ç›® | ç¢ºèªã§ãã‚‹ã“ã¨ |
|---|---|
| ãƒãƒ¼ãƒ‰ã”ã¨ã®å®Ÿè¡Œæ™‚é–“ | ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®šï¼ˆä¾‹: generateãŒé…ã„ï¼‰ |
| Claude APIã®å…¥å‡ºåŠ› | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å“è³ªè©•ä¾¡ã¨ãƒ‡ãƒãƒƒã‚° |
| ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | strict modeé•åã®æ¤œå‡º |
| è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã®å›æ•° | ã‚¿ã‚¹ã‚¯é›£æ˜“åº¦ã®åˆ†æ |
| ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ | ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®æ ¹æ‹  |

### ã‚³ã‚¹ãƒˆç®¡ç†ï¼šãƒ¢ãƒ‡ãƒ«ã®ä½¿ã„åˆ†ã‘

ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã§Claude Opus 4.6ã‚’ä½¿ã†ã®ã¯ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒæ‚ªã„ãŸã‚ã€**ã‚¿ã‚¹ã‚¯ã®è¤‡é›‘ã•ã«å¿œã˜ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã„åˆ†ã‘ã‚‹**ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

```python
# ãƒãƒ¼ãƒ‰åˆ¥ã®ãƒ¢ãƒ‡ãƒ«é¸æŠæˆ¦ç•¥
MODEL_STRATEGY = {
    "plan": "claude-sonnet-4-6",      # è¨ˆç”»: é«˜ã„æ¨è«–èƒ½åŠ›ãŒå¿…è¦
    "generate": "claude-sonnet-4-6",   # ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ: ãƒãƒ©ãƒ³ã‚¹é‡è¦–
    "execute": None,                    # å®Ÿè¡Œ: LLMä¸è¦ï¼ˆsubprocessï¼‰
    "test": None,                       # ãƒ†ã‚¹ãƒˆ: LLMä¸è¦ï¼ˆpytestï¼‰
    "fix": "claude-sonnet-4-6",        # ä¿®æ­£åˆ†æ: é«˜ã„åˆ†æèƒ½åŠ›ãŒå¿…è¦
}
```

**ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•:**
- Claude Haiku 4.5ã¯é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆã ãŒã€è¤‡é›‘ãªã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®è€ƒæ…®ãŒå¼±ã„
- Claude Sonnet 4.6ã¯ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãã€ã»ã¨ã‚“ã©ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã«é©åˆ‡
- Claude Opus 4.6ã¯æœ€é«˜å“è³ªã ãŒã€ã‚³ãƒ¼ãƒ‰ãŒ1/3ã®å‡¦ç†æ™‚é–“ã§ã€ã‚³ã‚¹ãƒˆã¯3å€

å®Ÿæ¸¬ã§ã¯ã€**Sonnet 4.6ã§ã®ã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸç‡ã¯Opus 4.6ã®ç´„90%ã®æ°´æº–**ã§ã‚ã‚Šã€ã‚³ã‚¹ãƒˆå¯¾åŠ¹æœã‚’è€ƒãˆã‚‹ã¨Sonnet 4.6ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é¸æŠè‚¢ã¨ã—ã¦é©åˆ‡ã§ã™ã€‚

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®é–‹ç™ºãƒ»é‹ç”¨ã§é »å‡ºã™ã‚‹å•é¡Œã¨ãã®å¯¾å‡¦æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| åŒã˜ã‚¨ãƒ©ãƒ¼ã§ç„¡é™ãƒ«ãƒ¼ãƒ— | ä¿®æ­£å±¥æ­´ãŒæ¸¡ã•ã‚Œã¦ã„ãªã„ | `history`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ç›´è¿‘3å›ã®ä¿®æ­£å†…å®¹ã‚’å‚ç…§ã•ã›ã‚‹ |
| importã‚¨ãƒ©ãƒ¼ãŒå¤šç™º | ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | `dependencies`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§`pip install`ã‚’è‡ªå‹•å®Ÿè¡Œ |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆé »ç™º | ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã«ç„¡é™ãƒ«ãƒ¼ãƒ— | `subprocess.run`ã®timeoutã‚’30ç§’ã«è¨­å®š |
| ãƒ†ã‚¹ãƒˆãŒç”˜ã™ãã‚‹ | LLMãŒæ­£å¸¸ç³»ã®ã¿ãƒ†ã‚¹ãƒˆç”Ÿæˆ | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œç•°å¸¸ç³»ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’å¿…ãšå«ã‚€ã€ã‚’æ˜è¨˜ |
| ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆè¶…é | é•·ã„ä¿®æ­£å±¥æ­´ãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§è¿« | å±¥æ­´ã‚’ç›´è¿‘3å›ã«åˆ¶é™ã€å¤ã„å±¥æ­´ã¯LangSmithã«é€€é¿ |
| strict modeå¯¾å¿œå¤–ãƒ¢ãƒ‡ãƒ« | Claude Sonnet 3.7ä»¥å‰ã‚’ä½¿ç”¨ | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§Pydanticãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£… |

### ç‰¹ã«æ³¨æ„ã™ã¹ãè½ã¨ã—ç©´

**ãƒ†ã‚¹ãƒˆã®å“è³ªãŒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ä½“ã®å“è³ªã‚’æ±ºå®šã—ã¾ã™ã€‚** LLMãŒç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆã¯ã€Œè‡ªåˆ†ãŒæ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ãŒé€šã‚‹ãƒ†ã‚¹ãƒˆã€ã«ãªã‚ŠãŒã¡ã§ã€æœ¬å½“ã«æ¤œè¨¼ã™ã¹ãã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’è¦‹é€ƒã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å¯¾ç­–ã¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆç”Ÿæˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ä»¥ä¸‹ã‚’å«ã‚ã¦ãã ã•ã„:

```python
TEST_GENERATION_PROMPT = """
ãƒ†ã‚¹ãƒˆã«ã¯ä»¥ä¸‹ã‚’å¿…ãšå«ã‚ã¦ãã ã•ã„:
1. æ­£å¸¸ç³»: å…¸å‹çš„ãªå…¥åŠ›ã§æœŸå¾…é€šã‚Šã®å‡ºåŠ›ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨
2. å¢ƒç•Œå€¤: ç©ºå…¥åŠ›ã€æœ€å¤§å€¤ã€æœ€å°å€¤
3. ç•°å¸¸ç³»: ä¸æ­£ãªå‹ã€ç¯„å›²å¤–ã®å€¤
4. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: Noneã€ç©ºãƒªã‚¹ãƒˆã€è² ã®æ•°
5. æ€§èƒ½: å¤§ããªå…¥åŠ›ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãªã„ã“ã¨
"""
```

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**
- LangGraphã®**StateGraph + æ¡ä»¶ä»˜ãã‚¨ãƒƒã‚¸**ã§ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆâ†’ãƒ†ã‚¹ãƒˆâ†’è‡ªå·±ä¿®æ­£ã®è‡ªå¾‹ãƒ«ãƒ¼ãƒ—ã‚’æ§‹ç¯‰ã§ãã‚‹
- Claude APIã®**tool_useï¼ˆstrict: trueï¼‰**ã«ã‚ˆã‚Šã€æ§‹é€ åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰å‡ºåŠ›ã‚’å‹å®‰å…¨ã«å—ã‘å–ã‚Œã‚‹
- **è¨ˆç”»ãƒ»ç”Ÿæˆãƒ»å®Ÿè¡Œãƒ»æ¤œè¨¼ãƒ»ä¿®æ­£**ã®5ãƒãƒ¼ãƒ‰åˆ†é›¢ãŒã€å„ãƒ•ã‚§ãƒ¼ã‚ºã®è²¬å‹™ã‚’æ˜ç¢ºã«ã—ä¿®æ­£åŠ¹ç‡ã‚’é«˜ã‚ã‚‹
- æœ¬ç•ªé‹ç”¨ã§ã¯**LangSmithé€£æº**ã«ã‚ˆã‚‹Observabilityã¨ã€**ãƒãƒ¼ãƒ‰åˆ¥ãƒ¢ãƒ‡ãƒ«æˆ¦ç•¥**ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆç®¡ç†ãŒå¿…é ˆ
- ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã«ã¯**æœ€å¤§ãƒªãƒˆãƒ©ã‚¤æ•°**ã¨**ä¿®æ­£å±¥æ­´ã®å‚ç…§**ã‚’çµ„ã¿è¾¼ã¿ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã¨åŒä¸€ä¿®æ­£ã®ç¹°ã‚Šè¿”ã—ã‚’é˜²æ­¢ã™ã‚‹

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**
- æœ¬ç•ªç’°å¢ƒç”¨ã«Dockerã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚’å°å…¥ã—ã€ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹
- Human-in-the-Loopï¼ˆHITLï¼‰ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã€é‡è¦ãªã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«äººé–“ã®æ‰¿èªã‚’æŒŸã‚€
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ãŸãŒã‚‹ã‚¿ã‚¹ã‚¯ï¼ˆä¾‹: Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®æ§‹ç¯‰ï¼‰ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹

**é–¢é€£è¨˜äº‹:**
- [LangGraphÃ—Claude APIã§æ§‹ç¯‰ã™ã‚‹ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°ä»˜ãã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGå®Ÿè£…](https://zenn.dev/0h_n0/articles/11f63b83aabde7)
- [ReActãƒ‘ã‚¿ãƒ¼ãƒ³å®Œå…¨ã‚¬ã‚¤ãƒ‰ï¼šLangGraphã§å®Ÿè£…ã™ã‚‹æ€è€ƒã¨è¡Œå‹•ã®èåˆ](https://zenn.dev/0h_n0/articles/467d219545ec5e)
- [LangGraphã§ä½œã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼š30åˆ†ã§æ§‹ç¯‰ã™ã‚‹å®Ÿè·µã‚¬ã‚¤ãƒ‰](https://zenn.dev/0h_n0/articles/8487a08b378cf1)

## å‚è€ƒ

- [LangGraphå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ - Agent Orchestration Framework](https://www.langchain.com/langgraph)
- [Claude API Tool Use Overview](https://platform.claude.com/docs/en/agents-and-tools/tool-use/overview)
- [Building Your Own AI Engineer with LangGraph and Claude - Neurons Lab](https://neurons-lab.com/article/building-your-own-ai-engineer/)
- [I Found a Way to Use Claude Agent SDK Inside LangGraph Nodes](https://www.khaledelfakharany.com/articles/langgraph-claude-sdk-integration)
- [How to turn Claude Code into a domain-specific coding agent - LangChain Blog](https://blog.langchain.com/how-to-turn-claude-code-into-a-domain-specific-coding-agent/)
- [LangGraph: Build Stateful AI Agents in Python - Real Python](https://realpython.com/langgraph-python/)
- [State of Agent Engineering 2025 - LangChain](https://www.langchain.com/state-of-agent-engineering)

---

## é–¢é€£ã™ã‚‹æ·±æ˜ã‚Šè¨˜äº‹

ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸæŠ€è¡“ã«ã¤ã„ã¦ã€ã•ã‚‰ã«æ·±æ˜ã‚Šã—ãŸè¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸï¼š

- [è«–æ–‡è§£èª¬: SWE-RL â€” RLÃ—OSSã‚³ãƒ¼ãƒ‰é€²åŒ–ãƒ‡ãƒ¼ã‚¿ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¼·åŒ–](https://0h-n0.github.io/posts/paper-2502-18449/) - arXivè§£èª¬
- [è«–æ–‡è§£èª¬: Agent-R â€” MCTSãƒ™ãƒ¼ã‚¹åå¾©è‡ªå·±è¨“ç·´ã«ã‚ˆã‚‹LLMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå·±åçœ](https://0h-n0.github.io/posts/paper-2501-07098/) - arXivè§£èª¬
- [è«–æ–‡è§£èª¬: LLMãƒ™ãƒ¼ã‚¹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è¨­è¨ˆã¨åˆ†æ â€” è‡ªå·±ä¿®æ­£ã®é™ç•Œã¨å¤–éƒ¨æ¤œè¨¼ã®å„ªä½æ€§](https://0h-n0.github.io/posts/paper-2407-13168/) - arXivè§£èª¬
- [NVIDIAè§£èª¬: NeMo Agent Toolkitã§ãƒ†ã‚¹ãƒˆé§†å‹•ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰](https://0h-n0.github.io/posts/techblog-nvidia-nemo-agent-toolkit/) - tech_blogè§£èª¬
- [è«–æ–‡è§£èª¬: Agentless â€” 2æ®µéšãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§LLMãƒ™ãƒ¼ã‚¹SEã‚’å†è€ƒã™ã‚‹](https://0h-n0.github.io/posts/paper-2407-01203/) - arXivè§£èª¬

:::message
ã“ã‚Œã‚‰ã®è¨˜äº‹ã¯ä¿®å£«å­¦ç”Ÿãƒ¬ãƒ™ãƒ«ã‚’æƒ³å®šã—ãŸæŠ€è¡“çš„è©³ç´°ï¼ˆæ•°å¼ãƒ»å®Ÿè£…ã®æ·±æ˜ã‚Šï¼‰ã‚’å«ã¿ã¾ã™ã€‚
:::

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
