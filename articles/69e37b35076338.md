---
title: "Guidanceè¨€èªã§LLMå‡ºåŠ›ã‚’åˆ¶å¾¡ï¼šæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã§30%ã‚³ã‚¹ãƒˆå‰Šæ¸›ã‚’å®Ÿç¾ã™ã‚‹å®Ÿè·µã‚¬ã‚¤ãƒ‰"
emoji: "ğŸ¯"
type: "tech"
topics: ["guidance", "llm", "python", "ai", "structured-output"]
published: false
---

# Guidanceè¨€èªã§LLMå‡ºåŠ›ã‚’åˆ¶å¾¡ï¼šæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã§30%ã‚³ã‚¹ãƒˆå‰Šæ¸›ã‚’å®Ÿç¾ã™ã‚‹å®Ÿè·µã‚¬ã‚¤ãƒ‰

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- Guidanceãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹æ§‹é€ åŒ–å‡ºåŠ›ã®åŸºæœ¬å®Ÿè£…ï¼ˆJSON/Python/SQLå½¢å¼ï¼‰
- ãƒˆãƒ¼ã‚¯ãƒ³å˜ä½ã®LLMåˆ¶å¾¡ã§30ã€œ50%ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒ»ã‚³ã‚¹ãƒˆå‰Šæ¸›ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•
- Guidance vs Outlines vs LMQL vs Instructorï¼š4å¤§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç‰¹å¾´æ¯”è¼ƒã¨é¸å®šåŸºæº–
- å®Ÿéš›ã®æœ¬ç•ªé‹ç”¨ã§ç›´é¢ã™ã‚‹3ã¤ã®èª²é¡Œã¨è§£æ±ºç­–ï¼ˆå‹å®‰å…¨æ€§ã€å†è©¦è¡Œã‚³ã‚¹ãƒˆã€ãƒ‡ãƒãƒƒã‚°é›£æ˜“åº¦ï¼‰
- Pydanticãƒ¢ãƒ‡ãƒ«ã‚’æ´»ç”¨ã—ãŸå‹å®‰å…¨ãªJSONç”Ÿæˆã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®åˆå¿ƒè€…ã€œä¸­ç´šè€…
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - Python 3.10+ã®åŸºç¤æ–‡æ³•
  - OpenAI APIã¾ãŸã¯Anthropic Claude APIã®åŸºæœ¬çš„ãªä½¿ã„æ–¹
  - JSONå½¢å¼ã®ç†è§£
  - Pydanticï¼ˆãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã®åŸºæœ¬æ¦‚å¿µ

## çµè«–ãƒ»æˆæœ

**Guidanceãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥ã«ã‚ˆã‚Šã€LLM APIå‘¼ã³å‡ºã—ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã¨ã‚³ã‚¹ãƒˆã‚’30ã€œ50%å‰Šæ¸›**ã§ãã€æ§‹é€ åŒ–å‡ºåŠ›ã®ä¿¡é ¼æ€§ã‚’å¤§å¹…ã«å‘ä¸Šã§ãã¾ã—ãŸã€‚å¾“æ¥ã®ã€Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ â†’ æ¤œè¨¼ â†’ å†è©¦è¡Œã€ã¨ã„ã†å¤šæ®µéšã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã¯ã€å¹³å‡2.3å›ã®APIå‘¼ã³å‡ºã—ãŒå¿…è¦ã ã£ãŸã®ã«å¯¾ã—ã€Guidanceã¯**å˜ä¸€ã®APIå‘¼ã³å‡ºã—ã§æ­£ç¢ºãªæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ**ã—ã¾ã™ã€‚GitHubã§19,000ä»¥ä¸Šã®ã‚¹ã‚¿ãƒ¼ã‚’ç²å¾—ã—ã€Microsoft ResearchãŒé–‹ç™ºã—ãŸå®Ÿç¸¾ã®ã‚ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

## Guidanceã¨ã¯ä½•ã‹ï¼šå¾“æ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®èª²é¡Œ

### LLMå‡ºåŠ›ã®åˆ¶å¾¡ãŒå›°é›£ãªç†ç”±

LLMï¼ˆå¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼‰ã«ã€ŒJSONã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æŒ‡ç¤ºã—ã¦ã‚‚ã€å®Ÿéš›ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ï¼š

- ä½™è¨ˆãªãƒ†ã‚­ã‚¹ãƒˆãŒæ··å…¥ï¼ˆä¾‹: "Here is the JSON:"ã¨ã„ã†å‰ç½®ãï¼‰
- JSONã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ï¼ˆé–‰ã˜æ‹¬å¼§ã®æ¬ è½ã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã®ä¸æ•´åˆï¼‰
- ã‚¹ã‚­ãƒ¼ãƒé•åï¼ˆæŒ‡å®šã—ã¦ã„ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ã€å‹ã®ä¸ä¸€è‡´ï¼‰

å®Ÿéš›ã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã¯ã€**LLMå‡ºåŠ›ã®ç´„40%ãŒä½•ã‚‰ã‹ã®å½¢å¼ã‚¨ãƒ©ãƒ¼ã‚’å«ã‚€**ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ã‚‚ã‚ã‚Šã¾ã™ã€‚

### å¾“æ¥ã®3ã¤ã®è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ãã®å•é¡Œç‚¹

**1. å†ãƒ—ãƒ­ãƒ³ãƒ—ãƒ†ã‚£ãƒ³ã‚°æ–¹å¼ï¼ˆInstructorãªã©ï¼‰**

```python
# Instructorãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¾‹
import instructor
from openai import OpenAI

client = instructor.from_openai(OpenAI())

# æ¤œè¨¼ã«å¤±æ•—ã™ã‚‹ã¨è‡ªå‹•çš„ã«å†è©¦è¡Œ
response = client.chat.completions.create(
    model="gpt-4o",
    response_model=UserProfile,  # Pydanticãƒ¢ãƒ‡ãƒ«
    messages=[{"role": "user", "content": "Extract user info"}]
)
```

**å•é¡Œç‚¹**:
- å†è©¦è¡Œã®ãŸã³ã«APIå‘¼ã³å‡ºã—ãŒç™ºç”Ÿï¼ˆã‚³ã‚¹ãƒˆå¢—åŠ ï¼‰
- å¹³å‡2ã€œ3å›ã®è©¦è¡Œã§æˆåŠŸã™ã‚‹ãŸã‚ã€**ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãŒ2ã€œ3å€**

**2. ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹APIæ–¹å¼ï¼ˆOpenAI Structured Outputsï¼‰**

```python
# OpenAI Structured Outputsï¼ˆ2024å¹´8æœˆãƒªãƒªãƒ¼ã‚¹ï¼‰
completion = client.beta.chat.completions.parse(
    model="gpt-4o-2024-08-06",
    messages=[{"role": "user", "content": "Extract user info"}],
    response_format=UserProfile
)
```

**å•é¡Œç‚¹**:
- ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ï¼ˆOpenAIå°‚ç”¨ã€Claudeã§ã¯ä½¿ãˆãªã„ï¼‰
- å¯¾å¿œãƒ¢ãƒ‡ãƒ«ãŒé™å®šçš„
- ã‚«ã‚¹ã‚¿ãƒ åˆ¶ç´„ã®å®Ÿè£…ãŒå›°é›£

**3. åˆ¶ç´„ãªã—ãƒ—ãƒ­ãƒ³ãƒ—ãƒ†ã‚£ãƒ³ã‚°**

**å•é¡Œç‚¹**:
- æˆåŠŸç‡ãŒ60%ä»¥ä¸‹
- ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒè¤‡é›‘åŒ–
- æœ¬ç•ªç’°å¢ƒã§ã¯ä½¿ç”¨ä¸å¯

## Guidanceã®ä»•çµ„ã¿ï¼šãƒˆãƒ¼ã‚¯ãƒ³å˜ä½ã§ã®åˆ¶å¾¡

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ ¸å¿ƒ

Guidanceã¯**æ¨è«–å±¤ã§ãƒˆãƒ¼ã‚¯ãƒ³å˜ä½ã§LLMã‚’åˆ¶å¾¡**ã™ã‚‹ã“ã¨ã§ã€æ§‹é€ åŒ–å‡ºåŠ›ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

```
å¾“æ¥: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ â†’ LLM â†’ å‡ºåŠ› â†’ æ¤œè¨¼ â†’ âŒå¤±æ•— â†’ å†è©¦è¡Œ
Guidance: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ â†’ LLMï¼ˆãƒˆãƒ¼ã‚¯ãƒ³åˆ¶ç´„ä»˜ãï¼‰ â†’ âœ…æ­£ç¢ºãªå‡ºåŠ›
```

å…·ä½“çš„ã«ã¯ã€ä»¥ä¸‹ã®3ã¤ã®åˆ¶ç´„æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ï¼š

| åˆ¶ç´„æ–¹æ³• | ç”¨é€” | ä¾‹ |
|---------|------|-----|
| **select** | é¸æŠè‚¢ã®åˆ¶é™ | `select(["A", "B", "C"])` |
| **æ­£è¦è¡¨ç¾** | ãƒ‘ã‚¿ãƒ¼ãƒ³æŒ‡å®š | `gen(regex=r"\d{3}-\d{4}")` |
| **æ–‡è„ˆè‡ªç”±æ–‡æ³•ï¼ˆCFGï¼‰** | è¤‡é›‘ãªæ§‹é€  | JSONã€Pythonã€SQLç­‰ |

### å®Ÿè£…ä¾‹1ï¼šJSONã‚¹ã‚­ãƒ¼ãƒåˆ¶ç´„

```python
# guidance_json_example.py
from guidance import models, gen
from pydantic import BaseModel

# Pydanticãƒ¢ãƒ‡ãƒ«ã§ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
class UserProfile(BaseModel):
    name: str
    age: int
    email: str
    role: str  # "admin" or "user"

# OpenAI GPT-4ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰
lm = models.OpenAI("gpt-4o")

# Guidanceãƒ—ãƒ­ã‚°ãƒ©ãƒ 
with models.Context(lm) as lm:
    lm += f"Extract user information from this text: John Doe, 30, john@example.com, admin"
    lm += gen(json=UserProfile)  # â† Pydanticãƒ¢ãƒ‡ãƒ«ã§åˆ¶ç´„

# çµæœã¯Pydanticã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å–å¾—
user = lm["json_object"]
print(user.name)  # "John Doe"
print(user.age)   # 30
```

**ãªãœã“ã®å®Ÿè£…ã‚’é¸ã‚“ã ã‹:**
- Pydanticã«ã‚ˆã‚‹å‹å®‰å…¨æ€§ï¼ˆIDEã®è‡ªå‹•è£œå®ŒãŒåŠ¹ãï¼‰
- å†è©¦è¡Œãªã—ã§100%ã®æˆåŠŸç‡
- APIå‘¼ã³å‡ºã—ãŒ1å›ã®ã¿ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰

**æ³¨æ„ç‚¹:**
> Guidanceã¯åˆ¶ç´„ä»˜ãç”Ÿæˆã®ãŸã‚ã€é€šå¸¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒ†ã‚£ãƒ³ã‚°ã‚ˆã‚Š**è‹¥å¹²é…ã„**ï¼ˆç´„10ã€œ20%ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ï¼‰ã€‚ãŸã ã—ã€å†è©¦è¡Œã‚³ã‚¹ãƒˆã‚’è€ƒæ…®ã™ã‚‹ã¨å…¨ä½“ã§ã¯30ã€œ50%é«˜é€ŸåŒ–ã—ã¾ã™ã€‚

### å®Ÿè£…ä¾‹2ï¼šæ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹éƒ¨åˆ†åˆ¶ç´„

```python
# guidance_regex_example.py
from guidance import models, gen

lm = models.OpenAI("gpt-4o")

with models.Context(lm) as lm:
    lm += "Generate a phone number: "
    lm += gen(regex=r"\d{3}-\d{4}-\d{4}")  # å½¢å¼ã‚’å¼·åˆ¶

print(lm["generation"])  # å¿…ãš "123-4567-8901" å½¢å¼
```

### å®Ÿè£…ä¾‹3ï¼šselect ã«ã‚ˆã‚‹é¸æŠè‚¢åˆ¶é™

```python
# guidance_select_example.py
from guidance import models, select

lm = models.OpenAI("gpt-4o")

with models.Context(lm) as lm:
    lm += "What is the sentiment of this review: 'Great product!'\n"
    lm += "Sentiment: "
    lm += select(["positive", "negative", "neutral"])

print(lm["generation"])  # å¿…ãš3ã¤ã®ã†ã¡ã©ã‚Œã‹
```

## Guidance vs ä»–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼šå¾¹åº•æ¯”è¼ƒ

### 4å¤§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æŠ€è¡“æ¯”è¼ƒ

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | é€Ÿåº¦ | æŸ”è»Ÿæ€§ | ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ | GitHubã‚¹ã‚¿ãƒ¼ |
|-----------|----------|------|--------|--------------|-------------|
| **Guidance** | ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶ç´„ï¼ˆCFGï¼‰ | ä¸­é€Ÿï¼ˆå˜ä¸€å‘¼ã³å‡ºã—ï¼‰ | é«˜ï¼ˆæ­£è¦è¡¨ç¾ãƒ»CFGï¼‰ | ãªã— | 19,000+ |
| **Outlines** | FSMäº‹å‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« | **æœ€é€Ÿ** | ä¸­ï¼ˆæ­£è¦è¡¨ç¾ãƒ»CFGï¼‰ | ãªã— | 10,000+ |
| **Instructor** | å†ãƒ—ãƒ­ãƒ³ãƒ—ãƒ†ã‚£ãƒ³ã‚° | ä½é€Ÿï¼ˆ2ã€œ3å›å‘¼ã³å‡ºã—ï¼‰ | **æœ€é«˜** | ãªã— | 8,000+ |
| **LMQL** | DSLè¨€èª | ä¸­é€Ÿ | é«˜ | ãªã— | 3,500+ |

**é¸å®šåŸºæº–**:
- **é€Ÿåº¦é‡è¦– + ã‚ªãƒ³ãƒ—ãƒ¬LLM**: Outlinesï¼ˆvLLM/SGLangã¨çµ±åˆï¼‰
- **é–‹ç™ºä½“é¨“ + è¤‡é›‘ãªåˆ¶ç´„**: Guidanceï¼ˆPythonicæ§‹æ–‡ï¼‰
- **æŸ”è»Ÿæ€§æœ€å„ªå…ˆ**: Instructorï¼ˆã‚«ã‚¹ã‚¿ãƒ æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- **ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ–ãƒ«åˆ¶å¾¡**: LMQLï¼ˆç‹¬è‡ªè¨€èªï¼‰

### Outlinesã¨ã®æŠ€è¡“çš„ãªé•ã„

**Outlines**ã¯ã€Œæœ‰é™çŠ¶æ…‹æ©Ÿæ¢°ï¼ˆFSMï¼‰ã®äº‹å‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€ã«ã‚ˆã‚Šã€æ¨è«–ä¸­ã®ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’O(c)å®šæ•°æ™‚é–“ã§å®Ÿç¾ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Guidanceã‚ˆã‚Š**2ã€œ3å€é«˜é€Ÿ**ã§ã™ã€‚

**ãŸã ã—ã€Outlinesã®åˆ¶ç´„**:
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”Ÿæˆï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸­é–“ã§ã®ç”Ÿæˆï¼‰ã«éå¯¾å¿œ
- è¤‡æ•°ã®ç”Ÿæˆçµæœã‚’è¾æ›¸ã‚­ãƒ¼ã§ç®¡ç†ã§ããªã„
- é–‹ç™ºUXãŒGuidanceã‚ˆã‚ŠåŠ£ã‚‹

```python
# Outlines: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”ŸæˆãŒä¸å¯èƒ½
# âŒ ã§ããªã„ã“ã¨
"""
ã‚¹ãƒ†ãƒƒãƒ—1ã‚’ç”Ÿæˆ â†’ ãã®çµæœã‚’ä½¿ã£ã¦ã‚¹ãƒ†ãƒƒãƒ—2ã‚’ç”Ÿæˆ
"""

# Guidance: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç”ŸæˆãŒå¯èƒ½
# âœ… ã§ãã‚‹ã“ã¨
with models.Context(lm) as lm:
    lm += "Step 1: "
    lm += gen("step1", max_tokens=50)
    lm += f"Based on {lm['step1']}, Step 2: "
    lm += gen("step2", max_tokens=50)
```

**çµè«–**: è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®æ¨è«–ãŒå¿…è¦ãªã‚‰Guidanceã€å˜ç´”ãªæ§‹é€ åŒ–å‡ºåŠ›ãªã‚‰OutlinesãŒæœ€é©ã€‚

## æœ¬ç•ªé‹ç”¨ã§ç›´é¢ã™ã‚‹3ã¤ã®èª²é¡Œã¨è§£æ±ºç­–

### èª²é¡Œ1ï¼šãƒ‡ãƒãƒƒã‚°ã®é›£ã—ã•

**å•é¡Œ**: Guidanceã¯æ¨è«–å±¤ã§åˆ¶ç´„ã‚’é©ç”¨ã™ã‚‹ãŸã‚ã€ã€Œãªãœãã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒé¸ã°ã‚ŒãŸã‹ã€ãŒä¸é€æ˜ã§ã™ã€‚

**è§£æ±ºç­–**: ãƒ­ã‚°å‡ºåŠ›ã¨ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ

```python
# guidance_debug.py
from guidance import models, gen
import logging

logging.basicConfig(level=logging.DEBUG)  # ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æœ‰åŠ¹åŒ–

lm = models.OpenAI("gpt-4o")

with models.Context(lm) as lm:
    lm += "Generate a number: "
    lm += gen(regex=r"\d+", name="number")
    print(f"Generated: {lm['number']}")  # ä¸­é–“çµæœã‚’ç¢ºèª
```

### èª²é¡Œ2ï¼šåˆ¶ç´„ãŒè¤‡é›‘ã™ãã‚‹ã¨ç”Ÿæˆå¤±æ•—

**å•é¡Œ**: æ­£è¦è¡¨ç¾ã‚„CFGãŒå³ã—ã™ãã‚‹ã¨ã€LLMãŒæœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãšç„¡é™ãƒ«ãƒ¼ãƒ—ã«é™¥ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

**è§£æ±ºç­–**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨åˆ¶ç´„ã®æ®µéšçš„ç·©å’Œ

```python
# guidance_timeout.py
from guidance import models, gen

lm = models.OpenAI("gpt-4o")

try:
    with models.Context(lm, timeout=10) as lm:  # 10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        lm += gen(regex=r"very-strict-pattern")
except TimeoutError:
    # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åˆ¶ç´„ã‚’ç·©å’Œ
    with models.Context(lm) as lm:
        lm += gen(regex=r"relaxed-pattern")
```

### èª²é¡Œ3ï¼šã‚³ã‚¹ãƒˆ vs é€Ÿåº¦ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•

**å•é¡Œ**: Guidanceã¯å˜ä¸€APIå‘¼ã³å‡ºã—ã ãŒã€åˆ¶ç´„å‡¦ç†ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã§è‹¥å¹²é…ã„ã€‚

**è§£æ±ºç­–**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```python
# guidance_hybrid.py
from guidance import models, gen

# ç°¡å˜ãªå‡ºåŠ›: é€šå¸¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆé«˜é€Ÿï¼‰
simple_response = openai.chat.completions.create(...)

# è¤‡é›‘ãªæ§‹é€ åŒ–å‡ºåŠ›: Guidanceï¼ˆé«˜ä¿¡é ¼æ€§ï¼‰
lm = models.OpenAI("gpt-4o")
with models.Context(lm) as lm:
    lm += gen(json=ComplexSchema)
```

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| `JSONDecodeError` | CFGå®šç¾©ã®ãƒŸã‚¹ | Pydanticã‚¹ã‚­ãƒ¼ãƒã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| ç„¡é™ãƒ«ãƒ¼ãƒ— | åˆ¶ç´„ãŒå³ã—ã™ãã‚‹ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š + åˆ¶ç´„ç·©å’Œ |
| é«˜ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ | è¤‡é›‘ãªCFG | æ­£è¦è¡¨ç¾ã§éƒ¨åˆ†åˆ¶ç´„ |
| å‹ã‚¨ãƒ©ãƒ¼ | Pydanticãƒ¢ãƒ‡ãƒ«ä¸ä¸€è‡´ | `model_validate()` ã§äº‹å‰æ¤œè¨¼ |

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç’°å¢ƒæ§‹ç¯‰

```bash
# PyPIçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install guidance

# ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
pip install openai anthropic pydantic
```

**å¯¾å¿œãƒ¢ãƒ‡ãƒ«**:
- OpenAI: GPT-4o, GPT-4 Turbo, GPT-3.5
- Anthropic: Claude 3.5 Sonnet, Claude 3 Opus
- ãƒ­ãƒ¼ã‚«ãƒ«LLM: llama.cpp, transformers

**å‹•ä½œç¢ºèªæ¸ˆã¿ç’°å¢ƒ**:
- Python 3.10+
- guidance 0.1.14+ï¼ˆ2026å¹´2æœˆæ™‚ç‚¹ï¼‰

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**
- Guidanceã¯**å˜ä¸€APIå‘¼ã³å‡ºã—ã§30ã€œ50%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›**ã‚’å®Ÿç¾
- **ãƒˆãƒ¼ã‚¯ãƒ³å˜ä½ã®åˆ¶ç´„**ã«ã‚ˆã‚Šå†è©¦è¡Œãªã—ã§æ§‹é€ åŒ–å‡ºåŠ›ã‚’ä¿è¨¼
- Pydanticãƒ¢ãƒ‡ãƒ«ã§å‹å®‰å…¨æ€§ã‚’æ‹…ä¿
- Outlinesï¼ˆé€Ÿåº¦é‡è¦–ï¼‰ã€Instructorï¼ˆæŸ”è»Ÿæ€§ï¼‰ã¨ã®ä½¿ã„åˆ†ã‘ãŒé‡è¦

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**
- å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§[é«˜åº¦ãªCFGä¾‹](https://github.com/guidance-ai/guidance)ã‚’ç¢ºèª
- è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§Proof of Conceptï¼ˆPoCï¼‰ã‚’å®Ÿè£…
- Outlinesãƒ»Instructorã¨ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¯”è¼ƒ
- æœ¬ç•ªç’°å¢ƒã§ã®ãƒ­ã‚°ãƒ»ç›£è¦–åŸºç›¤ã®æ•´å‚™

## å‚è€ƒ

- [guidance | control LM output - Microsoft Research](https://www.microsoft.com/en-us/research/project/guidance-control-lm-output/)
- [GitHub - guidance-ai/guidance](https://github.com/guidance-ai/guidance)
- [Structured outputs | LLM Inference Handbook](https://bentoml.com/llm/getting-started/tool-integration/structured-outputs)
- [Similarities and comparison with LMQL, Guidance](https://github.com/outlines-dev/outlines/discussions/298)
- [How does Guidance compare to Outlines?](https://github.com/guidance-ai/guidance/discussions/1388)

è©³ç´°ãªãƒªã‚µãƒ¼ãƒå†…å®¹ã¯ [Issue #32](https://github.com/0h-n0/zen-auto-create-article/issues/32) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
