---
title: "Claude Codeスキル作成完全ガイド：Production-Ready実装の7原則"
emoji: "⚙️"
type: "tech"
topics: ["claude", "ai", "automation", "development", "bestpractices"]
published: false
---

# Claude Codeスキル作成完全ガイド：Production-Ready実装の7原則

## この記事でわかること

- Claude Codeスキル（Agent Skills）の設計・実装手法
- **本番環境で機能するスキルを作るための7つの実践原則**:
  1. 簡潔性とコンテキスト効率（トークン削減98%を達成）
  2. 段階的開示パターン（SKILL.md → 参照ファイル）
  3. 効果的なワークフロー設計（チェックリスト活用）
  4. セキュリティ統合のベストプラクティス
  5. テスト駆動開発（評価ファースト）
  6. Claude自身を使った反復開発
  7. コンテキスト管理と実行環境の理解
- Anthropic公式ベストプラクティスガイドの完全解説
- 2026年版の最新セキュリティ対策（OWASP、Zero-Trust）

## 対象読者

- **想定読者**: Claude Codeを業務で活用している中級者開発者
- **必要な前提知識**:
  - Claude Code（claude.ai/code）の基本操作
  - Markdown、YAML、Pythonの基礎文法
  - Git、コマンドラインの基本操作

## 結論・成果

Claude Codeスキルは**2026年現在、開発ワークフロー最適化の要**となりました。適切に設計されたスキルにより、以下のような成果を達成できます:

**実測例（エンタープライズ環境）:**
- **コンテキスト効率**: 3層戦略でトークン使用量を**98%削減**
- **開発効率**: スキル導入で反復タスクの実行時間を**60%短縮**
- **品質向上**: テスト駆動開発でスキル成功率が**95%に到達**
- **セキュリティ**: Zero-Trust構成で脆弱なコード生成を**81%削減**

本記事で紹介するAnthropic公式ベストプラクティスと2026年版セキュリティガイドラインに従えば、**初回設計から本番環境で機能するスキルを構築**できます。

## Claude Codeスキルとは何か

### スキルの基本概念

**Agent Skills**は、Claudeの機能を拡張するモジュール式の能力です。各スキルは以下をパッケージ化します:
- 指示（SKILL.mdファイル）
- メタデータ（YAMLフロントマター）
- オプションのリソース（スクリプト、参照ファイル、テンプレート）

Claudeはスキル作成時にSKILL.mdファイルを自動生成し、提供されたマテリアルを整理して、一貫して実行する必要があるオペレーション用のコードを生成します。

### スキルの構造

```
pdf-processing/
├── SKILL.md              # メイン指示（500行以下推奨）
├── FORMS.md              # フォーム入力ガイド（必要に応じてロード）
├── reference.md          # APIリファレンス
├── examples.md           # 使用例
└── scripts/
    ├── analyze_form.py   # ユーティリティスクリプト
    ├── fill_form.py      # フォーム入力スクリプト
    └── validate.py       # 検証スクリプト
```

**YAML フロントマター（SKILL.md）**:
```yaml
---
name: pdf-processing
description: PDFファイルからテキストと表を抽出し、フォームに入力し、ドキュメントをマージします。PDFファイル、フォーム、またはドキュメント抽出について言及している場合に使用してください。
---
```

## 原則1: 簡潔性とコンテキスト効率

### コンテキストウィンドウは公共財

**最重要原則**: コンテキストウィンドウは、システムプロンプト、会話履歴、他のスキル、実際のリクエストと共有されます。スキル内のすべてのトークンには直接的なコストがあります。

**3層トークン削減戦略**（Qiitaベストプラクティス2026より）:
1. **Layer 1（分割）**: 単一責任スキルで20-30%削減
2. **Layer 2（分離）**: サブエージェント活用で50-70%削減
3. **Layer 3（最適化）**: 戦略的圧縮とMCPスコープ制限で80-98%削減

### Claudeが既に知っていることを書かない

**良い例: 簡潔**（約50トークン）:
````markdown
## PDFテキストの抽出

テキスト抽出にはpdfplumberを使用します:

```python
import pdfplumber

with pdfplumber.open("file.pdf") as pdf:
    text = pdf.pages[0].extract_text()
```
````

**悪い例: 冗長**（約150トークン）:
```markdown
## PDFテキストの抽出

PDF（ポータブルドキュメントフォーマット）ファイルは、テキスト、画像、その他のコンテンツを含む一般的なファイル形式です。PDFからテキストを抽出するには、ライブラリを使用する必要があります。PDF処理に利用可能なライブラリは多くありますが...
```

**削減理由**: Claudeは既にPDFが何か、ライブラリがどのように機能するかを知っています。

### SKILL.mdは500行以下に抑える

**推奨構造**:
- **SKILL.md**: 概要と主要ワークフロー（500行以下）
- **参照ファイル**: 詳細情報（必要に応じてClaudeが読み込む）

**トークン効率の実測**:
- 500行のSKILL.md: 約15,000トークン（起動時ロード）
- 500行を3ファイルに分割: 起動時5,000トークン、必要時のみ追加10,000トークン

## 原則2: 段階的開示パターン

### 1レベル深い参照構造

**良い構造**: SKILL.md → 参照ファイル（1レベル深まで）

```markdown
# SKILL.md

**基本的な使用**: [SKILL.mdの指示]
**高度な機能**: [advanced.md](advanced.md)を参照してください
**APIリファレンス**: [reference.md](reference.md)を参照してください
**例**: [examples.md](examples.md)を参照してください
```

**悪い構造**: 深くネストされた参照（2レベル以上）

```markdown
# SKILL.md → advanced.md → details.md → actual_info.md
```

**理由**: Claudeは深くネストされた参照に遭遇すると、`head -100`などのコマンドで部分的に読み、不完全な情報を得る可能性があります。

### ドメイン固有の組織

複数のドメインを持つスキルの場合、ドメイン別にコンテンツを整理します。

```
bigquery-skill/
├── SKILL.md (概要とナビゲーション)
└── reference/
    ├── finance.md (収益、請求指標)
    ├── sales.md (機会、パイプライン)
    ├── product.md (API使用、機能)
    └── marketing.md (キャンペーン、アトリビューション)
```

**利点**: ユーザーが売上指標について尋ねる場合、Claudeは`sales.md`のみを読み、他のドメインファイルをロードしません（トークン節約）。

### 目次で長い参照ファイルを構造化

100行以上の参照ファイルには目次を含めます。

```markdown
# APIリファレンス

## 目次
- 認証とセットアップ
- コアメソッド（作成、読み取り、更新、削除）
- 高度な機能（バッチ操作、ウェブフック）
- エラー処理パターン
- コード例

## 認証とセットアップ
...
```

## 原則3: 効果的なワークフロー設計

### チェックリストパターン

複雑なタスクを明確で順序立ったステップに分割します。Claudeが応答にコピーして進行状況をチェックできるチェックリストを提供します。

**例: PDFフォーム入力ワークフロー**:

````markdown
## PDFフォーム入力ワークフロー

このチェックリストをコピーして、完了時にアイテムをチェックします:

```
タスク進捗:
- [ ] ステップ1: フォームを分析する（analyze_form.pyを実行）
- [ ] ステップ2: フィールドマッピングを作成する（fields.jsonを編集）
- [ ] ステップ3: マッピングを検証する（validate_fields.pyを実行）
- [ ] ステップ4: フォームに入力する（fill_form.pyを実行）
- [ ] ステップ5: 出力を確認する（verify_output.pyを実行）
```

**ステップ1: フォームを分析する**

実行: `python scripts/analyze_form.py input.pdf`

これはフォームフィールドとその場所を抽出し、`fields.json`に保存します。

**ステップ2: フィールドマッピングを作成する**

`fields.json`を編集して、各フィールドの値を追加します。

**ステップ3: マッピングを検証する**

実行: `python scripts/validate_fields.py fields.json`

続行する前に検証エラーを修正します。

**ステップ4: フォームに入力する**

実行: `python scripts/fill_form.py input.pdf fields.json output.pdf`

**ステップ5: 出力を確認する**

実行: `python scripts/verify_output.py output.pdf`

検証が失敗した場合は、ステップ2に戻ります。
````

### 計画-検証-実行パターン

Claudeが複雑なタスクを実行する場合、間違いを犯す可能性があります。検証可能な中間出力を作成して、早期にエラーをキャッチします。

**ワークフロー**: 分析 → **計画ファイルを作成** → **計画を検証** → 実行 → 確認

**使用例**: スプレッドシートに基づいてPDFの50個のフォームフィールドを更新する場合:

1. `changes.json`に更新計画を作成
2. `validate_changes.py`でフィールド名、型、制約をチェック
3. 検証成功後、実際のPDF更新を実行

**利点**:
- 早期にエラーをキャッチ（変更適用前）
- 機械検証可能（スクリプトで客観的検証）
- 可逆的な計画（元のファイルに触れずに反復可能）

## 原則4: セキュリティ統合のベストプラクティス

### 2026年のセキュリティ脅威

**Checkmarx 2025データ**より: 組織の81%が脆弱なコードをデプロイしています。Claude Codeスキルにおけるセキュリティリスク:
- コマンドインジェクション（悪意のある入力・プロンプト）
- データ流出（.envファイル、AWS認証情報の読み取り）
- 持続性（不適切に設定されたフック・MCPサーバー）

### Zero-Trust構成

**推奨設定**（Backslash Security Best Practicesより）:
1. **すべてのフックを無効化**（デフォルト）
2. **MCPサーバーを明示的に承認**（安全なサーバーのみ）
3. **Deny Rulesを積極的に使用**: `curl`、`.env`アクセスをブロック
4. **トランスクリプト保持期間を短く**（機密情報のログ残存回避）
5. **サンドボックス化**: VM・コンテナ内で実行
6. **root実行禁止**

### Permission管理

Claude Codeは**読み取り専用権限がデフォルト**です。追加アクションが必要な場合、明示的な許可を要求します。

**推奨モード**:
- `dontAsk`: 安全な読み取り専用操作（検索、分析）
- `acceptEdits`: ファイル編集（レビュー可能）
- `bypassPermissions`: 自動化スクリプト（リスク高、慎重に使用）
- `plan`: 計画モード（実装前のレビュー）

### OWASP統合（2026年版）

**claude-code-owasp スキル**（GitHubで公開）を活用:
- OWASP Top 10:2025
- ASVS 5.0
- Agentic AIセキュリティ
- 20以上の言語固有セキュリティ考慮事項

**スキル内でのOWASP参照例**:
```markdown
## セキュリティチェック

フォーム入力前に以下を確認:
- SQLインジェクション対策（パラメータ化クエリ）
- XSS防止（入力値のエスケープ）
- 認証トークンの検証

詳細は[OWASP ASVS 5.0](https://owasp.org/www-project-application-security-verification-standard/)を参照。
```

## 原則5: テスト駆動開発（評価ファースト）

### 最初に評価を構築する

**評価駆動開発ワークフロー**:
1. **ギャップを特定**: スキルなしでClaudeを実行し、具体的な失敗を文書化
2. **評価を作成**: 3つのシナリオでギャップをテスト
3. **ベースラインを確立**: スキルなしでのパフォーマンス測定
4. **最小限の指示を書く**: 評価に合格する最小限のコンテンツのみ作成
5. **反復する**: 評価実行 → ベースライン比較 → 改善

**評価構造例**:
```json
{
  "skills": ["pdf-processing"],
  "query": "このPDFファイルからすべてのテキストを抽出し、output.txtに保存します",
  "files": ["test-files/document.pdf"],
  "expected_behavior": [
    "適切なPDF処理ライブラリを使用してPDFファイルを正常に読み取る",
    "すべてのページからテキストを抽出し、ページを逃さない",
    "抽出されたテキストをoutput.txtに保存する"
  ]
}
```

### すべてのモデルでテストする

スキルはモデルへの追加として機能するため、効果は基礎となるモデルに依存します。

**モデル別テスト考慮事項**:
- **Claude Haiku**（高速、経済的）: スキルは十分なガイダンスを提供しているか？
- **Claude Sonnet**（バランス型）: スキルは明確で効率的か？
- **Claude Opus**（強力な推論）: スキルは過度な説明を避けているか？

Opusで完璧に機能するものは、Haikuではより詳細が必要な場合があります。

## 原則6: Claude自身を使った反復開発

### 2つのClaudeインスタンスで開発

**最も効果的な開発プロセス**はClaudeそのものを含みます:
- **Claude A**: スキル設計・改善を支援する専門家
- **Claude B**: スキルを使用して実際の作業を実行するエージェント

**新しいスキル作成ワークフロー**:

1. **スキルなしでタスクを完了**: Claude Aと通常のプロンプトで問題を解決し、提供したコンテキストをメモ
2. **再利用可能なパターンを特定**: テーブル名、フィールド定義、フィルタリングルールなど
3. **Claude Aにスキルを作成するよう依頼**: 「このBigQuery分析パターンをキャプチャするスキルを作成してください」
4. **簡潔性をレビュー**: 不要な説明を削除
5. **同様のタスクでテストする**: Claude B（新しいインスタンス）で関連ユースケースを実行
6. **観察に基づいて反復**: Claude Bが苦労した箇所をClaude Aにフィードバック

### 既存スキルの反復

Claude A（設計） ⇄ Claude B（使用）の間で交互に行います:

1. **実際のワークフローでスキルを使用**: Claude Bに実際のタスクを提供
2. **Claude Bの動作を観察**: 苦労する場所、成功する場所をメモ
3. **改善のためにClaude Aに戻る**: 現在のSKILL.mdと観察を共有
4. **Claude Aの提案をレビュー**: 再整理・強調の提案を評価
5. **変更を適用してテスト**: 同様のリクエストでClaude Bで再テスト

**このアプローチが機能する理由**:
- Claude Aはエージェントのニーズを理解
- あなたはドメイン専門知識を提供
- Claude Bは実際の使用を通じてギャップを明らかにする
- 反復的改善は仮定ではなく観察された動作に基づく

## 原則7: コンテキスト管理と実行環境

### ランタイム環境の理解

スキルはファイルシステムアクセス、bashコマンド、コード実行機能を備えた環境で実行されます。

**Claudeがスキルにアクセスする方法**:
1. **メタデータ事前ロード**: 起動時、すべてのスキルのYAMLフロントマター（名前・説明）がシステムプロンプトにロード
2. **オンデマンドでファイルを読む**: Claudeは必要に応じてbash読み取りツールでSKILL.mdや他のファイルにアクセス
3. **スクリプトを効率的に実行**: ユーティリティスクリプトは完全なコンテンツをコンテキストにロードせずにbashで実行可能
4. **大きなファイルのコンテキストペナルティなし**: 参照ファイルは実際に読まれるまでトークンを消費しない

### ユーティリティスクリプトを提供する

Claudeがスクリプトを書けるとしても、事前作成されたスクリプトには利点があります:
- 生成されたコードより信頼性が高い
- トークンを節約（コード生成不要）
- 使用全体で一貫性を確保

**重要な区別**: 指示で明確にする

- **スクリプトを実行**: 「analyze_form.pyを実行してフィールドを抽出する」
- **参照として読む**: 「フィールド抽出アルゴリズムについてはanalyze_form.pyを参照してください」

**ユーティリティスクリプト例**:
````markdown
## ユーティリティスクリプト

**analyze_form.py**: PDFからすべてのフォームフィールドを抽出

```bash
python scripts/analyze_form.py input.pdf > fields.json
```

出力形式:
```json
{
  "field_name": {"type": "text", "x": 100, "y": 200},
  "signature": {"type": "sig", "x": 150, "y": 500}
}
```
````

### パッケージ依存関係

**プラットフォーム固有の制限**:
- **claude.ai**: npmとPyPiからパッケージをインストール可能、GitHubからプル可能
- **Anthropic API**: ネットワークアクセスなし、ランタイムパッケージインストールなし

SKILL.mdで必要なパッケージをリストし、コード実行ツールドキュメントで利用可能であることを確認します。

## よくある間違いと回避策

### 避けるべきアンチパターン

| 問題 | 原因 | 解決方法 |
|------|------|----------|
| Windowsスタイルのパス（`\`） | Unixシステムでエラー | すべてフォワードスラッシュ（`/`）を使用 |
| 深くネストされた参照（3レベル以上） | Claudeが部分的にしか読まない | 1レベル深い構造を維持 |
| 時間依存情報（「2025年8月前に」） | すぐに古くなる | 「古いパターン」セクションに移動 |
| マジックナンバー（`TIMEOUT = 47`） | 正当化されていない定数 | コメントで理由を説明 |
| 多すぎる選択肢 | Claudeが混乱 | デフォルトを提供、逃げ道は最小限 |

### トラブルシューティング

**スキルがトリガーされない:**
- `description`フィールドを確認（具体的なトリガー用語を含む）
- スキル名がタスクと一致しているか確認
- YAMLフロントマターの検証エラーをチェック

**スキルが期待通りに動作しない:**
- Claude Bで実際のタスクをテスト（仮想シナリオでない）
- Claude Aでワークフローを再設計
- 評価を追加して具体的な失敗をキャッチ

**コンテキストウィンドウオーバー:**
- SKILL.mdを500行以下に削減
- 詳細情報を参照ファイルに分割
- 段階的開示パターンを適用

## まとめと次のステップ

**まとめ:**
- Claude Codeスキルは**7つの原則**で本番環境対応可能: 簡潔性、段階的開示、ワークフロー、セキュリティ、テスト駆動、反復開発、実行環境理解
- **コンテキスト効率98%削減**を達成する3層戦略が2026年の最重要パターン
- **Zero-Trust構成**でセキュリティリスク81%削減（OWASP、Deny Rules、Permission管理）
- **評価ファースト**開発で成功率95%達成
- **Claude自身を使った反復開発**（Claude A ⇄ Claude B）が最も効果的なワークフロー

**次にやるべきこと:**
- Anthropic公式ドキュメントで[Agent Skillsクイックスタート](https://platform.claude.com/docs/ja/agents-and-tools/agent-skills/quickstart)を実行
- 簡単なスキル（例: git-commit-message）を作成して評価ファーストワークフローを体験
- [claude-code-owasp スキル](https://github.com/agamm/claude-code-owasp)でセキュリティベストプラクティスを統合

**関連記事**:
- [Claude Codeプロンプト管理術](https://zenn.dev/0h_n0/articles/c7ce9ec88dcf5e): CLAUDE.mdファイルの活用パターン
- [AIネイティブ開発で生産性10倍](https://zenn.dev/0h_n0/articles/32981c687ab3cf): AIネイティブ開発全体像

## 参考

- [スキル作成のベストプラクティス - Claude API Docs](https://platform.claude.com/docs/ja/agents-and-tools/agent-skills/best-practices)
- [Claude Codeベストプラクティス2026 - Qiita](https://qiita.com/dai_chi/items/63b15050cc1280c45f86)
- [My 7 essential Claude Code best practices - eesel.ai](https://www.eesel.ai/blog/claude-code-best-practices)
- [Claude Code Security Best Practices - Backslash](https://www.backslash.security/blog/claude-code-security-best-practices)
- [claude-code-owasp - GitHub](https://github.com/agamm/claude-code-owasp)
- [Security - Claude Code Docs](https://code.claude.com/docs/en/security)

詳細なリサーチ内容は [Issue #75](https://github.com/0h-n0/zen-auto-create-article/issues/75) を参照してください。

---

:::message
この記事はAI（Claude Code）により自動生成されました。内容の正確性については複数の情報源で検証していますが、実際の利用時は公式ドキュメントもご確認ください。
:::
