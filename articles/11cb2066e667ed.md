---
title: "LangGraphÃ—Claude Sonnet 4.6ã®tool_useã§å‡ºå…¸ä»˜ãAgentic RAGã‚’æ§‹ç¯‰ã™ã‚‹"
emoji: "ğŸ”—"
type: "tech"
topics: ["langgraph", "claude", "rag", "python", "anthropic"]
published: false
---

# LangGraphÃ—Claude Sonnet 4.6ã®tool_useã§å‡ºå…¸ä»˜ãAgentic RAGã‚’æ§‹ç¯‰ã™ã‚‹

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- LangGraph 1.0ã®StateGraphã§**è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ä»˜ãAgentic RAG**ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•
- Claude Sonnet 4.6ã®**search_result content blocks**ã§å›ç­”ã«å‡ºå…¸ã‚’è‡ªå‹•ä»˜ä¸ã™ã‚‹ä»•çµ„ã¿
- ã‚¯ã‚¨ãƒªæ„å›³ã«å¿œã˜ã¦**æ¤œç´¢æˆ¦ç•¥ã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆã‚‹**ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å®Ÿè£…

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: ä¸­ç´šã€œä¸Šç´šã®Pythonã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§RAGæ§‹ç¯‰çµŒé¨“ãŒã‚ã‚‹æ–¹
- **å‰æçŸ¥è­˜**: Python 3.11+ã€LangChainã®åŸºæœ¬ã€ãƒ™ã‚¯ãƒˆãƒ«DBï¼ˆChromaDBç­‰ï¼‰ã®åŸºç¤

## çµè«–ãƒ»æˆæœ

LangGraph 1.0ã¨Claude Sonnet 4.6ã®tool_use + search_result content blocksã‚’çµ„ã¿åˆã‚ã›ãŸAgentic RAGã§ã¯ã€å¾“æ¥ã®Retrieveâ†’Generateãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨æ¯”è¼ƒã—ã¦**Faithfulnessã‚¹ã‚³ã‚¢ãŒ0.52â†’0.78ã«å‘ä¸Š**ã—ãŸã¨LangChainã®å…¬å¼ãƒ–ãƒ­ã‚°ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ[å‡ºå…¸](https://blog.langchain.com/langgraph-release-week-recap/)ï¼‰ã€‚search_result blocksã«ã‚ˆã‚Šå‡ºå…¸URLãŒè‡ªå‹•ä»˜ä¸ã•ã‚Œã€ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¤œå‡ºã‚‚å®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

> **æ³¨æ„**: ç²¾åº¦å‘ä¸Šå¹…ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å“è³ªãƒ»é‡ã€ã‚¯ã‚¨ãƒªç‰¹æ€§ã€ãƒãƒ£ãƒ³ã‚¯æˆ¦ç•¥ã«ã‚ˆã£ã¦å¤‰å‹•ã—ã¾ã™ã€‚

## Agentic RAGã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è¨­è¨ˆã™ã‚‹

å¾“æ¥ã®RAGã¯ã€Œæ¤œç´¢â†’ç”Ÿæˆã€ã®ä¸€æ–¹å‘ãƒ•ãƒ­ãƒ¼ã§ã™ãŒã€Agentic RAGã¯**æ¤œç´¢çµæœã‚’è©•ä¾¡ã—ã€ä¸ååˆ†ãªã‚‰æ¤œç´¢æˆ¦ç•¥ã‚’å¤‰æ›´ã—ã¦å†æ¤œç´¢ã™ã‚‹**è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã‚’æŒã¡ã¾ã™ã€‚

| è¦³ç‚¹ | å¾“æ¥ã®RAG | Agentic RAG |
|------|-----------|-------------|
| æ¤œç´¢ãƒ•ãƒ­ãƒ¼ | Retrieve â†’ Generate | Retrieve â†’ Grade â†’ Rewrite â†’ Retrieveï¼ˆãƒ«ãƒ¼ãƒ—ï¼‰ |
| ã‚¯ã‚¨ãƒªå‡¦ç† | ãã®ã¾ã¾æ¤œç´¢ | æ„å›³åˆ†æâ†’æ›¸ãæ›ãˆâ†’æœ€é©ãªæ¤œç´¢æ‰‹æ³•é¸æŠ |
| å‡ºå…¸ç®¡ç† | ãªã— or æ‰‹å‹• | search_result blocksã§è‡ªå‹•å¼•ç”¨ |

LangGraph 1.0ï¼ˆ1.0.9ã€2026å¹´2æœˆãƒªãƒªãƒ¼ã‚¹ï¼‰ã®StateGraphã§ã“ã®ãƒ«ãƒ¼ãƒ—ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã‚°ãƒ©ãƒ•æ§‹é€ ã¯`analyze_query â†’ route_query â†’ æ¤œç´¢ â†’ grade_documents â†’ generate or rewrite_query`ã§ã™ã€‚ãƒ«ãƒ¼ãƒ—å›æ•°ã¯**æœ€å¤§2å›ã«åˆ¶é™**ã—ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²æ­¢ã—ã¾ã™ã€‚

> **ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ**: ãƒ«ãƒ¼ãƒ—å›æ•°ã‚’åˆ¶é™ã—ãªã„ã¨æ›–æ˜§ãªã‚¯ã‚¨ãƒªã§å»¶ã€…ãƒªãƒˆãƒ©ã‚¤ã—ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®åŸå› ã«ãªã‚Šã¾ã™ã€‚

### Stateã¨GradeDocumentsã®å®Ÿè£…

```python
from typing import Literal
from pydantic import BaseModel, Field
from langgraph.graph import MessagesState, StateGraph, START, END
from langchain_anthropic import ChatAnthropic

class AgenticRAGState(MessagesState):
    query: str
    rewritten_query: str
    search_strategy: Literal["vector", "keyword", "web"]
    documents: list[dict]
    retry_count: int
    grade_result: Literal["relevant", "not_relevant"]

class GradeResult(BaseModel):
    binary_score: str = Field(description="'yes' or 'no'")

def grade_documents_node(state: dict) -> dict:
    llm = ChatAnthropic(model="claude-sonnet-4-6-20260217", max_tokens=512)
    grader = llm.with_structured_output(GradeResult)
    query = state.get("rewritten_query") or state["query"]
    relevant = [
        doc for doc in state["documents"]
        if grader.invoke(
            f"ã‚¯ã‚¨ãƒª: {query}\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: {doc['content'][:500]}\né–¢é€£æ€§ã‚’åˆ¤å®š"
        ).binary_score == "yes"
    ]
    return {
        "documents": relevant or state["documents"],
        "grade_result": "relevant" if relevant else "not_relevant",
    }
```

`with_structured_output`ã¯Claude APIã®tool_useã‚’å†…éƒ¨åˆ©ç”¨ã—ã¦æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™ã€‚**1ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãšã¤è©•ä¾¡**ã™ã‚‹æ–¹ãŒç²¾åº¦ãŒé«˜ããªã‚Šã¾ã™ãŒã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒå¢—åŠ ã™ã‚‹ãŸã‚ä¸Šä½3ä»¶ã«çµã‚‹æ–¹æ³•ã‚‚æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

## search_result content blocksã§å‡ºå…¸ä»˜ãå›ç­”ã‚’ç”Ÿæˆã™ã‚‹

AnthropicãŒ2026å¹´2æœˆã«å…¬é–‹ã—ãŸ[search_result content blocks](https://platform.claude.com/docs/en/build-with-claude/search-results)ã¯ã€tool_resultã«`type: "search_result"`ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿”ã™ã¨ã€ClaudeãŒå›ç­”æ™‚ã«è‡ªå‹•ã§å‡ºå…¸ã‚’å¼•ç”¨ã™ã‚‹RAGå‘ã‘æ©Ÿèƒ½ã§ã™ã€‚

```python
from anthropic import Anthropic
from anthropic.types import SearchResultBlockParam, TextBlockParam, ToolResultBlockParam

def generate_with_citations(state: dict) -> dict:
    client = Anthropic()
    # æ¤œç´¢çµæœã‚’search_result blocksã«å¤‰æ›
    search_results = [
        SearchResultBlockParam(
            type="search_result",
            source=doc.get("source", ""),
            title=doc.get("title", ""),
            content=[TextBlockParam(type="text", text=doc["content"])],
            citations={"enabled": True},
        )
        for doc in state["documents"]
    ]
    # tool_resultã¨ã—ã¦search_resultsã‚’æ¸¡ã™ã¨è‡ªå‹•å¼•ç”¨ãŒä»˜ã
    # ï¼ˆtool_use â†’ tool_result ã®ãƒ•ãƒ­ãƒ¼ã¯çœç•¥ã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ï¼‰
    return {"messages": [{"role": "assistant", "content": "..."}]}
```

ã“ã“ã§ã¯LangChainãƒ©ãƒƒãƒ‘ãƒ¼ã§ã¯ãªãAnthropic SDKã‚’ç›´æ¥ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚search_result blocksã¯æ¯”è¼ƒçš„æ–°ã—ã„APIæ©Ÿèƒ½ã§ã‚ã‚Šã€langchain-anthropic 1.3.3æ™‚ç‚¹ã§ã¯ç›´æ¥ã‚µãƒãƒ¼ãƒˆãŒé™å®šçš„ãªãŸã‚ã§ã™ã€‚

> **åˆ¶ç´„æ¡ä»¶**: citationsã¯ã€Œå…¨æœ‰åŠ¹ã€ã‹ã€Œå…¨ç„¡åŠ¹ã€ã®ã©ã¡ã‚‰ã‹ã§ã™ã€‚ä¸€éƒ¨ã ã‘æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚æ©Ÿå¯†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é™¤å¤–ã™ã‚‹ã«ã¯äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå¿…è¦ã§ã™ã€‚

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| search_resultã§å¼•ç”¨ãŒä»˜ã‹ãªã„ | `citations.enabled`æœªè¨­å®š | å…¨search_resultã§æ˜ç¤ºçš„ã«Trueè¨­å®š |
| ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·5ç§’è¶… | Gradeè©•ä¾¡ãŒç›´åˆ— | `asyncio.gather`ã§ä¸¦åˆ—è©•ä¾¡ |
| ãƒªãƒˆãƒ©ã‚¤ä¸Šé™ã§ã‚‚é–¢é€£çµæœãªã— | ãƒãƒ£ãƒ³ã‚¯ç²’åº¦ãŒç²—ã„ | ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º512â†’256ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—50% |

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**
- LangGraph 1.0ã®StateGraphã§**ã‚¯ã‚¨ãƒªåˆ†æâ†’å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°â†’æ¤œç´¢â†’è©•ä¾¡â†’ãƒªãƒˆãƒ©ã‚¤/ç”Ÿæˆ**ã®Agentic RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ãŸ
- Claude Sonnet 4.6ã®**search_result content blocks**ã§å‡ºå…¸URLã‚’è‡ªå‹•ä»˜ä¸ã™ã‚‹ä»•çµ„ã¿ã‚’å®Ÿè£…ã—ãŸ
- **GradeDocumentsãƒ‘ã‚¿ãƒ¼ãƒ³**ã§æ¤œç´¢çµæœã®é–¢é€£åº¦ã‚’è‡ªå‹•è©•ä¾¡ã—ã€è‡ªå·±ä¿®æ­£ãƒ«ãƒ¼ãƒ—ã‚’çµ„ã¿è¾¼ã‚“ã 

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**
- RAGASã§Faithfulness/Context Precisionã‚’å®šé‡æ¸¬å®šã™ã‚‹
- LangGraph Platformã¾ãŸã¯FastAPI+Dockerã§æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

**é–¢é€£è¨˜äº‹:**
- [LangGraphÃ—Claude Sonnet 4.6ã§å®Ÿè£…ã™ã‚‹éšå±¤çš„Agentic RAGæ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](https://zenn.dev/0h_n0/articles/a4cd3a7f1cf4ce)
- [LangGraph Agentic RAGã§ç¤¾å†…æ¤œç´¢ã®å›ç­”ç²¾åº¦ã‚’78%æ”¹å–„ã™ã‚‹å®Ÿè£…æ‰‹æ³•](https://zenn.dev/0h_n0/articles/4c869d366e5200)

## é–¢é€£ã™ã‚‹æ·±æ˜ã‚Šè¨˜äº‹

ã“ã®è¨˜äº‹ã«é–¢é€£ã™ã‚‹1æ¬¡æƒ…å ±ï¼ˆè«–æ–‡ãƒ»å…¬å¼ãƒ–ãƒ­ã‚°ï¼‰ã®è§£èª¬è¨˜äº‹ã§ã™ã€‚

- [Anthropic Citations APIè§£èª¬: search_result content blocksã«ã‚ˆã‚‹RAGå‡ºå…¸è‡ªå‹•ä»˜ä¸](https://0h-n0.github.io/posts/techblog-anthropic-citations-api/)
- [è«–æ–‡è§£èª¬: ALCE â€” LLMã®å¼•ç”¨å“è³ªã‚’è‡ªå‹•è©•ä¾¡ã™ã‚‹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯](https://0h-n0.github.io/posts/paper-2305-14627/)
- [LangChainå…¬å¼è§£èª¬: Self-Reflective RAG with LangGraph â€” CRAGãƒ»Self-RAGãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…](https://0h-n0.github.io/posts/techblog-langchain-self-reflective-rag-langgraph/)
- [EMNLP 2025è«–æ–‡è§£èª¬: DecEx-RAG â€” MDPãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã¨ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã§Agentic RAGã‚’æœ€é©åŒ–](https://0h-n0.github.io/posts/conf-decex-rag-emnlp2025/)
- [NVIDIAå…¬å¼è§£èª¬: Traditional RAG vs. Agentic RAG â€” ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒã¨å®Ÿè£…æŒ‡é‡](https://0h-n0.github.io/posts/techblog-nvidia-traditional-vs-agentic-rag/)

## å‚è€ƒ

- [LangGraphå…¬å¼: Agentic RAG](https://docs.langchain.com/oss/python/langgraph/agentic-rag)
- [Claude API: search_result content blocks](https://platform.claude.com/docs/en/build-with-claude/search-results)
- [Claude API: tool_useã®å®Ÿè£…æ–¹æ³•](https://platform.claude.com/docs/en/agents-and-tools/tool-use/implement-tool-use)
- [LangGraph 1.0 GAãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ](https://changelog.langchain.com/announcements/langgraph-1-0-is-now-generally-available)

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
