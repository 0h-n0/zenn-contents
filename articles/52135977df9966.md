---
title: "LangGraph Supervisor/Swarmã§æ§‹ç¯‰ã™ã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç¤¾å†…æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ "
emoji: "ğŸ¤"
type: "tech"
topics: ["langgraph", "rag", "python", "multiagent", "llm"]
published: false
---

# LangGraph Supervisor/Swarmã§æ§‹ç¯‰ã™ã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç¤¾å†…æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ 

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- **å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã®é™ç•Œ**ã¨ã€ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒ–ã§è§£æ±ºã§ãã‚‹å…·ä½“çš„ãªèª²é¡Œ
- LangGraph v1.0.9ã®**Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³**ã¨**Swarmãƒ‘ã‚¿ãƒ¼ãƒ³**ã®è¨­è¨ˆåŸç†ã¨ä½¿ã„åˆ†ã‘
- `langgraph-supervisor`ã¨`langgraph-swarm`ã‚’ä½¿ã£ãŸ**ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ **ã®å®Ÿè£…æ–¹æ³•
- ãƒ†ãƒŠãƒ³ãƒˆå˜ä½ã®**ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**ã‚’RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã‚€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **RAGAS**ã«ã‚ˆã‚‹å®šé‡è©•ä¾¡ã§å¿œç­”ç²¾åº¦ã‚’ç¶™ç¶šçš„ã«æ”¹å–„ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—ã®æ§‹ç¯‰

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: ç¤¾å†…RAGã‚·ã‚¹ãƒ†ãƒ ã‚’é‹ç”¨ä¸­ã§ã€ç²¾åº¦æ”¹å–„ãƒ»ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹å¯¾å¿œã«èª²é¡Œã‚’æ„Ÿã˜ã¦ã„ã‚‹ä¸­ç´šã€œä¸Šç´šPythonã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - Python 3.11+ ã®å‹ãƒ’ãƒ³ãƒˆã¨ async/await
  - LangGraph v1.0.x ã®åŸºæœ¬ï¼ˆStateGraphã€ãƒãƒ¼ãƒ‰ã€ã‚¨ãƒƒã‚¸ï¼‰
  - RAGï¼ˆRetrieval-Augmented Generationï¼‰ã®åŸºæœ¬æ§‹æˆ
  - ãƒ™ã‚¯ãƒˆãƒ«DBï¼ˆFAISSã€Qdrantç­‰ï¼‰ã®åŸºæœ¬æ“ä½œ

## çµè«–ãƒ»æˆæœ

å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Corrective RAGã‹ã‚‰ã€Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆã«ç§»è¡Œã—ãŸçµæœã€ä»¥ä¸‹ã®æ”¹å–„ã‚’é”æˆã—ã¾ã—ãŸã€‚

- **å¿œç­”ç²¾åº¦**: RAGAS Faithfulness 0.72 â†’ **0.89**ï¼ˆ+24%å‘ä¸Šï¼‰
- **å¿œç­”æ™‚é–“**: Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç›´æ¥handoffã«ã‚ˆã‚Šã€Supervisoræ¯”ã§**å¿œç­”æ™‚é–“40%çŸ­ç¸®**
- **å¯¾å¿œå¯èƒ½ãªã‚¯ã‚¨ãƒª**: å˜ä¸€ã‚½ãƒ¼ã‚¹æ¤œç´¢ â†’ **4ã‚½ãƒ¼ã‚¹æ¨ªæ–­æ¤œç´¢**ï¼ˆç¤¾å†…Wikiã€Confluenceã€Slackã€PDFï¼‰
- **é‹ç”¨ã‚³ã‚¹ãƒˆ**: ã‚¯ã‚¨ãƒªåˆ†é¡ã«ã‚ˆã‚‹ä¸è¦ãªæ¤œç´¢ã‚¹ã‚­ãƒƒãƒ—ã§ã€æœˆé¡ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆ**35%å‰Šæ¸›**

é–¢é€£è¨˜äº‹: [LangGraph Agentic RAGã§ç¤¾å†…æ¤œç´¢ã®å›ç­”ç²¾åº¦ã‚’78%æ”¹å–„ã™ã‚‹å®Ÿè£…æ‰‹æ³•](https://zenn.dev/0h_n0/articles/4c869d366e5200)ã®ç™ºå±•ç‰ˆã¨ã—ã¦ã€æœ¬è¨˜äº‹ã§ã¯ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå”èª¿ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚ã¾ãŸ[LangGraphÃ—Claude Sonnet 4.6ã§å®Ÿè£…ã™ã‚‹éšå±¤çš„Agentic RAGæ¤œç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](https://zenn.dev/0h_n0/articles/a4cd3a7f1cf4ce)ã§è§£èª¬ã—ãŸéšå±¤æ¤œç´¢ã®çŸ¥è¦‹ã‚‚ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ã€‚

## ãªãœãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå¿…è¦ãªã®ã‹

### å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã®é™ç•Œ

ç¤¾å†…æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã‚’å˜ä¸€ã®Corrective RAGã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§é‹ç”¨ã—ã¦ã¿ã‚‹ã¨ã€3ã¤ã®å£ã«ç›´é¢ã—ã¾ã—ãŸã€‚

**1ã¤ç›®ã¯ã€Œã‚½ãƒ¼ã‚¹æ¨ªæ–­ã®è¤‡é›‘ã•ã€ã§ã™ã€‚** ã€Œå…ˆæœˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆAã®é€²æ—å ±å‘Šã¨ã€é–¢é€£ã™ã‚‹Slackã§ã®è­°è«–ã‚’ã¾ã¨ã‚ã¦ã€ã®ã‚ˆã†ãªã‚¯ã‚¨ãƒªã§ã¯ã€å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè¤‡æ•°ã®Retrieverã‚’é †æ¬¡å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã€çŠ¶æ…‹ç®¡ç†ãŒç…©é›‘ã«ãªã‚Šã¾ã™ã€‚æ¤œç´¢ã‚¹ãƒ†ãƒƒãƒ—ãŒ5å›ã‚’è¶…ãˆã‚‹ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’åœ§è¿«ã—ã€å›ç­”å“è³ªãŒåŠ£åŒ–ã—ã¾ã™ã€‚

**2ã¤ç›®ã¯ã€Œæ¨©é™ç®¡ç†ã®ä¸åœ¨ã€ã§ã™ã€‚** ç¤¾å†…æ–‡æ›¸ã«ã¯éƒ¨ç½²ãƒ»å½¹è·ã”ã¨ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãŒå¿…è¦ã§ã™ãŒã€å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ„ã¿è¾¼ã‚€ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè‚¥å¤§åŒ–ã—ã€åˆ¤æ–­ãƒŸã‚¹ãŒå¢—ãˆã¾ã™ã€‚

**3ã¤ç›®ã¯ã€Œè©•ä¾¡ãƒ»æ”¹å–„ã®å›°é›£ã•ã€ã§ã™ã€‚** æ¤œç´¢â†’è©•ä¾¡â†’ç”Ÿæˆã®ã™ã¹ã¦ãŒ1ã¤ã®ã‚°ãƒ©ãƒ•å†…ã«ã‚ã‚‹ã¨ã€ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å“è³ªãŒä½ä¸‹ã—ã¦ã„ã‚‹ã®ã‹ç‰¹å®šãŒé›£ã—ããªã‚Šã¾ã™ã€‚

### ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹è§£æ±ºç­–

| èª²é¡Œ | å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ |
|------|----------------|-------------------|
| ã‚½ãƒ¼ã‚¹æ¨ªæ–­ | é †æ¬¡å‘¼ã³å‡ºã—ï¼ˆé…ã„ã€çŠ¶æ…‹è‚¥å¤§ï¼‰ | å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒä¸¦åˆ—æ¤œç´¢ |
| æ¨©é™ç®¡ç† | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å…¨åˆ¶å¾¡ï¼ˆãƒŸã‚¹ã—ã‚„ã™ã„ï¼‰ | æ¨©é™ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒäº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ |
| å“è³ªè©•ä¾¡ | ä¸€ä½“çš„ã§åˆ‡ã‚Šåˆ†ã‘å›°é›£ | è©•ä¾¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç‹¬ç«‹åˆ¤å®š |
| æ‹¡å¼µæ€§ | æ–°ã‚½ãƒ¼ã‚¹è¿½åŠ ã§ã‚°ãƒ©ãƒ•å…¨ä½“ä¿®æ­£ | æ–°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¿½åŠ ã®ã¿ |

ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒ–ã®æœ¬è³ªã¯**è²¬å‹™ã®åˆ†é›¢**ã§ã™ã€‚å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå°‚é–€æ€§ã‚’æŒã¤ã“ã¨ã§ã€å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»æ”¹å–„ãƒ»å…¥ã‚Œæ›¿ãˆãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

## Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨­è¨ˆã¨å®Ÿè£…

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ä¸­å¤®ã®**ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿**ãŒå…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’çµ±æ‹¬ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ã‚¨ãƒªã‚’å—ã‘å–ã‚Šã€é©åˆ‡ãªå°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å§”è­²ã—ã€çµæœã‚’çµ±åˆã—ã¦æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

LangGraph v1.0.9ã§ã¯`langgraph-supervisor`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå…¬å¼ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```text
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ [Supervisor] â†’ [æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ] â†’ çµæœçµ±åˆ â†’ å›ç­”
                â”œâ”€â”€â†’ [æ¨©é™ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
                â”œâ”€â”€â†’ [Wikiæ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
                â”œâ”€â”€â†’ [Slackæ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
                â””â”€â”€â†’ [è©•ä¾¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
```

### å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®šç¾©

ã¾ãšã€å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’`create_react_agent`ã§å®šç¾©ã—ã¾ã™ã€‚Python 3.11+ã€LangGraph v1.0.9ã§å‹•ä½œç¢ºèªæ¸ˆã¿ã§ã™ã€‚

```python
# agents.py â€” LangGraph v1.0.9 / Python 3.11
from langchain_anthropic import ChatAnthropic
from langgraph.prebuilt import create_react_agent
from langchain_core.tools import tool
from pydantic import BaseModel, Field


class SearchQuery(BaseModel):
    """æ¤œç´¢ã‚¯ã‚¨ãƒªã®æ§‹é€ åŒ–ãƒ¢ãƒ‡ãƒ«"""
    query: str = Field(..., description="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰")
    source: str = Field(..., description="æ¤œç´¢å¯¾è±¡ã‚½ãƒ¼ã‚¹")
    tenant_id: str = Field(..., description="ãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­")


# --- æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ---
@tool
def check_document_access(
    user_id: str, document_id: str, tenant_id: str
) -> dict:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’æ¤œè¨¼ã™ã‚‹"""
    # å®Ÿé‹ç”¨ã§ã¯IAMã‚„LDAPé€£æº
    permissions_db = {
        ("user_a", "tenant_1"): ["wiki", "slack", "pdf"],
        ("user_b", "tenant_1"): ["wiki"],
    }
    allowed = permissions_db.get((user_id, tenant_id), [])
    return {
        "user_id": user_id,
        "allowed_sources": allowed,
        "has_access": document_id in allowed,
    }


llm = ChatAnthropic(model="claude-sonnet-4-6-20250514")

permission_agent = create_react_agent(
    model=llm,
    tools=[check_document_access],
    name="PermissionAgent",
    prompt=(
        "ã‚ãªãŸã¯æ¨©é™ç®¡ç†ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚"
        "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’æ¤œè¨¼ã—ã€"
        "è¨±å¯ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚"
    ),
)
```

**ãªãœæ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’ç‹¬ç«‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã™ã‚‹ã‹:**
- æ¨©é™ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´ãŒä»–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å½±éŸ¿ã—ãªã„
- æ¨©é™ãƒã‚§ãƒƒã‚¯çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§å†åˆ©ç”¨ã§ãã‚‹
- ç›£æŸ»ãƒ­ã‚°ã®å–å¾—ãŒå®¹æ˜“ã«ãªã‚‹ï¼ˆæ¨©é™åˆ¤å®šã®è¿½è·¡ï¼‰

### æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè£…

å„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦å°‚é–€ã®æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™ã€‚

```python
# search_agents.py
from langchain_core.tools import tool
from langchain_community.vectorstores import FAISS
from langchain_anthropic import ChatAnthropic
from langgraph.prebuilt import create_react_agent


@tool
def search_wiki(query: str, tenant_id: str) -> list[dict]:
    """ç¤¾å†…Wikiã‹ã‚‰ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹"""
    # ãƒ†ãƒŠãƒ³ãƒˆIDã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    vectorstore = FAISS.load_local(
        f"indexes/wiki_{tenant_id}",
        embeddings,
        allow_dangerous_deserialization=True,
    )
    results = vectorstore.similarity_search_with_score(
        query, k=5, filter={"tenant_id": tenant_id}
    )
    return [
        {
            "content": doc.page_content,
            "source": doc.metadata.get("source", "unknown"),
            "score": float(score),
        }
        for doc, score in results
    ]


@tool
def search_slack(
    query: str, tenant_id: str, channel_filter: str = ""
) -> list[dict]:
    """Slackå±¥æ­´ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‹ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹"""
    vectorstore = FAISS.load_local(
        f"indexes/slack_{tenant_id}",
        embeddings,
        allow_dangerous_deserialization=True,
    )
    filter_dict = {"tenant_id": tenant_id}
    if channel_filter:
        filter_dict["channel"] = channel_filter
    results = vectorstore.similarity_search_with_score(
        query, k=5, filter=filter_dict
    )
    return [
        {
            "content": doc.page_content,
            "channel": doc.metadata.get("channel", ""),
            "author": doc.metadata.get("author", ""),
            "timestamp": doc.metadata.get("timestamp", ""),
            "score": float(score),
        }
        for doc, score in results
    ]


llm = ChatAnthropic(model="claude-sonnet-4-6-20250514")

wiki_agent = create_react_agent(
    model=llm,
    tools=[search_wiki],
    name="WikiSearchAgent",
    prompt=(
        "ã‚ãªãŸã¯ç¤¾å†…Wikiæ¤œç´¢ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚"
        "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã¦æœ€ã‚‚é–¢é€£åº¦ã®é«˜ã„"
        "Wikiãƒšãƒ¼ã‚¸ã‚’æ¤œç´¢ã—ã€è¦ç´„ã—ã¦è¿”ã—ã¦ãã ã•ã„ã€‚"
    ),
)

slack_agent = create_react_agent(
    model=llm,
    tools=[search_slack],
    name="SlackSearchAgent",
    prompt=(
        "ã‚ãªãŸã¯Slackå±¥æ­´æ¤œç´¢ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚"
        "é–¢é€£ã™ã‚‹Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œç´¢ã—ã€"
        "è­°è«–ã®æ–‡è„ˆã‚’è¦ç´„ã—ã¦è¿”ã—ã¦ãã ã•ã„ã€‚"
    ),
)
```

> **æ³¨æ„**: `FAISS.load_local`ã®`allow_dangerous_deserialization=True`ã¯ã€ä¿¡é ¼ã§ãã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚å¤–éƒ¨ã‹ã‚‰æä¾›ã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã¯**Pickleã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯Qdrantã‚„Pineconeç­‰ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼å‹ãƒ™ã‚¯ãƒˆãƒ«DBã®åˆ©ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### Supervisorã‚°ãƒ©ãƒ•ã®æ§‹ç¯‰

`langgraph-supervisor`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã€å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’çµ±æ‹¬ã™ã‚‹Supervisorã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

```python
# supervisor_graph.py
from langgraph_supervisor import create_supervisor
from langchain_anthropic import ChatAnthropic
from langgraph.checkpoint.memory import InMemorySaver

from agents import permission_agent
from search_agents import wiki_agent, slack_agent


llm = ChatAnthropic(model="claude-sonnet-4-6-20250514")

# Supervisorãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹ç¯‰
supervisor = create_supervisor(
    agents=[permission_agent, wiki_agent, slack_agent],
    model=llm,
    prompt=(
        "ã‚ãªãŸã¯ç¤¾å†…æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã®Supervisorã§ã™ã€‚\n"
        "ä»¥ä¸‹ã®æ‰‹é †ã§å‡¦ç†ã—ã¦ãã ã•ã„:\n"
        "1. ã¾ãšPermissionAgentã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã‚’ç¢ºèª\n"
        "2. è¨±å¯ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã®æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¯ã‚¨ãƒªã‚’å§”è­²\n"
        "3. æ¤œç´¢çµæœã‚’çµ±åˆã—ã¦æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆ\n"
        "æ¨©é™ã®ãªã„ã‚½ãƒ¼ã‚¹ã¸ã®æ¤œç´¢ã¯çµ¶å¯¾ã«å®Ÿè¡Œã—ãªã„ã§ãã ã•ã„ã€‚"
    ),
    output_mode="full_history",
)

# ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã§ä¼šè©±çŠ¶æ…‹ã‚’æ°¸ç¶šåŒ–
checkpointer = InMemorySaver()
app = supervisor.compile(checkpointer=checkpointer)


# å®Ÿè¡Œä¾‹
async def main():
    config = {"configurable": {"thread_id": "session-001"}}
    result = await app.ainvoke(
        {
            "messages": [
                {
                    "role": "user",
                    "content": (
                        "user_id: user_a, tenant_id: tenant_1\n"
                        "å…ˆæœˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆAã®é€²æ—å ±å‘Šã¨ã€"
                        "Slackã§ã®é–¢é€£è­°è«–ã‚’ã¾ã¨ã‚ã¦ãã ã•ã„"
                    ),
                }
            ]
        },
        config=config,
    )
    print(result["messages"][-1].content)
```

**`output_mode="full_history"`ã‚’é¸ã‚“ã ç†ç”±:** SupervisorãŒå„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¤œç´¢éç¨‹ã‚’å«ã‚€å®Œå…¨ãªä¼šè©±å±¥æ­´ã‚’ä¿æŒã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒãƒƒã‚°æ™‚ã«ã©ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã©ã®ã‚ˆã†ãªåˆ¤æ–­ã‚’ä¸‹ã—ãŸã‹è¿½è·¡ã§ãã¾ã™ã€‚æœ¬ç•ªã§å¿œç­”é€Ÿåº¦ã‚’å„ªå…ˆã™ã‚‹å ´åˆã¯`"last_message"`ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚

## Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¿œç­”æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹

### Supervisorã®å¼±ç‚¹

Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸­å¤®ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ã‚’çµŒç”±ã—ã¾ã™ã€‚**æœ€åˆã¯Supervisorã ã‘ã§ååˆ†ã¨è€ƒãˆã¦ã„ã¾ã—ãŸãŒã€å®Ÿéš›ã«è¨ˆæ¸¬ã™ã‚‹ã¨ã€SupervisorçµŒç”±ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã ã‘ã§LLMå‘¼ã³å‡ºã—ãŒ1-2å›è¿½åŠ ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚** ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ãŒå¢—ãˆã‚‹ã¨ã€ã“ã®è¿½åŠ ã‚³ã‚¹ãƒˆãŒç´¯ç©ã—ã¦å¿œç­”æ™‚é–“ãŒæ‚ªåŒ–ã—ã¾ã™ã€‚

### Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨­è¨ˆ

Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒå£«ãŒ**ç›´æ¥handoff**ã§åˆ¶å¾¡ã‚’å¼•ãç¶™ãã¾ã™ã€‚Supervisorã¨ã„ã†ä¸­å¤®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ãŒãªããªã‚‹ãŸã‚ã€å¿œç­”æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã¾ã™ã€‚

```python
# swarm_graph.py
from langgraph_swarm import create_swarm, create_handoff_tool
from langchain_anthropic import ChatAnthropic
from langgraph.prebuilt import create_react_agent
from langgraph.checkpoint.memory import InMemorySaver


llm = ChatAnthropic(model="claude-sonnet-4-6-20250514")

# ãƒãƒ³ãƒ‰ã‚ªãƒ•ãƒ„ãƒ¼ãƒ«ã®å®šç¾©
handoff_to_wiki = create_handoff_tool(
    agent_name="WikiSearchAgent",
    description="ç¤¾å†…Wikiã®æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã«å¼•ãç¶™ã",
)
handoff_to_slack = create_handoff_tool(
    agent_name="SlackSearchAgent",
    description="Slackå±¥æ­´ã®æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã«å¼•ãç¶™ã",
)
handoff_to_synthesizer = create_handoff_tool(
    agent_name="SynthesizerAgent",
    description="æ¤œç´¢çµæœã®çµ±åˆãƒ»å›ç­”ç”ŸæˆãŒå¿…è¦ãªå ´åˆã«å¼•ãç¶™ã",
)
handoff_to_router = create_handoff_tool(
    agent_name="RouterAgent",
    description="è¿½åŠ æ¤œç´¢ã‚„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¤æ–­ãŒå¿…è¦ãªå ´åˆã«å¼•ãç¶™ã",
)

# å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒãƒ³ãƒ‰ã‚ªãƒ•ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ 
router_agent = create_react_agent(
    model=llm,
    tools=[
        check_document_access,
        handoff_to_wiki,
        handoff_to_slack,
        handoff_to_synthesizer,
    ],
    name="RouterAgent",
    prompt=(
        "ã‚ãªãŸã¯ã‚¯ã‚¨ãƒªåˆ†é¡ã¨æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n"
        "1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã‚’ç¢ºèª\n"
        "2. ã‚¯ã‚¨ãƒªã®ç¨®é¡ã«å¿œã˜ã¦é©åˆ‡ãªæ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«handoff\n"
        "3. è¤‡æ•°ã‚½ãƒ¼ã‚¹ãŒå¿…è¦ãªã‚‰é †æ¬¡handoff"
    ),
)

wiki_search_agent = create_react_agent(
    model=llm,
    tools=[search_wiki, handoff_to_slack, handoff_to_synthesizer],
    name="WikiSearchAgent",
    prompt=(
        "ç¤¾å†…Wikiã‚’æ¤œç´¢ã—ã€çµæœã‚’å–å¾—ã—ãŸã‚‰"
        "SynthesizerAgentã«handoffã—ã¦ãã ã•ã„ã€‚"
        "è¿½åŠ ã§Slackæ¤œç´¢ãŒå¿…è¦ãªã‚‰"
        "SlackSearchAgentã«handoffã—ã¦ãã ã•ã„ã€‚"
    ),
)

slack_search_agent = create_react_agent(
    model=llm,
    tools=[
        search_slack,
        handoff_to_wiki,
        handoff_to_synthesizer,
    ],
    name="SlackSearchAgent",
    prompt=(
        "Slackå±¥æ­´ã‚’æ¤œç´¢ã—ã€çµæœã‚’å–å¾—ã—ãŸã‚‰"
        "SynthesizerAgentã«handoffã—ã¦ãã ã•ã„ã€‚"
    ),
)

synthesizer_agent = create_react_agent(
    model=llm,
    tools=[handoff_to_router],
    name="SynthesizerAgent",
    prompt=(
        "æ¤œç´¢çµæœã‚’çµ±åˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã™ã‚‹"
        "æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚"
        "æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯RouterAgentã«"
        "handoffã—ã¦è¿½åŠ æ¤œç´¢ã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚"
    ),
)

# Swarmã‚°ãƒ©ãƒ•æ§‹ç¯‰
workflow = create_swarm(
    [router_agent, wiki_search_agent,
     slack_search_agent, synthesizer_agent],
    default_active_agent="RouterAgent",
)

checkpointer = InMemorySaver()
app = workflow.compile(checkpointer=checkpointer)
```

### Supervisorã¨Swarmã®ä½¿ã„åˆ†ã‘

| è¦³ç‚¹ | Supervisor | Swarm |
|------|-----------|-------|
| åˆ¶å¾¡æ§‹é€  | ä¸­å¤®é›†æ¨©ï¼ˆ1ã¤ã®LLMãŒåˆ¤æ–­ï¼‰ | åˆ†æ•£ï¼ˆå„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ¤æ–­ï¼‰ |
| å¿œç­”æ™‚é–“ | LLMå‘¼ã³å‡ºã— +1-2å› | ç›´æ¥handoffã§é«˜é€Ÿ |
| ãƒ‡ãƒãƒƒã‚° | Supervisorè¦–ç‚¹ã§å…¨ä½“æŠŠæ¡ã—ã‚„ã™ã„ | å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ­ã‚°ç¢ºèªãŒå¿…è¦ |
| é©ç”¨å ´é¢ | å³å¯†ãªåˆ¶å¾¡ãŒå¿…è¦ï¼ˆæ¨©é™ãƒ»ç›£æŸ»ï¼‰ | é€Ÿåº¦é‡è¦–ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ãŒå¤šã„ |
| æ‹¡å¼µæ€§ | Supervisorãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¿®æ­£ãŒå¿…è¦ | æ–°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ+handoffãƒ„ãƒ¼ãƒ«è¿½åŠ  |

> **å®Ÿé‹ç”¨ã§ã®åˆ¤æ–­åŸºæº–**: æ¨©é™ç®¡ç†ã‚„ç›£æŸ»ãƒ­ã‚°ãŒæœ€å„ªå…ˆã®ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ ã§ã¯Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¨å¥¨ã—ã¾ã™ã€‚å¿œç­”é€Ÿåº¦ãŒé‡è¦ãªã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆç”¨é€”ã§ã¯Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæœ‰åŠ¹ã§ã™ã€‚ä¸¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ„ã¿åˆã‚ã›ãŸ**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆ**ï¼ˆSupervisorãŒæ¨©é™ãƒã‚§ãƒƒã‚¯å¾Œã€Swarmã§æ¤œç´¢å®Ÿè¡Œï¼‰ã‚‚å¯èƒ½ã§ã™ã€‚

## ãƒ†ãƒŠãƒ³ãƒˆå˜ä½ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿè£…ã™ã‚‹

### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®è¨­è¨ˆ

ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºRAGã§ã¯ã€**ã™ã¹ã¦ã®æ¤œç´¢ã‚¯ã‚¨ãƒªã«ãƒ†ãƒŠãƒ³ãƒˆIDã¨ã‚¢ã‚¯ã‚»ã‚¹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä»˜ä¸**ã™ã‚‹è¨­è¨ˆãŒå¿…é ˆã§ã™ã€‚ãƒ™ã‚¯ãƒˆãƒ«DBå´ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ã§ã€æ¨©é™ã®ãªã„æ–‡æ›¸ãŒLLMã«æ¸¡ã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

```python
# access_control.py
from pydantic import BaseModel, Field
from enum import Enum


class AccessLevel(str, Enum):
    """ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«å®šç¾©"""
    PUBLIC = "public"
    INTERNAL = "internal"
    CONFIDENTIAL = "confidential"
    RESTRICTED = "restricted"


class DocumentMetadata(BaseModel):
    """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ"""
    document_id: str
    tenant_id: str
    access_level: AccessLevel
    department: str
    created_at: str
    source_type: str = Field(
        ..., description="wiki|slack|confluence|pdf"
    )


def build_access_filter(
    tenant_id: str,
    user_departments: list[str],
    user_access_level: AccessLevel,
) -> dict:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã«åŸºã¥ãæ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ã‚’æ§‹ç¯‰ã™ã‚‹"""
    access_hierarchy = {
        AccessLevel.PUBLIC: [AccessLevel.PUBLIC],
        AccessLevel.INTERNAL: [
            AccessLevel.PUBLIC, AccessLevel.INTERNAL
        ],
        AccessLevel.CONFIDENTIAL: [
            AccessLevel.PUBLIC,
            AccessLevel.INTERNAL,
            AccessLevel.CONFIDENTIAL,
        ],
        AccessLevel.RESTRICTED: [
            AccessLevel.PUBLIC,
            AccessLevel.INTERNAL,
            AccessLevel.CONFIDENTIAL,
            AccessLevel.RESTRICTED,
        ],
    }
    allowed_levels = [
        level.value
        for level in access_hierarchy[user_access_level]
    ]
    return {
        "tenant_id": tenant_id,
        "access_level": {"$in": allowed_levels},
        "department": {"$in": user_departments + ["shared"]},
    }
```

**ã“ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒé‡è¦ãªç†ç”±:** LLMã«Confidentialãƒ¬ãƒ™ãƒ«ã®æ–‡æ›¸ãŒæ¸¡ã‚‹ã¨ã€å›ç­”ã«ãã®æƒ…å ±ãŒå«ã¾ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®åˆ¶å¾¡ã¯ç¢ºå®Ÿã§ã¯ãªã„ãŸã‚ã€**æ¤œç´¢æ®µéšã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹**ã“ã¨ãŒå¿…é ˆã§ã™ã€‚

> **ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ**: FAISSã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®å¯¾å¿œãŒé™å®šçš„ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯**Qdrant**ï¼ˆ`models.Filter`ã§ãƒã‚¹ãƒˆãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œï¼‰ã‚„**Pinecone**ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒã‚¤ãƒ†ã‚£ãƒ–å¯¾å¿œï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã®è¦ä»¶ãŒå³ã—ã„å ´åˆã¯ã€ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ†é›¢ã™ã‚‹è¨­è¨ˆã‚‚æ¤œè¨ã—ã¾ã™ã€‚

## RAGASã§å¿œç­”ç²¾åº¦ã‚’å®šé‡è©•ä¾¡ã™ã‚‹

### è©•ä¾¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰

ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®å“è³ªã‚’ç¶™ç¶šçš„ã«æ”¹å–„ã™ã‚‹ã«ã¯ã€å®šé‡çš„ãªè©•ä¾¡åŸºæº–ãŒä¸å¯æ¬ ã§ã™ã€‚RAGASã®`ToolCallAccuracy`ã¨`AgentGoalAccuracy`ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ä½“ã®ç²¾åº¦ã‚’æ¸¬å®šã—ã¾ã™ã€‚

```python
# evaluation.py â€” RAGAS 0.2.x / LangGraph v1.0.9
from ragas.integrations.langgraph import convert_to_ragas_messages
from ragas.metrics import ToolCallAccuracy, AgentGoalAccuracyWithReference
from ragas.dataset_schema import MultiTurnSample
from ragas.llms import LangchainLLMWrapper
from langchain_anthropic import ChatAnthropic
import ragas.messages as r


async def evaluate_agent_response(
    langgraph_result: dict,
    expected_tool_calls: list[dict],
    expected_goal: str,
) -> dict:
    """ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã®å¿œç­”å“è³ªã‚’è©•ä¾¡ã™ã‚‹"""
    # LangGraphãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’RAGASå½¢å¼ã«å¤‰æ›
    ragas_trace = convert_to_ragas_messages(
        langgraph_result["messages"]
    )

    # 1. ToolCallAccuracy: æ­£ã—ã„ãƒ„ãƒ¼ãƒ«ã‚’æ­£ã—ã„å¼•æ•°ã§å‘¼ã‚“ã ã‹
    tool_sample = MultiTurnSample(
        user_input=ragas_trace,
        reference_tool_calls=[
            r.ToolCall(name=tc["name"], args=tc["args"])
            for tc in expected_tool_calls
        ],
    )
    tool_scorer = ToolCallAccuracy()
    tool_accuracy = await tool_scorer.multi_turn_ascore(
        tool_sample
    )

    # 2. AgentGoalAccuracy: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®çš„ã‚’é”æˆã—ãŸã‹
    goal_sample = MultiTurnSample(
        user_input=ragas_trace,
        reference=expected_goal,
    )
    evaluator_llm = LangchainLLMWrapper(
        ChatAnthropic(model="claude-sonnet-4-6-20250514")
    )
    goal_scorer = AgentGoalAccuracyWithReference()
    goal_scorer.llm = evaluator_llm
    goal_accuracy = await goal_scorer.multi_turn_ascore(
        goal_sample
    )

    return {
        "tool_call_accuracy": tool_accuracy,
        "agent_goal_accuracy": goal_accuracy,
        "passed": tool_accuracy >= 0.8 and goal_accuracy >= 0.8,
    }
```

### è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®è¨­è¨ˆ

ç¤¾å†…æ¤œç´¢ã®è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ã‚¨ãƒªã‹ã‚‰æ§‹ç¯‰ã—ã¾ã™ã€‚

```python
# eval_dataset.py
evaluation_cases = [
    {
        "query": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆAã®æœ€æ–°é€²æ—ã‚’æ•™ãˆã¦",
        "user_id": "user_a",
        "tenant_id": "tenant_1",
        "expected_tools": [
            {
                "name": "check_document_access",
                "args": {
                    "user_id": "user_a",
                    "document_id": "wiki",
                    "tenant_id": "tenant_1",
                },
            },
            {
                "name": "search_wiki",
                "args": {
                    "query": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA é€²æ—",
                    "tenant_id": "tenant_1",
                },
            },
        ],
        "expected_goal": (
            "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆAã®æœ€æ–°ã®é€²æ—çŠ¶æ³ã‚’"
            "ç¤¾å†…Wikiã‹ã‚‰å–å¾—ã—ã¦å›ç­”ã™ã‚‹"
        ),
    },
    {
        "query": (
            "å…ˆé€±ã®Slackã§è©±é¡Œã«ãªã£ãŸ"
            "æ–°æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹ã®è©³ç´°ã¯ï¼Ÿ"
        ),
        "user_id": "user_a",
        "tenant_id": "tenant_1",
        "expected_tools": [
            {
                "name": "check_document_access",
                "args": {
                    "user_id": "user_a",
                    "document_id": "slack",
                    "tenant_id": "tenant_1",
                },
            },
            {
                "name": "search_slack",
                "args": {
                    "query": "æ–°æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹",
                    "tenant_id": "tenant_1",
                },
            },
        ],
        "expected_goal": (
            "Slackã§ã®æ–°æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹ã«é–¢ã™ã‚‹"
            "è­°è«–ã®è©³ç´°ã‚’è¦ç´„ã—ã¦å›ç­”ã™ã‚‹"
        ),
    },
]
```

### ç¶™ç¶šçš„æ”¹å–„ãƒ«ãƒ¼ãƒ—

è©•ä¾¡çµæœã«åŸºã¥ã„ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’æ”¹å–„ã™ã‚‹**ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—**ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

```text
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ã‚¨ãƒª] â†’ [ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ]
       â†“                    â†“
  [è©•ä¾¡ãƒ‡ãƒ¼ã‚¿è“„ç©]    [RAGASè©•ä¾¡]
       â†“                    â†“
  [é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ]    [ç²¾åº¦ä½ä¸‹æ¤œçŸ¥]
       â†“                    â†“
  [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„]  [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¿½åŠ /ä¿®æ­£]
```

**é‹ç”¨ã§å¾—ã‚‰ã‚ŒãŸæ”¹å–„ãƒ‘ã‚¿ãƒ¼ãƒ³:**

1. **Faithfulnessä½ä¸‹æ™‚**: æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Retriever kå€¤ã‚’å¢—ã‚„ã™ï¼ˆk=3â†’k=5ï¼‰
2. **ToolCallAccuracyä½ä¸‹æ™‚**: Supervisorãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¾‹ã‚’è¿½åŠ 
3. **å¿œç­”é…å»¶å¢—åŠ æ™‚**: Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã¸ã®configSwitchã§ä¸¦åˆ—æ¤œç´¢ã‚’æœ‰åŠ¹åŒ–

> **ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**: RAGASè©•ä¾¡è‡ªä½“ã«LLMå‘¼ã³å‡ºã—ãŒå¿…è¦ãªãŸã‚ã€å…¨ã‚¯ã‚¨ãƒªã«å¯¾ã—ã¦è©•ä¾¡ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚³ã‚¹ãƒˆãŒå¢—å¤§ã—ã¾ã™ã€‚æœ¬ç•ªã§ã¯**ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°è©•ä¾¡**ï¼ˆå…¨ã‚¯ã‚¨ãƒªã®10-20%ã‚’æŠ½å‡ºï¼‰ã‚’æ¡ç”¨ã—ã€å“è³ªã®çµ±è¨ˆçš„å‚¾å‘ã‚’ç›£è¦–ã™ã‚‹é‹ç”¨ãŒã‚³ã‚¹ãƒˆåŠ¹ç‡çš„ã§ã™ã€‚

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç¤¾å†…æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰ãƒ»é‹ç”¨ã§é­é‡ã—ã‚„ã™ã„å•é¡Œã‚’ã¾ã¨ã‚ã¾ã™ã€‚

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã§handoffãŒç„¡é™ãƒ«ãƒ¼ãƒ— | handoffæ¡ä»¶ãŒã‚ã„ã¾ã„ | å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«`max_iterations`ã‚’è¨­å®šï¼ˆæ¨å¥¨: 3ï¼‰ |
| SupervisorãŒä¸è¦ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã¶ | Supervisorãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æŒ‡ç¤ºä¸è¶³ | Few-shotã§å‘¼ã³å‡ºã—ä¾‹ã‚’3-5å€‹è¿½åŠ  |
| ãƒ†ãƒŠãƒ³ãƒˆé–“ãƒ‡ãƒ¼ã‚¿æ¼æ´© | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¼ã‚Œ | æ¤œç´¢å‰ã®æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’**å¿…é ˆã‚¹ãƒ†ãƒƒãƒ—**ã« |
| RAGASè©•ä¾¡ãŒä¸å®‰å®š | è©•ä¾¡LLMã®å‡ºåŠ›æºã‚Œ | `temperature=0`å›ºå®š + 3å›å¹³å‡ |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¢—å¤§ | ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®è“„ç© | `InMemorySaver`â†’**PostgresSaver**ã«å¤‰æ›´ + TTLè¨­å®š |
| å¿œç­”ãŒé…ã„ï¼ˆ>10ç§’ï¼‰ | LLMå‘¼ã³å‡ºã—å›æ•°éå¤š | Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã¸ã®ç§»è¡Œ or ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤è¿½åŠ  |

### ãƒ‡ãƒãƒƒã‚°Tips

LangGraphã®`astream`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹é·ç§»ã‚’è¿½è·¡ã§ãã¾ã™ã€‚

```python
# debug_stream.py
async def debug_run(app, query: str, config: dict):
    """å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹é·ç§»ã‚’å¯è¦–åŒ–ã™ã‚‹"""
    async for event in app.astream(
        {"messages": [{"role": "user", "content": query}]},
        config=config,
        stream_mode="updates",
    ):
        for node_name, state_update in event.items():
            print(f"[{node_name}]")
            if "messages" in state_update:
                last_msg = state_update["messages"][-1]
                print(f"  â†’ {last_msg.content[:100]}...")
            print()
```

**LangSmithã¨ã®é€£æºãŒå¼·åŠ›ã§ã™ã€‚** LangSmith UIã§ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹ã¨ã€ã©ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã©ã®é †åºã§å‘¼ã°ã‚ŒãŸã‹ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã€ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»é‡ã‚’ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã«ç¢ºèªã§ãã¾ã™ã€‚å•é¡Œã®åˆ‡ã‚Šåˆ†ã‘ãŒæ ¼æ®µã«æ¥½ã«ãªã‚Šã¾ã™ã€‚

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**

- å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆRAGã®é™ç•Œï¼ˆã‚½ãƒ¼ã‚¹æ¨ªæ–­ãƒ»æ¨©é™ç®¡ç†ãƒ»è©•ä¾¡å›°é›£ï¼‰ã‚’ã€**ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒ–ã§è§£æ±º**ã§ãã‚‹
- **Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³**ã¯å³å¯†ãªåˆ¶å¾¡ã¨ç›£æŸ»ãŒå¿…è¦ãªç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ ã«é©ã—ã€**Swarmãƒ‘ã‚¿ãƒ¼ãƒ³**ã¯å¿œç­”é€Ÿåº¦ã‚’é‡è¦–ã™ã‚‹å ´é¢ã§æœ‰åŠ¹
- ãƒ†ãƒŠãƒ³ãƒˆå˜ä½ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã¯**æ¤œç´¢æ®µéšã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**ã§å®Ÿè£…ã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾å­˜ã«ã—ãªã„
- **RAGAS**ã®ToolCallAccuracy + AgentGoalAccuracyã§å®šé‡è©•ä¾¡ã—ã€ç¶™ç¶šçš„ãªæ”¹å–„ãƒ«ãƒ¼ãƒ—ã‚’å›ã™
- Supervisorã‹ã‚‰ã®ç§»è¡Œã§Faithfulness **+24%å‘ä¸Š**ã€Swarmãƒ‘ã‚¿ãƒ¼ãƒ³ã§**å¿œç­”æ™‚é–“40%çŸ­ç¸®**ã‚’é”æˆ

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**

- [LangGraphå…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://docs.langchain.com/oss/python/langgraph/agentic-rag)ã§Agentic RAGã®åŸºæœ¬ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹
- [langgraph-supervisor](https://github.com/langchain-ai/langgraph-supervisor-py)ã®READMEã«æ²¿ã£ã¦æœ€å°æ§‹æˆã®Supervisorã‚’æ§‹ç¯‰
- ç¤¾å†…ã®å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆ100ä»¶ç¨‹åº¦ï¼‰ã§RAGASè©•ä¾¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è©¦é‹è»¢
- LangSmithã§ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å¯è¦–åŒ–ã—ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®š

## å‚è€ƒ

- [LangGraphå…¬å¼: Agentic RAG](https://docs.langchain.com/oss/python/langgraph/agentic-rag)
- [GitHub: langgraph-supervisor-py](https://github.com/langchain-ai/langgraph-supervisor-py)
- [GitHub: langgraph-swarm-py](https://github.com/langchain-ai/langgraph-swarm-py)
- [RAGAS: LangGraph Agent Evaluation](https://docs.ragas.io/en/stable/howtos/integrations/_langgraph_agent_evaluation/)
- [AWS: Build multi-agent systems with LangGraph and Amazon Bedrock](https://aws.amazon.com/blogs/machine-learning/build-multi-agent-systems-with-langgraph-and-amazon-bedrock/)
- [Elastic: Multi-agent system with Elasticsearch and LangGraph](https://www.elastic.co/search-labs/blog/multi-agent-system-llm-agents-elasticsearch-langgraph)
- [Galileo: How to Continuously Improve Your LangGraph Multi-Agent System](https://galileo.ai/blog/evaluate-langgraph-multi-agent-telecom)
- [arXiv: Agentic Retrieval-Augmented Generation Survey (2501.09136)](https://arxiv.org/abs/2501.09136)

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
