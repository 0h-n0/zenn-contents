---
title: "LLMã‚¢ãƒ—ãƒªã®æœ¬ç•ªCI/CDæˆ¦ç•¥ï¼šã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ã¨å“è³ªã‚²ãƒ¼ãƒˆã§å®‰å…¨ã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹"
emoji: "ğŸš€"
type: "tech"
topics: ["llm", "cicd", "llmops", "githubactions", "devops"]
published: false
---

# LLMã‚¢ãƒ—ãƒªã®æœ¬ç•ªCI/CDæˆ¦ç•¥ï¼šã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ã¨å“è³ªã‚²ãƒ¼ãƒˆã§å®‰å…¨ã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- LLMã‚¢ãƒ—ãƒªç‰¹æœ‰ã®ãƒªãƒªãƒ¼ã‚¹ãƒªã‚¹ã‚¯ã¨å¾“æ¥CI/CDã§ã¯é˜²ã’ãªã„éšœå®³ãƒ‘ã‚¿ãƒ¼ãƒ³
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã—ã€ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ã§æ®µéšçš„ã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹è¨­è¨ˆ
- Braintrust Ã— GitHub Actionsã§å“è³ªã‚²ãƒ¼ãƒˆã‚’è‡ªå‹•åŒ–ã™ã‚‹å®Ÿè£…æ‰‹é †

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: LLMã‚¢ãƒ—ãƒªã‚’æœ¬ç•ªé‹ç”¨ä¸­ã®ä¸­ç´šã€œä¸Šç´šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - GitHub Actionsã®åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨˜è¿°çµŒé¨“
  - Python 3.11+ ã®é–‹ç™ºçµŒé¨“
  - LLM APIï¼ˆOpenAI, Anthropicç­‰ï¼‰ã®å‘¼ã³å‡ºã—çµŒé¨“

## çµè«–ãƒ»æˆæœ

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† + ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ + å“è³ªã‚²ãƒ¼ãƒˆã®3å±¤æˆ¦ç•¥ã‚’å°å…¥ã—ãŸçµæœã€**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤‰æ›´ã«ã‚ˆã‚‹æœ¬ç•ªéšœå®³ãŒæœˆ4ä»¶â†’0ä»¶**ã«æ¸›å°‘ã—ã€**ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«ãŒé€±1â†’æ—¥æ¬¡**ã«çŸ­ç¸®ã§ãã¾ã—ãŸã€‚ä¸€æ–¹ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“ã¯ç´„5åˆ†å¢—åŠ ã™ã‚‹ãŸã‚ã€éåŒæœŸå®Ÿè¡Œã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ãŒé‡è¦ã§ã™ã€‚

> **é–¢é€£è¨˜äº‹**: [LLMã‚¢ãƒ—ãƒªã®CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ï¼šPromptfooÃ—GitHub Actionsã§å“è³ªã‚’è‡ªå‹•æ¤œè¨¼ã™ã‚‹](https://zenn.dev/0h_n0/articles/75c05ecd0ff579) â€” Promptfooã§ã®åŸºæœ¬çš„ãªCI/CDæ§‹ç¯‰ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤‰æ›´ãŒã€Œã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚ˆã‚Šå±é™ºã€ãªç†ç”±ã‚’ç†è§£ã™ã‚‹

2025å¹´4æœˆã€OpenAIã¯ChatGPTã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°ã—ã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å³åº§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ãŸã€‚çµæœã€ãƒ¢ãƒ‡ãƒ«ãŒéåº¦ã«ãŠä¸–è¾ã‚’è¨€ã†ã€Œsycophanticã€ãªå¿œç­”ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã€3æ—¥å¾Œã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½™å„€ãªãã•ã‚Œã¾ã—ãŸã€‚

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å¤‰æ›´ã¯ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿å¤‰æ›´ã¨åŒç­‰ã®ãƒªã‚¹ã‚¯ã‚’æŒã¤**ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€å¤šãã®ãƒãƒ¼ãƒ ãŒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã€ŒãŸã ã®ãƒ†ã‚­ã‚¹ãƒˆã€ã¨ã—ã¦æ‰±ã£ã¦ã„ã¾ã™ã€‚

| è¦³ç‚¹ | å¾“æ¥ã®CI/CD | LLMã‚¢ãƒ—ãƒªã®CI/CD |
|------|------------|-----------------|
| ãƒ†ã‚¹ãƒˆåˆ¤å®š | Pass/Failï¼ˆæ±ºå®šè«–çš„ï¼‰ | ã‚¹ã‚³ã‚¢åˆ†å¸ƒï¼ˆç¢ºç‡è«–çš„ï¼‰ |
| ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ | ã‚³ãƒ¼ãƒ‰ + è¨­å®š | ã‚³ãƒ¼ãƒ‰ + ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + ãƒ¢ãƒ‡ãƒ« |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | ã‚³ãƒ¼ãƒ‰revert | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ‡æ›¿ |
| å“è³ªè©•ä¾¡ | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | LLM-as-a-Judge + äººé–“è©•ä¾¡ |

**æœ€åˆã¯å¾“æ¥ã®CI/CDã«LLM evalã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ååˆ†ã¨è€ƒãˆã¾ã—ãŸãŒã€å®Ÿéš›ã«ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ»ãƒ¢ãƒ‡ãƒ«ãƒ»è©•ä¾¡åŸºæº–ã®3ã¤ã‚’ç‹¬ç«‹ã—ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã—ãªã„ã¨ã€å“è³ªåŠ£åŒ–ã®åŸå› ã‚’ç‰¹å®šã§ãã¾ã›ã‚“ã€‚**

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†è¨­è¨ˆ

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã€Œãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ãªã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã€ã¨ã—ã¦æ‰±ã†å®Ÿè£…ä¾‹ã§ã™ã€‚

```python
# prompt_registry.py
from dataclasses import dataclass, field
import hashlib, json

@dataclass(frozen=True)
class PromptVersion:
    """ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³"""
    content: str
    model: str
    temperature: float
    version_hash: str = field(init=False)

    def __post_init__(self):
        # content-addressable ID ã§ä¸€æ„æ€§ã‚’ä¿è¨¼
        digest = hashlib.sha256(
            json.dumps({"content": self.content, "model": self.model,
                        "temperature": self.temperature}).encode()
        ).hexdigest()[:12]
        object.__setattr__(self, "version_hash", digest)
```

**è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ:**

- **frozen=True**: ä¸€åº¦ä½œæˆã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯å¤‰æ›´ä¸å¯ã€‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å…ˆãŒå¸¸ã«æ˜ç¢º
- **content-addressable ID**: åŒã˜å†…å®¹ãªã‚‰åŒã˜ãƒãƒƒã‚·ãƒ¥ã€‚é‡è¤‡ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•é˜²æ­¢

> ã“ã®å®Ÿè£…ã¯ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã§ã™ã€‚æœ¬ç•ªã§ã¯Braintrustã‚„LangSmithã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‹ã€PostgreSQLç­‰ã§æ°¸ç¶šåŒ–ã—ã¦ãã ã•ã„ã€‚

## ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ã¨å“è³ªã‚²ãƒ¼ãƒˆã‚’å®Ÿè£…ã™ã‚‹

å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä¸€æ–‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ChatGPTã®äº‹ä¾‹ãŒç¤ºã™é€šã‚Šè‡´å‘½çš„ã§ã™ã€‚ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ã§æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’**ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®5ã€œ10%**ã«é™å®šé…ä¿¡ã—ã€å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç›£è¦–ã—ã¦ã‹ã‚‰æ®µéšçš„ã«æ‹¡å¤§ã—ã¾ã™ã€‚

### ã‚«ãƒŠãƒªã‚¢ãƒ«ãƒ¼ã‚¿ãƒ¼ã®å®Ÿè£…

```python
# canary_router.py
class CanaryRouter:
    """ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å‰²åˆã«åŸºã¥ããƒãƒ¼ã‚¸ãƒ§ãƒ³é¸æŠ"""

    def __init__(self, stable: str, canary: str, pct: float = 5.0):
        self.stable = stable
        self.canary = canary
        self.pct = pct

    def route(self, user_id: str) -> str:
        """åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¸¸ã«åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æŒ¯ã‚Šåˆ†ã‘"""
        return self.canary if hash(user_id) % 100 < self.pct else self.stable
```

æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã¯ **5%â†’25%â†’50%â†’100%** ã®4æ®µéšã§é€²ã‚ã¾ã™ã€‚å„æ®µéšã§30åˆ†ã€œ2æ™‚é–“ç›£è¦–ã—ã€å“è³ªã‚¹ã‚³ã‚¢ãŒé–¾å€¤ã‚’ä¸‹å›ã£ãŸã‚‰å³åº§ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

**ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ**: ã‚«ãƒŠãƒªã‚¢æ¯”ç‡5%ã§ã¯ã‚µãƒ³ãƒ—ãƒ«æ•°ãŒå°‘ãªãçµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ã‚’æ¤œå‡ºã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ—¥æ¬¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ1ä¸‡ä»¶æœªæº€ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯**æœ€ä½10%ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ**ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### GitHub Actionsã§å“è³ªã‚²ãƒ¼ãƒˆã‚’è‡ªå‹•åŒ–ã™ã‚‹

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤‰æ›´ã®PRã«å¯¾ã—ã¦evalã‚’è‡ªå‹•å®Ÿè¡Œã—ã€å“è³ªã‚¹ã‚³ã‚¢ãŒé–¾å€¤ã‚’ä¸‹å›ã£ãŸã‚‰ãƒãƒ¼ã‚¸ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚

```yaml
# .github/workflows/llm-eval.yml
name: LLM Eval Gate
on:
  pull_request:
    paths: ["prompts/**", "src/llm/**"]
jobs:
  eval:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: pip install braintrust autoevals openai
      - uses: braintrustdata/eval-action@v1
        with:
          api_key: ${{ secrets.BRAINTRUST_API_KEY }}
          root: ./evals
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
```

**ãªãœBraintrustã‚’é¸ã‚“ã ã‹:**

| ãƒ„ãƒ¼ãƒ« | GitHub Actionsé€£æº | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç† | ä¾¡æ ¼ |
|--------|-------------------|---------------|------|
| Braintrust | ãƒã‚¤ãƒ†ã‚£ãƒ–ï¼ˆeval-actionï¼‰ | content-addressable | å¾“é‡èª²é‡‘ |
| Promptfoo | CLIé€£æº | YAMLå®šç¾© | OSSï¼ˆç„¡æ–™ï¼‰ |
| Arize Phoenix | ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | å¤–éƒ¨ç®¡ç† | OSSï¼ˆç„¡æ–™ï¼‰ |

Braintrustã®`eval-action`ã¯PRã«è‡ªå‹•ã§evalçµæœã‚’ã‚³ãƒ¡ãƒ³ãƒˆã—ã€é–¾å€¤ãƒ™ãƒ¼ã‚¹ã§ãƒãƒ¼ã‚¸ãƒ–ãƒ­ãƒƒã‚¯ã§ãã¾ã™ã€‚ã•ã‚‰ã«LLM Proxyã§evalå®Ÿè¡Œã‚³ã‚¹ãƒˆã‚’ç´„60%å‰Šæ¸›å¯èƒ½ã§ã™ã€‚

**åˆ¶ç´„æ¡ä»¶**: eval-actionã¯1å›ã®PRã§æœ€å¤§100ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå®Ÿç”¨çš„ã§ã™ã€‚ãã‚Œä»¥ä¸Šã¯ãƒãƒƒãƒå®Ÿè¡Œã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| evalå®Ÿè¡ŒãŒé…ã„ï¼ˆ10åˆ†è¶…ï¼‰ | é€æ¬¡å®Ÿè¡Œ | `asyncio.gather`ã§ä¸¦åˆ—åŒ–+ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| ã‚«ãƒŠãƒªã‚¢ã§åŠ£åŒ–æ¤œå‡ºã§ããªã„ | ã‚µãƒ³ãƒ—ãƒ«ä¸è¶³ | æ¯”ç‡10%ä»¥ä¸Š+åˆæˆevalãƒ‡ãƒ¼ã‚¿ä½µç”¨ |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã‚‚æ—§å¿œç­”ãŒæ®‹ã‚‹ | CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥ | LLMå¿œç­”ã®TTLã‚’æœ€å¤§5åˆ†ã«çŸ­ç¸® |
| evalçµæœãŒPRé–“ã§ä¸å®‰å®š | éæ±ºå®šè«–çš„å‡ºåŠ› | temperature=0å›ºå®šã€5å›ä¸­å¤®å€¤ã§åˆ¤å®š |

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**

- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ã‚³ãƒ¼ãƒ‰ã¨åŒç­‰ã®ãƒªã‚¹ã‚¯**ã€‚ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå¿…é ˆ
- **ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ5%â†’100%ï¼‰**ã§æ®µéšãƒªãƒªãƒ¼ã‚¹ã—ã€éšœå®³ã®å½±éŸ¿ç¯„å›²ã‚’æœ€å°åŒ–
- **å“è³ªã‚²ãƒ¼ãƒˆï¼ˆeval-actionï¼‰**ã§PRæ™‚ç‚¹ã§å“è³ªåŠ£åŒ–ã‚’è‡ªå‹•æ¤œå‡ºãƒ»ãƒ–ãƒ­ãƒƒã‚¯

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**

- Braintrust eval-actionã‚’è¿½åŠ ã—ã€æœ€å°é™ã®evalã‚»ãƒƒãƒˆï¼ˆ20ã‚±ãƒ¼ã‚¹ï¼‰ã§å“è³ªã‚²ãƒ¼ãƒˆã‚’æ§‹ç¯‰
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’`prompts/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†é›¢ã—ã¦Gitç®¡ç†ä¸‹ã«ç½®ã
- ã‚«ãƒŠãƒªã‚¢ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’Feature Flagã‚µãƒ¼ãƒ“ã‚¹ï¼ˆLaunchDarklyç­‰ï¼‰ã¨é€£æº

## å‚è€ƒ

- [Prompt Management - Braintrust](https://www.braintrust.dev/articles/what-is-prompt-management)
- [How to Add LLM Evaluations to CI/CD Pipelines - Arize AI](https://arize.com/blog/how-to-add-llm-evaluations-to-ci-cd-pipelines/)
- [MLOps Lessons from ChatGPT's Rollback](https://leehanchung.github.io/blogs/2025/04/30/ai-ml-llm-ops/)
- [Braintrust eval-action - GitHub Marketplace](https://github.com/marketplace/actions/braintrust-eval)
- [Top 5 Prompt Versioning Tools - Maxim AI](https://www.getmaxim.ai/articles/top-5-prompt-versioning-tools-for-reliable-ai-workflows/)

è©³ç´°ãªãƒªã‚µãƒ¼ãƒå†…å®¹ã¯ [Issue #150](https://github.com/0h-n0/zen-auto-create-article/issues/150) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
