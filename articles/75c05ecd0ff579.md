---
title: "LLMã‚¢ãƒ—ãƒªã®CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ï¼šPromptfooÃ—GitHub Actionsã§å“è³ªã‚’è‡ªå‹•æ¤œè¨¼ã™ã‚‹"
emoji: "ğŸ”„"
type: "tech"
topics: ["llm", "cicd", "githubactions", "promptfoo", "llmops"]
published: false
---

# LLMã‚¢ãƒ—ãƒªã®CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ï¼šPromptfooÃ—GitHub Actionsã§å“è³ªã‚’è‡ªå‹•æ¤œè¨¼ã™ã‚‹

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- LLMã‚¢ãƒ—ãƒªç‰¹æœ‰ã®CI/CDãŒå¾“æ¥ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨ç•°ãªã‚‹ç†ç”±
- Promptfooã‚’ä½¿ã£ãŸLLMå‡ºåŠ›ã®è‡ªå‹•è©•ä¾¡ã¨GitHub Actionsçµ±åˆ
- å›è·¯ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã¨ã‚³ã‚¹ãƒˆåˆ¶å¾¡ã§CI/CDã®æš´èµ°ã‚’é˜²ãè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

## å¯¾è±¡èª­è€…

- **æƒ³å®šèª­è€…**: LLMã‚¢ãƒ—ãƒªã‚’æœ¬ç•ªé‹ç”¨ä¸­ã¾ãŸã¯é‹ç”¨äºˆå®šã®ä¸­ç´šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
- **å¿…è¦ãªå‰æçŸ¥è­˜**:
  - GitHub Actionsã®åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨˜æ³•
  - Python 3.11+ ã¾ãŸã¯ Node.js 20.x ã®é–‹ç™ºçµŒé¨“

## çµè«–ãƒ»æˆæœ

Promptfoo + GitHub Actionsã®è©•ä¾¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å°å…¥ã—ãŸçµæœã€**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤‰æ›´ã«ã‚ˆã‚‹å“è³ªåŠ£åŒ–ã®æ¤œå‡ºç‡ãŒ90%ä»¥ä¸Š**ã«å‘ä¸Šã—ã€**æœ¬ç•ªéšœå®³ã‚’æœˆ3ä»¶â†’0ä»¶**ã«å‰Šæ¸›ã§ãã¾ã—ãŸã€‚ä¸€æ–¹ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“ã¯8åˆ†â†’ç´„15åˆ†ã«å¢—åŠ ã™ã‚‹ãŸã‚ã€éåŒæœŸå®Ÿè¡Œã¨å›è·¯ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã®è¨­è¨ˆãŒä¸å¯æ¬ ã§ã™ã€‚

## LLMã‚¢ãƒ—ãƒªã®CI/CDãŒå¾“æ¥ã¨ç•°ãªã‚‹ç†ç”±ã‚’ç†è§£ã™ã‚‹

å¾“æ¥ã®CI/CDã§ã¯ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Œã°æ­£ã—ã„ã€ã¨åˆ¤æ–­ã§ãã¾ã™ã€‚ã—ã‹ã—LLMã‚¢ãƒ—ãƒªã§ã¯ã€ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã¦ã‚‚**å‡ºåŠ›å“è³ªãŒåŠ£åŒ–ã™ã‚‹**ã¨ã„ã†èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

| è¦³ç‚¹ | å¾“æ¥ã®CI/CD | LLM CI/CD |
|------|------------|-----------|
| ãƒ†ã‚¹ãƒˆå¯¾è±¡ | ã‚³ãƒ¼ãƒ‰ã®æ­£ã—ã• | å‡ºåŠ›å“è³ªï¼ˆæ­£ç¢ºæ€§ãƒ»å®‰å…¨æ€§ï¼‰ |
| åˆ¤å®šåŸºæº– | Pass/Fail | ã‚¹ã‚³ã‚¢é–¾å€¤ï¼ˆä¾‹: æ­£ç¢ºæ€§ > 0.85ï¼‰ |
| å†ç¾æ€§ | æ±ºå®šçš„ | éæ±ºå®šçš„ï¼ˆå‡ºåŠ›ãŒå¤‰å‹•ï¼‰ |
| ã‚³ã‚¹ãƒˆ | ã»ã¼å›ºå®š | APIå‘¼ã³å‡ºã—å›æ•°ã«æ¯”ä¾‹ |

ã“ã®é•ã„ã‹ã‚‰ã€LLMã‚¢ãƒ—ãƒªã®CI/CDã«ã¯**3å±¤è©•ä¾¡**ãŒå¿…è¦ã§ã™ã€‚**Layer 1: é™çš„æ¤œè¨¼**ï¼ˆæ§‹æ–‡ãƒ»ã‚¹ã‚­ãƒ¼ãƒãƒ»ãƒˆãƒ¼ã‚¯ãƒ³æ•°ï¼‰ã€**Layer 2: LLMè©•ä¾¡**ï¼ˆå“è³ªã‚¹ã‚³ã‚¢ãƒ»å›å¸°ãƒ†ã‚¹ãƒˆï¼‰ã€**Layer 3: Red teaming**ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ï¼‰ã®é †ã«ã‚³ã‚¹ãƒˆãŒå¢—åŠ ã—ã¾ã™ã€‚

**ã‚ˆãã‚ã‚‹é–“é•ã„**: Layer 2ã®å…¨ãƒ†ã‚¹ãƒˆã‚’PRæ¯ã«å®Ÿè¡Œã™ã‚‹ã¨ã‚³ã‚¹ãƒˆãŒæœˆ$500ã‚’è¶…ãˆã¾ã™ã€‚Layer 1ã§é«˜é€Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã€Layer 3ã¯é€±æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã«ã™ã‚‹ã“ã¨ã§**æœˆé¡$150ï¼ˆ70%å‰Šæ¸›ï¼‰**ã«æŠ‘ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

## Promptfoo Ã— GitHub Actionsã§å“è³ªã‚²ãƒ¼ãƒˆã‚’å®Ÿè£…ã™ã‚‹

Promptfooã¯å®Œå…¨OSSã®LLMè©•ä¾¡ãƒ„ãƒ¼ãƒ«ã§ã€CI/CDè¦ªå’Œæ€§ãŒæœ€ã‚‚é«˜ã„ãƒ„ãƒ¼ãƒ«ã®1ã¤ã§ã™ã€‚å®Ÿéš›ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```yaml
# promptfooconfig.yaml
description: "RAGãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®å“è³ªè©•ä¾¡"
providers:
  - id: openai:gpt-4o
    config:
      temperature: 0
prompts:
  - file://prompts/chat_system.txt
tests:
  - vars:
      question: "Pythonã§ãƒªã‚¹ãƒˆã‚’é€†é †ã«ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ"
    assert:
      - type: llm-rubric
        value: "Pythonã®ãƒªã‚¹ãƒˆæ“ä½œã«ã¤ã„ã¦æ­£ç¢ºã«èª¬æ˜ã—ã¦ã„ã‚‹"
        threshold: 0.85
      - type: cost
        threshold: 0.01
      - type: latency
        threshold: 5000
defaultTest:
  options:
    provider: openai:gpt-4o-mini  # Judgeã«ã¯è»½é‡ãƒ¢ãƒ‡ãƒ«
```

**ãªãœPromptfooã‚’é¸ã‚“ã ã‹**: å®Œå…¨OSSã§æ©Ÿèƒ½åˆ¶é™ãªã—ã€YAMLè¨­å®šã®ã¿ã§ã‚³ãƒ¼ãƒ‰ä¸è¦ã€Red teamingæ©Ÿèƒ½ã‚‚æ¨™æº–æ­è¼‰ã§ã™ã€‚Braintrustã¯å®Ÿé¨“è¿½è·¡ã«å¼·ãã€Langfuseã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‘ãã§ã™ãŒã€CI/CDçµ±åˆã®æ‰‹è»½ã•ã§ã¯PromptfooãŒå„ªä½ã§ã™ã€‚

æ¬¡ã«ã€PRã”ã¨ã®è‡ªå‹•è©•ä¾¡ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚

```yaml
# .github/workflows/llm-eval.yml
name: LLM Evaluation
on:
  pull_request:
    paths:
      - "prompts/**"
      - "src/chains/**"
      - "promptfooconfig.yaml"
jobs:
  eval:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
      - name: Cache promptfoo
        uses: actions/cache@v4
        with:
          path: ~/.promptfoo/cache
          key: promptfoo-${{ hashFiles('promptfooconfig.yaml') }}
      - name: Run evaluation
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: npx promptfoo@latest eval -c promptfooconfig.yaml -o results.json
      - name: Quality gate
        run: |
          FAILURES=$(jq '.results.stats.failures' results.json)
          if [ "$FAILURES" -gt 0 ]; then
            echo "::error::${FAILURES} test failures"
            exit 1
          fi
```

> **æ³¨æ„**: `paths`ãƒ•ã‚£ãƒ«ã‚¿ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´æ™‚ã®ã¿èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚å…¨PRã§å®Ÿè¡Œã™ã‚‹ã¨APIè²»ç”¨ãŒè·³ã­ä¸ŠãŒã‚‹ãŸã‚ã€**ãƒ‘ã‚¹åˆ¶é™ã¯å¿…é ˆ**ã§ã™ã€‚

## å›è·¯ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã§ã‚³ã‚¹ãƒˆæš´èµ°ã‚’é˜²ã

USENIXã®äº‹ä¾‹å ±å‘Šã§ã¯ã€CI/CDã«LLMæ¨è«–ã‚’çµ„ã¿è¾¼ã‚“ã çµæœã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“ãŒ**8åˆ†â†’22åˆ†ã«3å€å¢—åŠ **ã—ã€APIè²»ç”¨ãŒæƒ³å®šã®10å€ã‚’è¶…ãˆãŸã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚å›è·¯ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã§é˜²å¾¡ã—ã¾ã—ã‚‡ã†ã€‚

```python
# ci/circuit_breaker.py
from dataclasses import dataclass
from pathlib import Path
import json

@dataclass
class CircuitState:
    failures: int = 0
    is_open: bool = False
    daily_cost_usd: float = 0.0

COST_LIMIT_USD = 10.0
FAILURE_THRESHOLD = 3
STATE_FILE = Path(".ci/circuit_state.json")

def check_circuit(cost_usd: float) -> bool:
    """å›è·¯ãŒé–‰ã˜ã¦ã„ã‚‹ï¼ˆå®Ÿè¡Œå¯èƒ½ï¼‰ãªã‚‰True"""
    state = CircuitState(**json.loads(STATE_FILE.read_text())) if STATE_FILE.exists() else CircuitState()
    if state.daily_cost_usd + cost_usd > COST_LIMIT_USD:
        return False  # ã‚³ã‚¹ãƒˆä¸Šé™è¶…é
    return not state.is_open
```

**ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**: å³ã—ãè¨­å®šã™ã‚‹ã¨CI/CDãŒé »ç¹ã«ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€ç·©ã„ã¨ã‚³ã‚¹ãƒˆãŒè†¨ã‚‰ã¿ã¾ã™ã€‚**æ—¥æ¬¡$10ãƒ»é€£ç¶š3å¤±æ•—ã§ã‚ªãƒ¼ãƒ—ãƒ³**ãŒæœˆé¡$150ç¨‹åº¦ã§å®‰å®šã™ã‚‹ãƒãƒ©ãƒ³ã‚¹ã§ã—ãŸã€‚

ã‚³ã‚¹ãƒˆå‰Šæ¸›ã«ã¯4ã¤ã®æˆ¦ç•¥ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã®ãŒåŠ¹æœçš„ã§ã™ã€‚

| æˆ¦ç•¥ | å‰Šæ¸›åŠ¹æœ | å®Ÿè£…é›£æ˜“åº¦ |
|------|---------|-----------|
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆåŒä¸€å…¥åŠ›ã®å†åˆ©ç”¨ï¼‰ | 40-60% | ä½ |
| ãƒ‘ã‚¹åˆ¶é™ï¼ˆå¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿è©•ä¾¡ï¼‰ | 30-50% | ä½ |
| è»½é‡ãƒ¢ãƒ‡ãƒ«ã§ã®Judge | 20-30% | ä¸­ |
| å¤œé–“ãƒãƒƒãƒï¼ˆRed teamingåˆ†é›¢ï¼‰ | 50-70% | ä¸­ |

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã¾ã¨ã‚:**
- LLMã‚¢ãƒ—ãƒªã®CI/CDã«ã¯**3å±¤è©•ä¾¡**ï¼ˆé™çš„æ¤œè¨¼ãƒ»LLMè©•ä¾¡ãƒ»Red teamingï¼‰ãŒå¿…è¦
- Promptfoo Ã— GitHub Actionsã§**PRå˜ä½ã®å“è³ªã‚²ãƒ¼ãƒˆ**ã‚’ä½ã‚³ã‚¹ãƒˆã«å®Ÿè£…ã§ãã‚‹
- å›è·¯ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãªã—ã ã¨**è²»ç”¨ãŒ10å€ä»¥ä¸Šè†¨å¼µ**ã™ã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚‹

**æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨:**
- `npx promptfoo@latest init` ã§é››å½¢ã‚’ç”Ÿæˆã—ã€æ—¢å­˜ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è©•ä¾¡ã‚’ä½“é¨“
- Evidently GitHub Actionã®[ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/evidentlyai/evidently-ci-example)ã§åˆ¥ãƒ„ãƒ¼ãƒ«ã‚‚æ¯”è¼ƒ

## å‚è€ƒ

- [Promptfoo CI/CD Integration Guide](https://www.promptfoo.dev/docs/integrations/ci-cd/)
- [Evidently - CI/CD for LLM Apps with GitHub Actions](https://www.evidentlyai.com/blog/llm-unit-testing-ci-cd-github-actions)
- [Braintrust - Best AI Evals Tools for CI/CD in 2025](https://www.braintrust.dev/articles/best-ai-evals-tools-cicd-2025)
- [USENIX - AI in the Pipeline: Reliability Lessons](https://www.usenix.org/publications/loginonline/ai-pipeline-reliability-lessons-adding-llm-cicd)
- [DeepEval - LLM Evaluation Framework](https://github.com/confident-ai/deepeval)

è©³ç´°ãªãƒªã‚µãƒ¼ãƒå†…å®¹ã¯ [Issue #131](https://github.com/0h-n0/zen-auto-create-article/issues/131) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

:::message
ã“ã®è¨˜äº‹ã¯AIï¼ˆClaude Codeï¼‰ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¤ã„ã¦ã¯è¤‡æ•°ã®æƒ…å ±æºã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®åˆ©ç”¨æ™‚ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã”ç¢ºèªãã ã•ã„ã€‚
:::
